# 平台管理端 - 阶段2功能测试指南

**功能**: 工厂管理增强 - 商务账号查看和数据溯源  
**测试时间**: 2026年1月6日  
**状态**: ✅ 开发完成，待测试

---

## 🎯 测试目标

验证以下功能：
1. ✅ 工厂详情弹窗正常显示
2. ✅ 商务团队列表正确加载
3. ✅ 商务详情弹窗正常显示
4. ✅ 商务工作数据统计准确
5. ✅ 数据溯源链路完整

---

## 📋 测试步骤

### 准备工作

1. **确认服务运行**
   - 后端: http://localhost:3000 ✅
   - 前端: http://localhost:5173 ✅

2. **登录平台管理员账号**
   - 邮箱: `admin@platform.com`
   - 密码: `Admin123!`

---

### 测试1: 工厂详情查看

**步骤**:
1. 点击左侧菜单"工厂管理"
2. 在工厂列表中找到任意一个工厂
3. 点击该工厂行的"查看详情"按钮（眼睛图标）

**预期结果**:
- ✅ 弹出工厂详情弹窗
- ✅ 显示工厂名称在标题栏
- ✅ 默认显示"基本信息"标签页
- ✅ 基本信息包含：
  - 工厂名称
  - 状态（带颜色标签）
  - 套餐类型（带颜色标签）
  - 负责人姓名和邮箱
  - 商务账号数量（当前/上限）
  - 达人数量（当前/上限）
  - 合作数量
  - 创建时间和更新时间

---

### 测试2: 商务团队列表

**步骤**:
1. 在工厂详情弹窗中
2. 点击"商务团队"标签页

**预期结果**:
- ✅ 显示该工厂的所有商务账号列表
- ✅ 标签页标题显示商务数量，如"商务团队 (3)"
- ✅ 表格包含以下列：
  - 姓名
  - 邮箱
  - 添加达人（数量）
  - 创建合作（数量）
  - 添加时间
  - 操作（查看详情按钮）
- ✅ 数据正确显示

**测试数据验证**:
- 如果工厂有商务账号，应该能看到列表
- 如果工厂没有商务账号，应该显示空表格

---

### 测试3: 商务详情查看

**步骤**:
1. 在商务团队列表中
2. 点击任意一个商务的"查看详情"按钮

**预期结果**:
- ✅ 弹出商务详情弹窗（在工厂详情弹窗之上）
- ✅ 标题显示"商务详情 - [商务姓名]"
- ✅ 默认显示"工作数据"标签页

---

### 测试4: 商务工作数据

**步骤**:
1. 在商务详情弹窗的"工作数据"标签页

**预期结果**:
- ✅ 显示基本信息表格：
  - 姓名
  - 邮箱
  - 所属工厂
  - 注册时间

- ✅ 显示4个统计卡片：
  - 添加达人（数量 + 图标）
  - 创建合作（数量 + 图标）
  - 完成合作（数量 + 图标，绿色）
  - 成功率（百分比 + 图标，根据数值显示颜色）

**数据验证**:
- 成功率 = (完成合作数 / 创建合作数) × 100%
- 成功率 >= 60% 显示绿色
- 成功率 < 60% 显示橙色

---

### 测试5: 商务的达人列表

**步骤**:
1. 在商务详情弹窗中
2. 点击"达人列表"标签页

**预期结果**:
- ✅ 标签页标题显示达人数量，如"达人列表 (15)"
- ✅ 显示该商务添加的所有达人
- ✅ 表格包含以下列：
  - 昵称
  - 平台
  - 粉丝数（格式化显示）
  - 合作次数
  - 添加时间
- ✅ 支持分页（每页10条）
- ✅ 显示总数统计

---

### 测试6: 商务的合作列表

**步骤**:
1. 在商务详情弹窗中
2. 点击"合作列表"标签页

**预期结果**:
- ✅ 标签页标题显示合作数量，如"合作列表 (8)"
- ✅ 显示该商务负责的所有合作
- ✅ 表格包含以下列：
  - 达人（昵称）
  - 平台
  - 阶段
  - 状态（已完成/进行中）
  - 创建时间
- ✅ 支持分页（每页10条）
- ✅ 显示总数统计

---

### 测试7: 数据溯源链路

**完整流程测试**:

1. **工厂 → 商务**
   - 在工厂管理页面，点击"示例工厂"的详情
   - 切换到"商务团队"标签页
   - 看到该工厂的所有商务账号

2. **商务 → 达人**
   - 点击"李商务"的详情
   - 切换到"达人列表"标签页
   - 看到李商务添加的所有达人

3. **商务 → 合作**
   - 在李商务详情中
   - 切换到"合作列表"标签页
   - 看到李商务负责的所有合作

4. **数据一致性**
   - 工厂详情中显示的商务数量 = 商务团队列表的行数
   - 商务工作数据中的"添加达人" = 达人列表的总数
   - 商务工作数据中的"创建合作" = 合作列表的总数

**预期结果**:
- ✅ 所有数据链路完整
- ✅ 数据统计准确
- ✅ 可以追溯每个数据的来源

---

## 🐛 常见问题排查

### 问题1: 工厂详情弹窗打不开
**检查**:
- 浏览器控制台是否有错误
- 后端API `/api/platform/factories/:id` 是否正常
- 网络请求是否返回200

### 问题2: 商务列表为空
**检查**:
- 该工厂是否真的有商务账号
- 后端API `/api/platform/factories/:id/staff` 是否正常
- 数据库中该工厂的商务账号数据

### 问题3: 商务详情数据不准确
**检查**:
- 后端API `/api/platform/staff/:id/stats` 返回的数据
- 数据库中的达人和合作数据
- 统计逻辑是否正确

### 问题4: 弹窗层级问题
**现象**: 商务详情弹窗被工厂详情弹窗遮挡
**解决**: 这是正常的，商务详情弹窗应该在工厂详情弹窗之上

---

## ✅ 测试检查清单

- [ ] 工厂详情弹窗正常打开
- [ ] 工厂基本信息正确显示
- [ ] 商务团队列表正确加载
- [ ] 商务数量统计准确
- [ ] 商务详情弹窗正常打开
- [ ] 商务基本信息正确显示
- [ ] 商务工作数据统计准确
- [ ] 成功率计算正确
- [ ] 达人列表正确显示
- [ ] 合作列表正确显示
- [ ] 分页功能正常
- [ ] 数据溯源链路完整
- [ ] 所有数据统计一致

---

## 📊 测试结果记录

**测试人**: _____________  
**测试时间**: _____________  
**测试结果**: ⬜ 通过 / ⬜ 失败

**发现的问题**:
1. 
2. 
3. 

**备注**:


---

**测试完成后**: 请将测试结果反馈给开发人员
