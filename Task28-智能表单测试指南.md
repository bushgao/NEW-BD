# Task 28 - 智能表单功能测试指南

**测试时间**: 2026年1月8日  
**功能**: 智能表单（自动填充、智能推荐、表单缓存）

---

## 🎯 测试目标

验证智能表单的以下功能：
1. 表单草稿自动保存和恢复
2. 智能建议加载和应用
3. 样品/报价/排期推荐
4. 用户体验流畅性

---

## 📋 测试前准备

### 1. 启动服务

```bash
# 启动后端服务
cd packages/backend
npm run dev

# 启动前端服务
cd packages/frontend
npm run dev
```

### 2. 准备测试数据

确保系统中有：
- ✅ 至少 3 个达人
- ✅ 至少 5 个样品
- ✅ 至少 2 条历史合作记录（已发布或已复盘）

---

## 🧪 测试用例

### 测试用例 1: 草稿自动保存

**步骤**:
1. 登录系统（商务人员账号）
2. 进入"合作管道"页面
3. 点击"新建合作"按钮
4. 选择一个达人
5. 填写部分表单内容（不提交）
6. 关闭弹窗
7. 再次点击"新建合作"按钮

**预期结果**:
- ✅ 看到"已恢复上次编辑的草稿"提示
- ✅ 表单内容自动填充为上次编辑的内容
- ✅ 显示"有未保存的更改"警告

---

### 测试用例 2: 智能建议加载

**步骤**:
1. 打开"新建合作"弹窗
2. 选择一个有历史合作记录的达人
3. 等待 1-2 秒

**预期结果**:
- ✅ 显示"智能建议"卡片
- ✅ 显示样品推荐（带"历史最佳"或"平台热门"标签）
- ✅ 显示报价推荐（带"历史平均"或"平台平均"标签）
- ✅ 显示排期推荐（带"历史最佳时间"或"黄金时段"标签）
- ✅ 每个建议显示置信度标签（绿色/橙色/灰色）

---

### 测试用例 3: 应用建议

**步骤**:
1. 在智能建议卡片中
2. 点击某个建议的"应用"按钮

**预期结果**:
- ✅ 对应的表单字段自动填充
- ✅ 显示"已应用建议：xxx"成功提示
- ✅ 该建议从列表中消失

---

### 测试用例 4: 忽略建议

**步骤**:
1. 在智能建议卡片中
2. 点击某个建议的"忽略"按钮

**预期结果**:
- ✅ 该建议从列表中消失
- ✅ 表单字段不受影响

---

### 测试用例 5: 样品推荐准确性

**步骤**:
1. 选择一个有多次成功合作的达人
2. 查看样品推荐

**预期结果**:
- ✅ 推荐的样品是该达人历史上效果最好的
- ✅ 显示平均 GMV 数据
- ✅ 置信度为"高"（绿色标签）

---

### 测试用例 6: 报价推荐准确性

**步骤**:
1. 选择一个有历史报价的达人
2. 查看报价推荐

**预期结果**:
- ✅ 推荐的报价接近历史平均值
- ✅ 显示推荐理由（如"该达人历史平均报价为 ¥xxx"）
- ✅ 提供多个报价选项（历史平均、平台平均、粉丝估算）

---

### 测试用例 7: 排期推荐

**步骤**:
1. 选择一个达人
2. 查看排期推荐

**预期结果**:
- ✅ 推荐的时间为一周后
- ✅ 推荐的小时为黄金时段（12:00、18:00、20:00）
- ✅ 显示推荐理由

---

### 测试用例 8: 表单提交

**步骤**:
1. 填写完整的表单
2. 点击"创建"按钮

**预期结果**:
- ✅ 显示"合作记录已创建"成功提示
- ✅ 弹窗关闭
- ✅ 草稿自动清除
- ✅ 合作管道页面刷新，显示新创建的合作

---

### 测试用例 9: 草稿过期清理

**步骤**:
1. 创建一个草稿（不提交）
2. 修改系统时间为 25 小时后（或修改代码中的过期时间为 1 分钟）
3. 重新打开"新建合作"弹窗

**预期结果**:
- ✅ 不显示草稿恢复提示
- ✅ 表单为空白状态
- ✅ localStorage 中的草稿已被清除

---

### 测试用例 10: 无历史数据的达人

**步骤**:
1. 选择一个从未有过合作记录的达人
2. 查看智能建议

**预期结果**:
- ✅ 显示"最新样品"推荐
- ✅ 显示"粉丝数估算"报价
- ✅ 显示"黄金时段"排荐
- ✅ 所有建议的置信度为"低"（灰色标签）

---

## 🐛 常见问题排查

### 问题 1: 建议不显示

**可能原因**:
- 达人 ID 无效
- 后端服务未启动
- API 请求失败

**排查步骤**:
1. 打开浏览器开发者工具（F12）
2. 查看 Network 标签
3. 检查 `/api/collaborations/suggestions` 请求
4. 查看响应状态和数据

---

### 问题 2: 草稿不保存

**可能原因**:
- localStorage 被禁用
- 浏览器隐私模式
- 存储空间已满

**排查步骤**:
1. 打开浏览器开发者工具（F12）
2. 查看 Application > Local Storage
3. 检查是否有 `smart_form_draft_collaboration` 键

---

### 问题 3: 推荐不准确

**可能原因**:
- 历史数据不足
- 算法需要优化

**排查步骤**:
1. 检查达人的历史合作记录数量
2. 检查合作结果数据是否完整
3. 查看后端日志

---

## 📊 测试结果记录

### 功能测试结果

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 草稿自动保存 | ⬜ 待测试 | |
| 智能建议加载 | ⬜ 待测试 | |
| 应用建议 | ⬜ 待测试 | |
| 忽略建议 | ⬜ 待测试 | |
| 样品推荐准确性 | ⬜ 待测试 | |
| 报价推荐准确性 | ⬜ 待测试 | |
| 排期推荐 | ⬜ 待测试 | |
| 表单提交 | ⬜ 待测试 | |
| 草稿过期清理 | ⬜ 待测试 | |
| 无历史数据的达人 | ⬜ 待测试 | |

### 性能测试结果

| 指标 | 目标 | 实际 | 状态 |
|------|------|------|------|
| 建议加载时间 | < 2秒 | ⬜ 待测试 | |
| 草稿保存时间 | < 100ms | ⬜ 待测试 | |
| 表单提交时间 | < 1秒 | ⬜ 待测试 | |

---

## ✅ 验收标准

所有测试用例通过后，功能验收通过：

- [ ] 所有功能测试用例通过
- [ ] 性能指标达标
- [ ] 无严重 Bug
- [ ] 用户体验流畅

---

## 📝 测试反馈

请在测试过程中记录：
1. 发现的问题
2. 改进建议
3. 用户体验反馈

---

**测试负责人**: ___________  
**测试日期**: ___________  
**测试结果**: ⬜ 通过 / ⬜ 不通过
