# Chrome 插件测试指南

## 🎯 测试目标

验证 Chrome 浏览器插件能够正常工作，实现从抖音精选联盟一键采集达人信息到 Zilo 系统。

---

## ✅ 前置条件检查

### 1. 后端服务运行

```bash
# 进入后端目录
cd packages/backend

# 启动后端服务
npm run dev

# 验证服务运行
# 浏览器访问：http://localhost:3000/health
# 应该看到：{"status":"ok","timestamp":"..."}
```

### 2. 前端服务运行

```bash
# 进入前端目录
cd packages/frontend

# 启动前端服务
npm run dev

# 验证服务运行
# 浏览器访问：http://localhost:5173
# 应该能看到 Zilo 登录页面
```

### 3. 测试账号准备

使用以下测试账号之一：

**工厂老板账号：**
- 用户名：`owner`
- 密码：`owner123`

**商务人员账号：**
- 用户名：`staff`
- 密码：`staff123`

---

## 📦 安装插件

### 步骤 1：打开扩展管理页面

1. 打开 Chrome 浏览器
2. 在地址栏输入：`chrome://extensions/`
3. 按回车

### 步骤 2：启用开发者模式

1. 在页面右上角找到"开发者模式"开关
2. 点击开启（变为蓝色）

### 步骤 3：加载插件

1. 点击"加载已解压的扩展程序"按钮
2. 在文件选择窗口中，导航到项目根目录
3. 选择 `chrome-extension` 文件夹
4. 点击"选择文件夹"

### 步骤 4：验证安装

1. 在扩展列表中应该看到"Zilo 达人采集助手"
2. 状态应该是"已启用"
3. 浏览器工具栏应该出现插件图标（如果有图标的话）

---

## ⚙️ 配置插件

### 步骤 1：获取登录令牌

1. 打开 Zilo 系统：http://localhost:5173
2. 使用测试账号登录（owner/owner123 或 staff/staff123）
3. 登录成功后，按键盘 `F12` 打开开发者工具
4. 切换到 `Application` 标签页
5. 在左侧菜单中展开 `Local Storage`
6. 点击 `http://localhost:5173`
7. 在右侧列表中找到 `token` 字段
8. 双击 `token` 的值，按 `Ctrl+C` 复制

### 步骤 2：配置插件

1. 点击浏览器工具栏中的 Zilo 插件图标（或在扩展管理页面点击"详细信息"）
2. 在弹出窗口中点击"⚙️ 配置设置"按钮
3. 填写配置信息：
   - **API 地址**：`http://localhost:3000/api`（默认值，不需要修改）
   - **登录令牌**：粘贴刚才复制的 token
4. 点击"💾 保存配置"按钮
5. 看到"配置已保存"提示
6. 点击"← 返回"

### 步骤 3：验证配置

1. 在主界面查看"连接状态"
2. 应该显示"✓ 已连接"（绿色圆点）
3. 如果显示"✗ 未配置"（红色圆点），请检查 token 是否正确

---

## 🧪 测试 API 连接（可选）

在测试实际采集功能之前，可以先测试 API 连接：

### 方法 1：使用测试工具页面

1. 在浏览器中打开：`chrome-extension/test-api.html`
2. 填写 API 地址和 Token
3. 点击"❤️ 检查服务健康状态"
4. 应该看到"✅ 服务健康状态 - 正常"
5. 点击"🚀 测试 API 连接"
6. 应该看到"✅ API 测试成功"

### 方法 2：使用浏览器控制台

```javascript
// 在浏览器控制台执行
fetch('http://localhost:3000/api/influencers', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_TOKEN_HERE'
  },
  body: JSON.stringify({
    nickname: '测试达人',
    platform: 'DOUYIN',
    platformId: 'test123',
    categories: ['生鲜'],
    tags: ['LV3'],
    notes: '测试'
  })
})
.then(res => res.json())
.then(data => console.log('成功:', data))
.catch(err => console.error('失败:', err));
```

---

## 🎬 测试采集功能

### 测试场景 1：模拟达人详情页

由于我们可能无法访问真实的抖音精选联盟，可以创建一个模拟页面：

1. 创建测试页面 `test-douyin-page.html`：

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>模拟抖音精选联盟达人详情页</title>
</head>
<body>
  <div class="author-header">
    <h1 class="author-name">美食达人小王</h1>
    <div class="douyin-id">抖音号：123456789</div>
    <div class="fans">粉丝数：12.5万</div>
    <div class="category">主推类目：生鲜</div>
    <div class="level">等级：LV3</div>
  </div>
</body>
</html>
```

2. 修改 `manifest.json` 的 `matches`，临时添加本地测试：

```json
"content_scripts": [
  {
    "matches": [
      "https://buyin.jinritemai.com/*",
      "file:///*test-douyin-page.html"
    ],
    "js": ["content.js"],
    "css": ["content.css"],
    "run_at": "document_idle"
  }
]
```

3. 在浏览器中打开 `test-douyin-page.html`
4. 应该看到"添加到 Zilo"按钮
5. 点击按钮测试采集

### 测试场景 2：真实抖音精选联盟（如果有账号）

1. 打开抖音精选联盟：https://buyin.jinritemai.com
2. 登录您的抖音账号
3. 进入达人广场或达人详情页
4. URL 应该包含 `daren-profile`
5. 页面右上角应该出现"添加到 Zilo"按钮
6. 点击按钮采集达人

---

## ✅ 验证结果

### 1. 检查插件反馈

- 点击按钮后，按钮文字变为"采集中..."
- 1-2 秒后，应该看到以下之一：
  - ✅ "✓ 已添加"（成功）
  - ❌ "采集失败：错误信息"（失败）

### 2. 检查通知消息

- 页面右上角应该出现通知消息
- 成功：绿色背景，"达人采集成功！"
- 失败：红色背景，显示错误原因

### 3. 检查 Zilo 系统

1. 返回 Zilo 系统：http://localhost:5173
2. 进入"达人管理"页面
3. 刷新页面
4. 在列表中应该能看到刚才采集的达人
5. 检查信息是否正确：
   - 昵称
   - 平台（抖音）
   - 抖音号
   - 类目
   - 标签
   - 备注（应该包含粉丝数）

### 4. 检查统计数据

1. 点击插件图标
2. 查看"已采集"数量，应该增加 1
3. 如果采集失败，"失败"数量应该增加 1

---

## 🐛 调试方法

### 查看插件日志

**后台日志（Background Script）：**
1. 打开 `chrome://extensions/`
2. 找到"Zilo 达人采集助手"
3. 点击"详细信息"
4. 点击"检查视图：Service Worker"
5. 在控制台查看日志，查找 `[Zilo Background]` 开头的消息

**内容脚本日志（Content Script）：**
1. 在达人详情页按 `F12`
2. 切换到 `Console` 标签
3. 查找 `[Zilo]` 开头的日志
4. 检查是否有错误信息

### 常见问题排查

**问题 1：按钮没有出现**
- 检查 URL 是否包含 `daren-profile`
- 检查插件是否启用
- 查看控制台是否有错误
- 刷新页面重试

**问题 2：点击按钮无反应**
- 打开控制台查看错误
- 检查 Background Script 日志
- 验证 Token 是否正确

**问题 3：提示"采集失败"**
- 检查后端服务是否运行
- 检查 Token 是否过期
- 查看错误消息具体内容
- 检查网络请求（Network 标签）

**问题 4：信息提取不完整**
- 查看控制台日志，检查提取的信息
- 可能是页面结构与选择器不匹配
- 需要更新 `content.js` 中的选择器

---

## 📊 测试用例

### 用例 1：正常采集

**前置条件**：
- 插件已配置
- 在达人详情页

**操作步骤**：
1. 点击"添加到 Zilo"按钮

**预期结果**：
- 按钮变为"✓ 已添加"
- 显示成功通知
- Zilo 系统中能看到新达人

### 用例 2：重复采集

**前置条件**：
- 达人已存在于系统中

**操作步骤**：
1. 在同一达人详情页再次点击按钮

**预期结果**：
- 显示错误通知："达人平台账号ID已存在"或"达人手机号已存在"

### 用例 3：未配置 Token

**前置条件**：
- 插件未配置 Token

**操作步骤**：
1. 点击"添加到 Zilo"按钮

**预期结果**：
- 显示错误通知："请先在插件设置中配置登录令牌"

### 用例 4：后端服务未运行

**前置条件**：
- 停止后端服务

**操作步骤**：
1. 点击"添加到 Zilo"按钮

**预期结果**：
- 显示错误通知："采集失败：网络错误"或类似消息

### 用例 5：达到数量上限

**前置条件**：
- 达人数量已达套餐上限

**操作步骤**：
1. 点击"添加到 Zilo"按钮

**预期结果**：
- 显示错误通知："已达到达人数量上限"

---

## 📝 测试报告模板

```markdown
# Chrome 插件测试报告

**测试日期**：2026-01-05
**测试人员**：[您的名字]
**插件版本**：v1.0.0

## 测试环境
- Chrome 版本：[版本号]
- 操作系统：[Windows/Mac/Linux]
- 后端服务：[运行/未运行]
- 前端服务：[运行/未运行]

## 测试结果

### 1. 安装测试
- [ ] 插件成功加载
- [ ] 工具栏显示图标
- [ ] 扩展列表显示正常

### 2. 配置测试
- [ ] 成功获取 Token
- [ ] 配置保存成功
- [ ] 连接状态显示正常

### 3. 功能测试
- [ ] 按钮正常注入
- [ ] 信息提取正确
- [ ] 采集成功
- [ ] 统计数据更新

### 4. 错误处理测试
- [ ] 未配置提示正常
- [ ] 重复采集提示正常
- [ ] 网络错误提示正常

## 发现的问题

1. [问题描述]
   - 严重程度：[高/中/低]
   - 复现步骤：[...]
   - 预期结果：[...]
   - 实际结果：[...]

## 建议和改进

1. [建议内容]

## 总体评价

[总体评价内容]
```

---

## 🎉 测试完成

如果所有测试用例都通过，恭喜！插件已经可以正常使用了。

如果遇到问题，请：
1. 记录详细的错误信息
2. 截图保存
3. 查看日志
4. 联系开发团队

---

**祝测试顺利！** 🚀
