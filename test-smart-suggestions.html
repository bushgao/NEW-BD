<!DOCTYPE html>
<html>
<head>
    <title>æµ‹è¯•æ™ºèƒ½å»ºè®®åŠŸèƒ½</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        .info { background-color: #d1ecf1; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        .log {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-left: 3px solid #007bff;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ™ºèƒ½å»ºè®®åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="section info">
        <h3>æµ‹è¯•æ­¥éª¤ï¼š</h3>
        <ol>
            <li>ç‚¹å‡»"è·å–Token"æŒ‰é’®</li>
            <li>ç‚¹å‡»"è·å–è¾¾äººåˆ—è¡¨"æŒ‰é’®</li>
            <li>é€‰æ‹©ä¸€ä¸ªè¾¾äºº</li>
            <li>ç‚¹å‡»"æµ‹è¯•æ™ºèƒ½å»ºè®®"æŒ‰é’®</li>
        </ol>
    </div>

    <div class="section">
        <h3>1. è·å–è®¤è¯Token</h3>
        <button onclick="getToken()">è·å–Token</button>
        <div id="tokenResult"></div>
    </div>

    <div class="section">
        <h3>2. è·å–è¾¾äººåˆ—è¡¨</h3>
        <button onclick="getInfluencers()">è·å–è¾¾äººåˆ—è¡¨</button>
        <div id="influencersResult"></div>
    </div>

    <div class="section">
        <h3>3. æµ‹è¯•æ™ºèƒ½å»ºè®®</h3>
        <label>é€‰æ‹©è¾¾äººï¼š</label>
        <select id="influencerSelect" style="width: 300px; padding: 5px;">
            <option value="">è¯·å…ˆè·å–è¾¾äººåˆ—è¡¨</option>
        </select>
        <br><br>
        <button onclick="testSuggestions('sample')">æµ‹è¯•æ ·å“å»ºè®®</button>
        <button onclick="testSuggestions('price')">æµ‹è¯•æŠ¥ä»·å»ºè®®</button>
        <button onclick="testSuggestions('schedule')">æµ‹è¯•æ’æœŸå»ºè®®</button>
        <button onclick="testAllSuggestions()">æµ‹è¯•å…¨éƒ¨å»ºè®®</button>
        <div id="suggestionsResult"></div>
    </div>

    <div class="section">
        <h3>4. æµ‹è¯•æ—¥å¿—</h3>
        <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        <div id="logs"></div>
    </div>

    <script>
        let token = '';
        let influencers = [];

        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.className = 'log';
            logEntry.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logsDiv.insertBefore(logEntry, logsDiv.firstChild);
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function getToken() {
            token = localStorage.getItem('token');
            const resultDiv = document.getElementById('tokenResult');
            
            if (token) {
                resultDiv.innerHTML = `<div class="success">âœ… Tokenå·²è·å–: ${token.substring(0, 20)}...</div>`;
                log('âœ… Tokenå·²è·å–');
            } else {
                resultDiv.innerHTML = `<div class="error">âŒ æœªæ‰¾åˆ°Tokenï¼Œè¯·å…ˆç™»å½•ç³»ç»Ÿ</div>`;
                log('âŒ æœªæ‰¾åˆ°Token', 'error');
            }
        }

        async function getInfluencers() {
            if (!token) {
                alert('è¯·å…ˆè·å–Token');
                return;
            }

            const resultDiv = document.getElementById('influencersResult');
            resultDiv.innerHTML = '<div class="info">â³ æ­£åœ¨è·å–è¾¾äººåˆ—è¡¨...</div>';
            log('â³ æ­£åœ¨è·å–è¾¾äººåˆ—è¡¨...');

            try {
                const response = await fetch('http://localhost:3001/api/influencers?page=1&pageSize=50', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                log(`ğŸ“¡ APIå“åº”: ${JSON.stringify(data).substring(0, 100)}...`);

                if (data.success && data.data && data.data.data) {
                    influencers = data.data.data;
                    
                    const select = document.getElementById('influencerSelect');
                    select.innerHTML = '<option value="">è¯·é€‰æ‹©è¾¾äºº</option>';
                    
                    influencers.forEach(inf => {
                        const option = document.createElement('option');
                        option.value = inf.id;
                        option.textContent = `${inf.nickname} (${inf.platform} - ${inf.platformId})`;
                        select.appendChild(option);
                    });

                    resultDiv.innerHTML = `<div class="success">âœ… æˆåŠŸè·å– ${influencers.length} ä¸ªè¾¾äºº</div>`;
                    log(`âœ… æˆåŠŸè·å– ${influencers.length} ä¸ªè¾¾äºº`);
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ è·å–å¤±è´¥: ${JSON.stringify(data)}</div>`;
                    log(`âŒ è·å–è¾¾äººå¤±è´¥: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
                log(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testSuggestions(type) {
            const influencerId = document.getElementById('influencerSelect').value;
            
            if (!influencerId) {
                alert('è¯·å…ˆé€‰æ‹©è¾¾äºº');
                return;
            }

            if (!token) {
                alert('è¯·å…ˆè·å–Token');
                return;
            }

            const resultDiv = document.getElementById('suggestionsResult');
            resultDiv.innerHTML = `<div class="info">â³ æ­£åœ¨è·å–${type}å»ºè®®...</div>`;
            log(`â³ æ­£åœ¨è·å–${type}å»ºè®®ï¼Œè¾¾äººID: ${influencerId}`);

            try {
                const url = `http://localhost:3001/api/collaborations/suggestions?influencerId=${influencerId}&type=${type}`;
                log(`ğŸ“¡ è¯·æ±‚URL: ${url}`);

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                log(`ğŸ“¡ å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);

                const data = await response.json();
                log(`ğŸ“¡ å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`);

                if (data.success) {
                    const suggestions = data.data.suggestions || [];
                    let html = `<div class="success">
                        <h4>âœ… ${type}å»ºè®® (${suggestions.length}æ¡)</h4>
                        <pre>${JSON.stringify(data.data, null, 2)}</pre>
                    </div>`;
                    resultDiv.innerHTML = html;
                    log(`âœ… æˆåŠŸè·å–${suggestions.length}æ¡${type}å»ºè®®`);
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ è·å–å¤±è´¥: ${JSON.stringify(data)}</div>`;
                    log(`âŒ è·å–å»ºè®®å¤±è´¥: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
                log(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testAllSuggestions() {
            const influencerId = document.getElementById('influencerSelect').value;
            
            if (!influencerId) {
                alert('è¯·å…ˆé€‰æ‹©è¾¾äºº');
                return;
            }

            const resultDiv = document.getElementById('suggestionsResult');
            resultDiv.innerHTML = '<div class="info">â³ æ­£åœ¨è·å–å…¨éƒ¨å»ºè®®...</div>';
            log('â³ å¼€å§‹æµ‹è¯•å…¨éƒ¨å»ºè®®ç±»å‹');

            try {
                const types = ['sample', 'price', 'schedule'];
                const results = [];

                for (const type of types) {
                    log(`â³ æµ‹è¯•${type}å»ºè®®...`);
                    const url = `http://localhost:3001/api/collaborations/suggestions?influencerId=${influencerId}&type=${type}`;
                    
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    results.push({ type, data });
                    log(`âœ… ${type}å»ºè®®: ${data.success ? data.data.suggestions.length + 'æ¡' : 'å¤±è´¥'}`);
                }

                let html = '<div class="success"><h4>âœ… å…¨éƒ¨å»ºè®®ç»“æœ</h4>';
                results.forEach(result => {
                    html += `<h5>${result.type}å»ºè®®:</h5>`;
                    html += `<pre>${JSON.stringify(result.data, null, 2)}</pre>`;
                });
                html += '</div>';
                
                resultDiv.innerHTML = html;
                log('âœ… å…¨éƒ¨å»ºè®®æµ‹è¯•å®Œæˆ');
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–token
        window.onload = function() {
            getToken();
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•æ™ºèƒ½å»ºè®®åŠŸèƒ½');
        };
    </script>
</body>
</html>
