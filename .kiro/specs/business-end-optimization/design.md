# ä¸šåŠ¡ç«¯ä¼˜åŒ– - è®¾è®¡æ–‡æ¡£

**åˆ›å»ºæ—¶é—´**: 2026å¹´1æœˆ6æ—¥  
**çŠ¶æ€**: è®¾è®¡ä¸­  
**ç‰ˆæœ¬**: 1.0

---

## ğŸ“‹ è®¾è®¡æ¦‚è¿°

æœ¬è®¾è®¡æ–‡æ¡£è¯¦ç»†æè¿°äº†ä¸šåŠ¡ç«¯ä¼˜åŒ–é¡¹ç›®çš„æŠ€æœ¯æ¶æ„ã€ç»„ä»¶è®¾è®¡ã€æ•°æ®æ¨¡å‹å’Œå®ç°æ–¹æ¡ˆã€‚é¡¹ç›®åˆ†ä¸ºå·¥å‚è€æ¿ç«¯ä¼˜åŒ–å’Œå•†åŠ¡äººå‘˜ç«¯ä¼˜åŒ–ä¸¤å¤§éƒ¨åˆ†ï¼Œé‡ç‚¹å®ç°å•†åŠ¡æƒé™ç®¡ç†åŠŸèƒ½ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯åº”ç”¨å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å·¥å‚è€æ¿ç«¯   â”‚  â”‚ å•†åŠ¡äººå‘˜ç«¯   â”‚  â”‚ å…±äº«ç»„ä»¶åº“   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API ç½‘å…³å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æƒé™ä¸­é—´ä»¶   â”‚  â”‚ è®¤è¯ä¸­é—´ä»¶   â”‚  â”‚ æ—¥å¿—ä¸­é—´ä»¶   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡é€»è¾‘å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æŠ¥è¡¨æœåŠ¡     â”‚  â”‚ æƒé™æœåŠ¡     â”‚  â”‚ é€šçŸ¥æœåŠ¡     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®è®¿é—®å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Prisma ORM   â”‚  â”‚ ç¼“å­˜å±‚       â”‚  â”‚ æ–‡ä»¶å­˜å‚¨     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

**å‰ç«¯**:
- React 18
- TypeScript
- Ant Design 5
- Recharts (å›¾è¡¨åº“)
- Zustand (çŠ¶æ€ç®¡ç†)
- React Query (æ•°æ®è·å–)

**åç«¯**:
- Node.js + Express
- TypeScript
- Prisma ORM
- PostgreSQL
- JWT è®¤è¯

---

## ğŸ¨ ç»„ä»¶è®¾è®¡

### ç¬¬ä¸€éƒ¨åˆ†ï¼šå·¥å‚è€æ¿ç«¯ç»„ä»¶

#### 1.1 æ•°æ®å¯è§†åŒ–ç»„ä»¶

**TrendChart ç»„ä»¶**
```typescript
interface TrendChartProps {
  period: 'week' | 'month' | 'quarter';
  dataType: 'gmv' | 'cost' | 'roi';
  onPeriodChange: (period: string) => void;
}
```

**ROIAnalysisChart ç»„ä»¶**
```typescript
interface ROIAnalysisChartProps {
  staffData: StaffROIData[];
  chartType: 'bar' | 'pie' | 'scatter';
}
```

**PipelineFunnelChart ç»„ä»¶**
```typescript
interface PipelineFunnelChartProps {
  stages: PipelineStageData[];
  showConversionRate: boolean;
  showDuration: boolean;
}
```


#### 1.2 å•†åŠ¡ç»©æ•ˆåˆ†æç»„ä»¶

**StaffComparisonChart ç»„ä»¶**
```typescript
interface StaffComparisonChartProps {
  staffIds: string[];
  metrics: ('leads' | 'deals' | 'gmv' | 'roi' | 'efficiency')[];
  onStaffSelect: (staffIds: string[]) => void;
}
```

**StaffQualityScore ç»„ä»¶**
```typescript
interface StaffQualityScoreProps {
  staffId: string;
  showTrend: boolean;
  showSuggestions: boolean;
}

interface QualityScore {
  overall: number;
  followUpFrequency: number;
  conversionRate: number;
  roi: number;
  efficiency: number;
  trend: ScoreTrend[];
  suggestions: string[];
}
```

**StaffWorkCalendar ç»„ä»¶**
```typescript
interface StaffWorkCalendarProps {
  staffId: string;
  month: Date;
  onDateClick: (date: Date) => void;
}

interface CalendarEvent {
  date: Date;
  type: 'deadline' | 'scheduled' | 'followup';
  title: string;
  collaborationId?: string;
}
```

#### 1.3 å¿«æ·æ“ä½œç»„ä»¶

**QuickActionsPanel ç»„ä»¶**
```typescript
interface QuickActionsPanelProps {
  actions: QuickAction[];
}

interface QuickAction {
  id: string;
  title: string;
  icon: React.ReactNode;
  count?: number;
  onClick: () => void;
}
```

**SmartNotifications ç»„ä»¶**
```typescript
interface SmartNotificationsProps {
  notifications: Notification[];
  onNotificationClick: (notification: Notification) => void;
  onMarkAsRead: (notificationId: string) => void;
}

interface Notification {
  id: string;
  type: 'daily_summary' | 'alert' | 'reminder';
  title: string;
  content: string;
  priority: 'low' | 'medium' | 'high';
  createdAt: Date;
  isRead: boolean;
}
```

**CustomizableDashboard ç»„ä»¶**
```typescript
interface CustomizableDashboardProps {
  layout: DashboardLayout;
  widgets: Widget[];
  onLayoutChange: (layout: DashboardLayout) => void;
}

interface DashboardLayout {
  cards: CardLayout[];
}

interface CardLayout {
  id: string;
  x: number;
  y: number;
  w: number;
  h: number;
  visible: boolean;
}
```


#### 1.4 â­ å•†åŠ¡æƒé™ç®¡ç†ç»„ä»¶

**StaffPermissionsModal ç»„ä»¶**
```typescript
interface StaffPermissionsModalProps {
  visible: boolean;
  staffId: string;
  currentPermissions: StaffPermissions;
  onSave: (permissions: StaffPermissions) => Promise<void>;
  onCancel: () => void;
}

interface StaffPermissions {
  dataVisibility: {
    viewOthersInfluencers: boolean;
    viewOthersCollaborations: boolean;
    viewOthersPerformance: boolean;
    viewTeamData: boolean;
    viewRanking: boolean;
  };
  operations: {
    manageInfluencers: boolean;
    manageSamples: boolean;
    manageCollaborations: boolean;
    deleteCollaborations: boolean;
    exportData: boolean;
    batchOperations: boolean;
  };
  advanced: {
    viewCostData: boolean;
    viewROIData: boolean;
    modifyOthersData: boolean;
  };
}
```

**PermissionTemplateSelector ç»„ä»¶**
```typescript
interface PermissionTemplateSelectorProps {
  templates: PermissionTemplate[];
  selectedTemplate: string;
  onSelect: (templateId: string) => void;
}

interface PermissionTemplate {
  id: 'basic' | 'advanced' | 'supervisor' | 'custom';
  name: string;
  description: string;
  permissions: StaffPermissions;
}
```

**usePermissions Hook**
```typescript
interface UsePermissionsReturn {
  hasPermission: (permission: string) => boolean;
  permissions: StaffPermissions | null;
  isLoading: boolean;
}

function usePermissions(): UsePermissionsReturn {
  const { user } = useAuthStore();
  
  // å·¥å‚è€æ¿æ‹¥æœ‰æ‰€æœ‰æƒé™
  if (user?.role === 'FACTORY_OWNER') {
    return {
      hasPermission: () => true,
      permissions: null,
      isLoading: false,
    };
  }
  
  // å•†åŠ¡äººå‘˜æƒé™æ£€æŸ¥
  const permissions = user?.permissions as StaffPermissions;
  
  const hasPermission = (permission: string): boolean => {
    const [category, key] = permission.split('.');
    return permissions?.[category]?.[key] ?? false;
  };
  
  return {
    hasPermission,
    permissions,
    isLoading: false,
  };
}
```


### ç¬¬äºŒéƒ¨åˆ†ï¼šå•†åŠ¡äººå‘˜ç«¯ç»„ä»¶

#### 2.1 è¾¾äººç®¡ç†ä¼˜åŒ–ç»„ä»¶

**QuickFilters ç»„ä»¶**
```typescript
interface QuickFiltersProps {
  savedFilters: SavedFilter[];
  onApplyFilter: (filter: FilterConfig) => void;
  onSaveFilter: (name: string, filter: FilterConfig) => void;
  onDeleteFilter: (filterId: string) => void;
}

interface SavedFilter {
  id: string;
  name: string;
  filter: FilterConfig;
  createdAt: Date;
}
```

**InfluencerDetailPanel ç»„ä»¶**
```typescript
interface InfluencerDetailPanelProps {
  influencerId: string;
  showHistory: boolean;
  showROI: boolean;
  showBestSamples: boolean;
  showContactHistory: boolean;
}

interface InfluencerDetail {
  basic: InfluencerBasicInfo;
  collaborationHistory: Collaboration[];
  roiStats: ROIStats;
  bestSamples: Sample[];
  contactHistory: ContactRecord[];
}
```

**InfluencerGroups ç»„ä»¶**
```typescript
interface InfluencerGroupsProps {
  groups: InfluencerGroup[];
  influencers: Influencer[];
  onGroupChange: (influencerId: string, groupId: string) => void;
  onCreateGroup: (name: string) => void;
  onDeleteGroup: (groupId: string) => void;
}

interface InfluencerGroup {
  id: string;
  name: string;
  color: string;
  influencerCount: number;
  stats: GroupStats;
}
```

#### 2.2 è·Ÿè¿›æµç¨‹ä¼˜åŒ–ç»„ä»¶

**QuickFollowUp ç»„ä»¶**
```typescript
interface QuickFollowUpProps {
  collaborationId: string;
  templates: FollowUpTemplate[];
  voiceInput: boolean;
  onSubmit: (content: string, images?: File[]) => Promise<void>;
}

interface FollowUpTemplate {
  id: string;
  name: string;
  content: string;
  category: string;
}
```

**FollowUpReminder ç»„ä»¶**
```typescript
interface FollowUpReminderProps {
  collaborations: Collaboration[];
  onRemind: (collaborationId: string) => void;
  onSnooze: (collaborationId: string, duration: number) => void;
}

interface FollowUpSuggestion {
  collaborationId: string;
  influencerName: string;
  lastFollowUpDate: Date;
  suggestedNextDate: Date;
  frequency: 'daily' | 'weekly' | 'biweekly';
  priority: 'low' | 'medium' | 'high';
}
```

**FollowUpAnalytics ç»„ä»¶**
```typescript
interface FollowUpAnalyticsProps {
  staffId: string;
  period: 'week' | 'month' | 'quarter';
}

interface FollowUpAnalytics {
  effectivenessScore: number;
  bestTime: string;
  bestFrequency: string;
  conversionByTime: TimeConversionData[];
  conversionByFrequency: FrequencyConversionData[];
}
```


#### 2.3 æ•°æ®å½•å…¥ä¼˜åŒ–ç»„ä»¶

**SmartForm ç»„ä»¶**
```typescript
interface SmartFormProps {
  type: 'collaboration' | 'dispatch' | 'result';
  initialData?: any;
  autoFill: boolean;
  suggestions: boolean;
  onSubmit: (data: any) => Promise<void>;
}

interface SmartFormState {
  data: any;
  suggestions: Suggestion[];
  validationErrors: ValidationError[];
  isDirty: boolean;
}
```

**BatchOperations ç»„ä»¶**
```typescript
interface BatchOperationsProps {
  selectedIds: string[];
  operations: BatchOperation[];
  onExecute: (operation: string, data: any) => Promise<void>;
}

interface BatchOperation {
  id: string;
  name: string;
  icon: React.ReactNode;
  requiresInput: boolean;
  inputSchema?: any;
}
```

#### 2.4 å·¥ä½œå°ä¼˜åŒ–ç»„ä»¶

**TodayTodoList ç»„ä»¶**
```typescript
interface TodayTodoListProps {
  todos: TodoItem[];
  onComplete: (todoId: string) => void;
  onSnooze: (todoId: string, until: Date) => void;
}

interface TodoItem {
  id: string;
  type: 'followup' | 'deadline' | 'dispatch' | 'result';
  title: string;
  description: string;
  priority: 'low' | 'medium' | 'high';
  dueTime?: Date;
  relatedId: string;
}
```

**WorkStats ç»„ä»¶**
```typescript
interface WorkStatsProps {
  period: 'today' | 'week' | 'month';
  showTrend: boolean;
}

interface WorkStats {
  leadsAdded: number;
  collaborationsCreated: number;
  samplesDispatched: number;
  followUpsCompleted: number;
  dealsCompleted: number;
  gmv: number;
  goalProgress: number;
  rankChange: number;
}
```

---

## ğŸ’¾ æ•°æ®æ¨¡å‹è®¾è®¡

### æ•°æ®åº“ Schema æ›´æ–°

#### User æ¨¡å‹æ›´æ–°
```prisma
model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  name         String
  role         UserRole
  factoryId    String?
  
  // æ–°å¢ï¼šæƒé™é…ç½®
  permissions  Json?    @default("{}")
  
  // æ–°å¢ï¼šä¸ªäººåå¥½è®¾ç½®
  preferences  Json?    @default("{}")
  
  isActive     Boolean  @default(true)
  lastLoginAt  DateTime?
  disabledAt   DateTime?
  disabledBy   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  factory         Factory?          @relation("FactoryStaff", fields: [factoryId], references: [id])
  ownedFactory    Factory?          @relation("FactoryOwner")
  collaborations  Collaboration[]
  sampleDispatches SampleDispatch[]
  followUpRecords FollowUpRecord[]
  notifications   Notification[]
  createdInfluencers  Influencer[]  @relation("InfluencerCreator")
  verifiedInfluencers Influencer[]  @relation("InfluencerVerifier")

  @@index([email])
  @@index([factoryId])
}
```

#### æƒé™é…ç½®ç»“æ„
```typescript
interface UserPermissions {
  dataVisibility: {
    viewOthersInfluencers: boolean;
    viewOthersCollaborations: boolean;
    viewOthersPerformance: boolean;
    viewTeamData: boolean;
    viewRanking: boolean;
  };
  operations: {
    manageInfluencers: boolean;
    manageSamples: boolean;
    manageCollaborations: boolean;
    deleteCollaborations: boolean;
    exportData: boolean;
    batchOperations: boolean;
  };
  advanced: {
    viewCostData: boolean;
    viewROIData: boolean;
    modifyOthersData: boolean;
  };
}
```

#### ç”¨æˆ·åå¥½è®¾ç½®ç»“æ„
```typescript
interface UserPreferences {
  dashboard: {
    layout: DashboardLayout;
    defaultPeriod: 'week' | 'month' | 'quarter';
  };
  filters: {
    saved: SavedFilter[];
  };
  notifications: {
    email: boolean;
    push: boolean;
    dailySummary: boolean;
  };
}
```


---

## ğŸ”Œ API è®¾è®¡

### å·¥å‚è€æ¿ç«¯ API

#### æ•°æ®å¯è§†åŒ– API
```typescript
// è·å–è¶‹åŠ¿æ•°æ®
GET /api/reports/dashboard/trends
Query: {
  period: 'week' | 'month' | 'quarter'
  dataType: 'gmv' | 'cost' | 'roi'
}
Response: {
  success: boolean;
  data: {
    current: TrendData[];
    previous: TrendData[];
    comparison: {
      change: number;
      percentage: number;
    };
  };
}

// è·å– ROI åˆ†ææ•°æ®
GET /api/reports/dashboard/roi-analysis
Response: {
  success: boolean;
  data: {
    byStaff: StaffROIData[];
    costBreakdown: CostBreakdown;
    costVsRevenue: ScatterData[];
  };
}

// è·å–ç®¡é“æ¼æ–—æ•°æ®
GET /api/reports/dashboard/pipeline-funnel
Response: {
  success: boolean;
  data: {
    stages: PipelineStageData[];
    conversionRates: number[];
    avgDuration: number[];
  };
}
```

#### å•†åŠ¡ç»©æ•ˆåˆ†æ API
```typescript
// è·å–å•†åŠ¡å¯¹æ¯”æ•°æ®
GET /api/reports/staff/comparison
Query: {
  staffIds: string[];
  metrics: string[];
}
Response: {
  success: boolean;
  data: {
    comparison: StaffComparisonData[];
    insights: string[];
  };
}

// è·å–å•†åŠ¡è´¨é‡è¯„åˆ†
GET /api/reports/staff/:staffId/quality-score
Response: {
  success: boolean;
  data: {
    overall: number;
    breakdown: ScoreBreakdown;
    trend: ScoreTrend[];
    suggestions: string[];
  };
}

// è·å–å•†åŠ¡å·¥ä½œæ—¥å†
GET /api/reports/staff/:staffId/calendar
Query: {
  month: string; // YYYY-MM
}
Response: {
  success: boolean;
  data: {
    events: CalendarEvent[];
    workload: WorkloadData[];
  };
}
```

#### å¿«æ·æ“ä½œ API
```typescript
// è·å–æ¯æ—¥æ‘˜è¦
GET /api/reports/dashboard/daily-summary
Response: {
  success: boolean;
  data: {
    overdueCollaborations: number;
    pendingSamples: number;
    pendingResults: number;
    alerts: Alert[];
    highlights: string[];
  };
}

// è·å–é¢„è­¦ä¿¡æ¯
GET /api/reports/dashboard/alerts
Response: {
  success: boolean;
  data: {
    alerts: Alert[];
  };
}

// ä¿å­˜çœ‹æ¿å¸ƒå±€
POST /api/users/dashboard-layout
Body: {
  layout: DashboardLayout;
}
Response: {
  success: boolean;
}
```


#### â­ æƒé™ç®¡ç† API
```typescript
// è·å–å•†åŠ¡æƒé™
GET /api/staff/:staffId/permissions
Response: {
  success: boolean;
  data: {
    permissions: StaffPermissions;
    template: 'basic' | 'advanced' | 'supervisor' | 'custom';
  };
}

// æ›´æ–°å•†åŠ¡æƒé™
PUT /api/staff/:staffId/permissions
Body: {
  permissions: StaffPermissions;
}
Response: {
  success: boolean;
  data: {
    user: User;
  };
}

// è·å–æƒé™æ¨¡æ¿
GET /api/staff/permission-templates
Response: {
  success: boolean;
  data: {
    templates: PermissionTemplate[];
  };
}
```

### å•†åŠ¡äººå‘˜ç«¯ API

#### è¾¾äººç®¡ç†ä¼˜åŒ– API
```typescript
// è·å–è¾¾äººåˆä½œå†å²
GET /api/influencers/:id/collaboration-history
Response: {
  success: boolean;
  data: {
    collaborations: Collaboration[];
    stats: CollaborationStats;
  };
}

// è·å–è¾¾äºº ROI ç»Ÿè®¡
GET /api/influencers/:id/roi-stats
Response: {
  success: boolean;
  data: {
    avgROI: number;
    totalGMV: number;
    totalCost: number;
    bestSample: Sample;
  };
}

// åˆ›å»º/æ›´æ–°è¾¾äººåˆ†ç»„
POST /api/influencers/groups
Body: {
  name: string;
  color: string;
  influencerIds: string[];
}
Response: {
  success: boolean;
  data: {
    group: InfluencerGroup;
  };
}
```

#### è·Ÿè¿›æµç¨‹ä¼˜åŒ– API
```typescript
// è·å–è·Ÿè¿›æ¨¡æ¿
GET /api/collaborations/follow-up-templates
Response: {
  success: boolean;
  data: {
    templates: FollowUpTemplate[];
  };
}

// å¿«é€Ÿè·Ÿè¿›
POST /api/collaborations/:id/follow-up/quick
Body: {
  content: string;
  images?: string[];
  voiceNote?: string;
}
Response: {
  success: boolean;
  data: {
    followUp: FollowUpRecord;
  };
}

// è·å–è·Ÿè¿›åˆ†æ
GET /api/collaborations/follow-up-analytics
Query: {
  staffId: string;
  period: 'week' | 'month' | 'quarter';
}
Response: {
  success: boolean;
  data: {
    analytics: FollowUpAnalytics;
  };
}
```

#### æ•°æ®å½•å…¥ä¼˜åŒ– API
```typescript
// è·å–æ™ºèƒ½å»ºè®®
GET /api/collaborations/suggestions
Query: {
  influencerId: string;
  type: 'sample' | 'price' | 'schedule';
}
Response: {
  success: boolean;
  data: {
    suggestions: Suggestion[];
  };
}

// æ‰¹é‡æ›´æ–°
POST /api/collaborations/batch-update
Body: {
  ids: string[];
  operation: 'dispatch' | 'updateStage' | 'setDeadline';
  data: any;
}
Response: {
  success: boolean;
  data: {
    updated: number;
    failed: number;
    errors: Error[];
  };
}

// æ•°æ®éªŒè¯
POST /api/collaborations/validate
Body: {
  data: any;
}
Response: {
  success: boolean;
  data: {
    isValid: boolean;
    errors: ValidationError[];
    warnings: ValidationWarning[];
  };
}
```

#### å·¥ä½œå°ä¼˜åŒ– API
```typescript
// è·å–ä»Šæ—¥å¾…åŠ
GET /api/reports/my-dashboard/today-todos
Response: {
  success: boolean;
  data: {
    todos: TodoItem[];
    summary: {
      total: number;
      completed: number;
      overdue: number;
    };
  };
}

// è·å–å·¥ä½œç»Ÿè®¡
GET /api/reports/my-dashboard/work-stats
Query: {
  period: 'today' | 'week' | 'month';
}
Response: {
  success: boolean;
  data: {
    stats: WorkStats;
    trend: TrendData[];
  };
}
```


---

## ğŸ” æƒé™éªŒè¯è®¾è®¡

### æƒé™ä¸­é—´ä»¶

```typescript
// packages/backend/src/middleware/permission.middleware.ts

export const checkPermission = (permission: string) => {
  return async (req: Request, res: Response, next: NextFunction) => {
    const user = req.user;
    
    // å·¥å‚è€æ¿æ‹¥æœ‰æ‰€æœ‰æƒé™
    if (user.role === 'FACTORY_OWNER') {
      return next();
    }
    
    // å¹³å°ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™
    if (user.role === 'PLATFORM_ADMIN') {
      return next();
    }
    
    // æ£€æŸ¥å•†åŠ¡æƒé™
    if (user.role === 'BUSINESS_STAFF') {
      const permissions = user.permissions as StaffPermissions;
      
      if (!hasPermission(permissions, permission)) {
        return res.status(403).json({
          success: false,
          error: {
            code: 'PERMISSION_DENIED',
            message: 'æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ'
          }
        });
      }
    }
    
    next();
  };
};

function hasPermission(permissions: StaffPermissions, permission: string): boolean {
  const [category, key] = permission.split('.');
  
  if (!permissions || !permissions[category]) {
    return false;
  }
  
  return permissions[category][key] ?? false;
}
```

### æ•°æ®è¿‡æ»¤ä¸­é—´ä»¶

```typescript
// packages/backend/src/middleware/data-filter.middleware.ts

export const filterByPermission = (permission: string) => {
  return async (req: Request, res: Response, next: NextFunction) => {
    const user = req.user;
    
    // å·¥å‚è€æ¿å’Œå¹³å°ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®
    if (user.role === 'FACTORY_OWNER' || user.role === 'PLATFORM_ADMIN') {
      return next();
    }
    
    // å•†åŠ¡äººå‘˜æ ¹æ®æƒé™è¿‡æ»¤æ•°æ®
    if (user.role === 'BUSINESS_STAFF') {
      const permissions = user.permissions as StaffPermissions;
      
      // å¦‚æœæ²¡æœ‰æŸ¥çœ‹å…¶ä»–å•†åŠ¡æ•°æ®çš„æƒé™ï¼Œåªè¿”å›è‡ªå·±çš„æ•°æ®
      if (permission === 'viewOthersInfluencers' && 
          !permissions.dataVisibility.viewOthersInfluencers) {
        req.query.createdBy = user.id;
      }
      
      if (permission === 'viewOthersCollaborations' && 
          !permissions.dataVisibility.viewOthersCollaborations) {
        req.query.businessStaffId = user.id;
      }
    }
    
    next();
  };
};
```

### è·¯ç”±åº”ç”¨ç¤ºä¾‹

```typescript
// packages/backend/src/routes/influencer.routes.ts

import { checkPermission, filterByPermission } from '../middleware/permission.middleware';

// æŸ¥çœ‹è¾¾äººåˆ—è¡¨ - æ ¹æ®æƒé™è¿‡æ»¤
router.get('/', 
  authenticateToken,
  filterByPermission('viewOthersInfluencers'),
  getInfluencers
);

// åˆ›å»ºè¾¾äºº - éœ€è¦æƒé™
router.post('/',
  authenticateToken,
  checkPermission('operations.manageInfluencers'),
  createInfluencer
);

// åˆ é™¤è¾¾äºº - éœ€è¦æƒé™
router.delete('/:id',
  authenticateToken,
  checkPermission('operations.manageInfluencers'),
  deleteInfluencer
);

// æ ·å“ç®¡ç†è·¯ç”±
router.post('/samples',
  authenticateToken,
  checkPermission('operations.manageSamples'),
  createSample
);

// æŸ¥çœ‹æˆæœ¬æ•°æ® - éœ€è¦é«˜çº§æƒé™
router.get('/costs',
  authenticateToken,
  checkPermission('advanced.viewCostData'),
  getCosts
);
```


---

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…è®¾è®¡

### å“åº”å¼æ–­ç‚¹

```typescript
const breakpoints = {
  xs: 0,      // æ‰‹æœºç«–å±
  sm: 576,    // æ‰‹æœºæ¨ªå±
  md: 768,    // å¹³æ¿ç«–å±
  lg: 992,    // å¹³æ¿æ¨ªå±
  xl: 1200,   // æ¡Œé¢
  xxl: 1600,  // å¤§å±
};
```

### ç§»åŠ¨ç«¯å¸ƒå±€ç­–ç•¥

**å·¥å‚è€æ¿ç«¯ Dashboard**:
- æ¡Œé¢ç«¯ï¼š3-4åˆ—å¡ç‰‡å¸ƒå±€
- å¹³æ¿ç«¯ï¼š2åˆ—å¡ç‰‡å¸ƒå±€
- æ‰‹æœºç«¯ï¼š1åˆ—å¡ç‰‡å¸ƒå±€ï¼Œå¯æŠ˜å è¯¦æƒ…

**å•†åŠ¡äººå‘˜ç«¯å·¥ä½œå°**:
- æ¡Œé¢ç«¯ï¼šå·¦ä¾§å¾…åŠåˆ—è¡¨ + å³ä¾§è¯¦æƒ…
- å¹³æ¿ç«¯ï¼šä¸Šä¸‹å¸ƒå±€
- æ‰‹æœºç«¯ï¼šå•é¡µé¢åˆ‡æ¢ï¼Œåº•éƒ¨å¯¼èˆª

### ç§»åŠ¨ç«¯ä¸“å±åŠŸèƒ½

```typescript
// ä¸‹æ‹‰åˆ·æ–°
const usePullToRefresh = (onRefresh: () => Promise<void>) => {
  const [refreshing, setRefreshing] = useState(false);
  
  const handleRefresh = async () => {
    setRefreshing(true);
    await onRefresh();
    setRefreshing(false);
  };
  
  return { refreshing, handleRefresh };
};

// æ‰‹åŠ¿æ“ä½œ
const useSwipeGesture = (onSwipeLeft?: () => void, onSwipeRight?: () => void) => {
  // å®ç°æ»‘åŠ¨æ‰‹åŠ¿
};

// è§¦æ‘¸ä¼˜åŒ–
const touchOptimization = {
  minTouchTarget: 44, // æœ€å°è§¦æ‘¸ç›®æ ‡ 44x44px
  spacing: 8,         // è§¦æ‘¸ç›®æ ‡é—´è·
};
```

---

## ğŸ¨ UI/UX è®¾è®¡è§„èŒƒ

### é¢œè‰²ç³»ç»Ÿ

```typescript
const colors = {
  primary: '#1890ff',
  success: '#52c41a',
  warning: '#faad14',
  error: '#ff4d4f',
  info: '#1890ff',
  
  // æ•°æ®å¯è§†åŒ–é¢œè‰²
  chart: {
    blue: '#1890ff',
    green: '#52c41a',
    orange: '#faad14',
    red: '#ff4d4f',
    purple: '#722ed1',
    cyan: '#13c2c2',
  },
  
  // æƒé™ç›¸å…³é¢œè‰²
  permission: {
    granted: '#52c41a',
    denied: '#ff4d4f',
    partial: '#faad14',
  },
};
```

### å›¾è¡¨æ ·å¼è§„èŒƒ

```typescript
const chartStyles = {
  // æŠ˜çº¿å›¾
  line: {
    strokeWidth: 2,
    dot: { r: 4 },
    activeDot: { r: 6 },
  },
  
  // æŸ±çŠ¶å›¾
  bar: {
    radius: [4, 4, 0, 0],
    barSize: 20,
  },
  
  // é¥¼å›¾
  pie: {
    innerRadius: '60%',
    outerRadius: '80%',
    paddingAngle: 2,
  },
  
  // æ¼æ–—å›¾
  funnel: {
    labelLine: true,
    label: {
      position: 'right',
      formatter: '{b}: {c}',
    },
  },
};
```

### åŠ¨ç”»è§„èŒƒ

```typescript
const animations = {
  // é¡µé¢åˆ‡æ¢
  pageTransition: {
    duration: 300,
    easing: 'ease-in-out',
  },
  
  // å¡ç‰‡å±•å¼€/æŠ˜å 
  cardExpand: {
    duration: 200,
    easing: 'ease-out',
  },
  
  // å›¾è¡¨åŠ¨ç”»
  chartAnimation: {
    duration: 1000,
    easing: 'ease-in-out',
  },
  
  // æƒé™å˜æ›´æç¤º
  permissionChange: {
    duration: 500,
    easing: 'ease-in-out',
  },
};
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### å‰ç«¯æ€§èƒ½ä¼˜åŒ–

**ä»£ç åˆ†å‰²**:
```typescript
// è·¯ç”±çº§åˆ«ä»£ç åˆ†å‰²
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Reports = lazy(() => import('./pages/Reports'));
const Team = lazy(() => import('./pages/Team'));

// ç»„ä»¶çº§åˆ«ä»£ç åˆ†å‰²
const TrendChart = lazy(() => import('./components/charts/TrendChart'));
const ROIAnalysisChart = lazy(() => import('./components/charts/ROIAnalysisChart'));
```

**æ•°æ®ç¼“å­˜**:
```typescript
// ä½¿ç”¨ React Query ç¼“å­˜
const useDashboardData = () => {
  return useQuery({
    queryKey: ['dashboard', 'trends'],
    queryFn: fetchDashboardTrends,
    staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ
    cacheTime: 10 * 60 * 1000, // 10åˆ†é’Ÿ
  });
};
```

**è™šæ‹Ÿæ»šåŠ¨**:
```typescript
// å¤§åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
import { FixedSizeList } from 'react-window';

const InfluencerList = ({ influencers }) => {
  return (
    <FixedSizeList
      height={600}
      itemCount={influencers.length}
      itemSize={80}
      width="100%"
    >
      {({ index, style }) => (
        <div style={style}>
          <InfluencerCard influencer={influencers[index]} />
        </div>
      )}
    </FixedSizeList>
  );
};
```

### åç«¯æ€§èƒ½ä¼˜åŒ–

**æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**:
```typescript
// ä½¿ç”¨ç´¢å¼•
@@index([factoryId, createdBy])
@@index([businessStaffId, stage])

// åˆ†é¡µæŸ¥è¯¢
const getInfluencers = async (page: number, pageSize: number) => {
  const skip = (page - 1) * pageSize;
  
  const [data, total] = await Promise.all([
    prisma.influencer.findMany({
      skip,
      take: pageSize,
      include: {
        creator: { select: { id: true, name: true } },
      },
    }),
    prisma.influencer.count(),
  ]);
  
  return { data, total };
};
```

**ç¼“å­˜ç­–ç•¥**:
```typescript
// Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
const getCachedDashboardData = async (factoryId: string) => {
  const cacheKey = `dashboard:${factoryId}`;
  
  // å°è¯•ä»ç¼“å­˜è·å–
  const cached = await redis.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }
  
  // ä»æ•°æ®åº“æŸ¥è¯¢
  const data = await fetchDashboardData(factoryId);
  
  // å†™å…¥ç¼“å­˜ï¼Œ5åˆ†é’Ÿè¿‡æœŸ
  await redis.setex(cacheKey, 300, JSON.stringify(data));
  
  return data;
};
```


---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

**æƒé™éªŒè¯æµ‹è¯•**:
```typescript
describe('Permission Middleware', () => {
  it('should allow factory owner to access all resources', async () => {
    const req = { user: { role: 'FACTORY_OWNER' } };
    const res = {};
    const next = jest.fn();
    
    await checkPermission('operations.manageSamples')(req, res, next);
    
    expect(next).toHaveBeenCalled();
  });
  
  it('should deny access when permission is missing', async () => {
    const req = { 
      user: { 
        role: 'BUSINESS_STAFF',
        permissions: {
          operations: { manageSamples: false }
        }
      }
    };
    const res = { status: jest.fn().mockReturnThis(), json: jest.fn() };
    const next = jest.fn();
    
    await checkPermission('operations.manageSamples')(req, res, next);
    
    expect(res.status).toHaveBeenCalledWith(403);
    expect(next).not.toHaveBeenCalled();
  });
});
```

**ç»„ä»¶æµ‹è¯•**:
```typescript
describe('StaffPermissionsModal', () => {
  it('should render permission checkboxes', () => {
    const { getByText } = render(
      <StaffPermissionsModal
        visible={true}
        staffId="staff-1"
        currentPermissions={defaultPermissions}
        onSave={jest.fn()}
        onCancel={jest.fn()}
      />
    );
    
    expect(getByText('æŸ¥çœ‹å…¶ä»–å•†åŠ¡çš„è¾¾äººä¿¡æ¯')).toBeInTheDocument();
    expect(getByText('åˆ›å»º/ç¼–è¾‘/åˆ é™¤æ ·å“')).toBeInTheDocument();
  });
  
  it('should apply template when selected', () => {
    const onSave = jest.fn();
    const { getByText } = render(
      <StaffPermissionsModal
        visible={true}
        staffId="staff-1"
        currentPermissions={defaultPermissions}
        onSave={onSave}
        onCancel={jest.fn()}
      />
    );
    
    fireEvent.click(getByText('å›¢é˜Ÿä¸»ç®¡'));
    fireEvent.click(getByText('ä¿å­˜å¹¶åº”ç”¨'));
    
    expect(onSave).toHaveBeenCalledWith(supervisorPermissions);
  });
});
```

### é›†æˆæµ‹è¯•

**æƒé™æµç¨‹æµ‹è¯•**:
```typescript
describe('Permission Flow', () => {
  it('should update permissions and apply immediately', async () => {
    // 1. å·¥å‚è€æ¿ç™»å½•
    const ownerToken = await loginAsFactoryOwner();
    
    // 2. æ›´æ–°å•†åŠ¡æƒé™
    const response = await request(app)
      .put('/api/staff/staff-1/permissions')
      .set('Authorization', `Bearer ${ownerToken}`)
      .send({
        permissions: {
          operations: { manageSamples: true }
        }
      });
    
    expect(response.status).toBe(200);
    
    // 3. å•†åŠ¡ç™»å½•
    const staffToken = await loginAsStaff('staff-1');
    
    // 4. éªŒè¯æƒé™ç”Ÿæ•ˆ
    const samplesResponse = await request(app)
      .post('/api/samples')
      .set('Authorization', `Bearer ${staffToken}`)
      .send({ name: 'Test Sample' });
    
    expect(samplesResponse.status).toBe(201);
  });
});
```

### E2E æµ‹è¯•

**å…³é”®æµç¨‹æµ‹è¯•**:
```typescript
describe('Factory Owner Dashboard E2E', () => {
  it('should display trend charts and allow period switching', async () => {
    await page.goto('http://localhost:5173/app/dashboard');
    await page.waitForSelector('.trend-chart');
    
    // éªŒè¯é»˜è®¤æ˜¾ç¤ºå‘¨æ•°æ®
    expect(await page.textContent('.period-selector')).toContain('7å¤©');
    
    // åˆ‡æ¢åˆ°æœˆæ•°æ®
    await page.click('.period-selector');
    await page.click('text=30å¤©');
    
    // éªŒè¯å›¾è¡¨æ›´æ–°
    await page.waitForSelector('.trend-chart[data-period="month"]');
  });
  
  it('should manage staff permissions', async () => {
    await page.goto('http://localhost:5173/app/team');
    
    // ç‚¹å‡»æƒé™è®¾ç½®
    await page.click('text=æƒé™è®¾ç½®');
    
    // é€‰æ‹©å›¢é˜Ÿä¸»ç®¡æ¨¡æ¿
    await page.click('text=å›¢é˜Ÿä¸»ç®¡');
    
    // ä¿å­˜
    await page.click('text=ä¿å­˜å¹¶åº”ç”¨');
    
    // éªŒè¯æˆåŠŸæç¤º
    await page.waitForSelector('text=æƒé™æ›´æ–°æˆåŠŸ');
  });
});
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ€§èƒ½ç›‘æ§

```typescript
// å‰ç«¯æ€§èƒ½ç›‘æ§
const reportWebVitals = (metric: Metric) => {
  // ä¸ŠæŠ¥åˆ°ç›‘æ§æœåŠ¡
  if (metric.name === 'FCP') {
    console.log('First Contentful Paint:', metric.value);
  }
  if (metric.name === 'LCP') {
    console.log('Largest Contentful Paint:', metric.value);
  }
  if (metric.name === 'CLS') {
    console.log('Cumulative Layout Shift:', metric.value);
  }
};

// API å“åº”æ—¶é—´ç›‘æ§
const apiMonitoring = (req: Request, res: Response, next: NextFunction) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = Date.now() - start;
    console.log(`${req.method} ${req.path} - ${duration}ms`);
    
    // å¦‚æœå“åº”æ—¶é—´è¶…è¿‡500msï¼Œè®°å½•è­¦å‘Š
    if (duration > 500) {
      logger.warn(`Slow API: ${req.method} ${req.path} - ${duration}ms`);
    }
  });
  
  next();
};
```

### æƒé™å®¡è®¡æ—¥å¿—

```typescript
// æƒé™å˜æ›´æ—¥å¿—
const logPermissionChange = async (
  operatorId: string,
  targetUserId: string,
  oldPermissions: StaffPermissions,
  newPermissions: StaffPermissions
) => {
  await prisma.auditLog.create({
    data: {
      type: 'PERMISSION_CHANGE',
      operatorId,
      targetUserId,
      details: {
        old: oldPermissions,
        new: newPermissions,
        changes: getPermissionChanges(oldPermissions, newPermissions),
      },
      timestamp: new Date(),
    },
  });
};

// æƒé™æ‹’ç»æ—¥å¿—
const logPermissionDenied = async (
  userId: string,
  permission: string,
  resource: string
) => {
  await prisma.auditLog.create({
    data: {
      type: 'PERMISSION_DENIED',
      userId,
      details: {
        permission,
        resource,
        timestamp: new Date(),
      },
    },
  });
};
```

---

## ğŸ”„ æ•°æ®è¿ç§»è®¡åˆ’

### è¿ç§»æ­¥éª¤

**Step 1: æ·»åŠ  permissions å­—æ®µ**
```sql
-- æ·»åŠ  permissions å­—æ®µåˆ° User è¡¨
ALTER TABLE "User" ADD COLUMN "permissions" JSONB DEFAULT '{}';

-- æ·»åŠ  preferences å­—æ®µåˆ° User è¡¨
ALTER TABLE "User" ADD COLUMN "preferences" JSONB DEFAULT '{}';
```

**Step 2: åˆå§‹åŒ–é»˜è®¤æƒé™**
```typescript
// ä¸ºæ‰€æœ‰ç°æœ‰å•†åŠ¡äººå‘˜è®¾ç½®é»˜è®¤æƒé™ï¼ˆåŸºç¡€å•†åŠ¡ï¼‰
const initializeDefaultPermissions = async () => {
  const businessStaff = await prisma.user.findMany({
    where: { role: 'BUSINESS_STAFF' },
  });
  
  const defaultPermissions = {
    dataVisibility: {
      viewOthersInfluencers: false,
      viewOthersCollaborations: false,
      viewOthersPerformance: false,
      viewTeamData: true,
      viewRanking: true,
    },
    operations: {
      manageInfluencers: true,
      manageSamples: false,
      manageCollaborations: true,
      deleteCollaborations: false,
      exportData: true,
      batchOperations: true,
    },
    advanced: {
      viewCostData: false,
      viewROIData: true,
      modifyOthersData: false,
    },
  };
  
  for (const staff of businessStaff) {
    await prisma.user.update({
      where: { id: staff.id },
      data: { permissions: defaultPermissions },
    });
  }
};
```

**Step 3: éªŒè¯è¿ç§»**
```typescript
// éªŒè¯æ‰€æœ‰å•†åŠ¡äººå‘˜éƒ½æœ‰æƒé™é…ç½®
const verifyMigration = async () => {
  const staffWithoutPermissions = await prisma.user.count({
    where: {
      role: 'BUSINESS_STAFF',
      permissions: null,
    },
  });
  
  if (staffWithoutPermissions > 0) {
    throw new Error(`${staffWithoutPermissions} staff members missing permissions`);
  }
  
  console.log('Migration verified successfully');
};
```

---

## ğŸ“ æ–‡æ¡£çŠ¶æ€

**è®¾è®¡æ–‡æ¡£**: âœ… å·²å®Œæˆ  
**ä¸‹ä¸€æ­¥**: åˆ›å»ºä»»åŠ¡åˆ†è§£æ–‡æ¡£ï¼ˆtasks.mdï¼‰

