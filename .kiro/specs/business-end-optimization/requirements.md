# 业务端优化 - 需求规格

**创建时间**: 2026年1月6日  
**状态**: 待开始  
**优先级**: 高  
**预计工作量**: 7-11天

---

## 📋 项目概述

优化工厂老板端和商务人员端的用户体验，提升日常使用效率，增强数据可视化和交互体验。重点增加商务权限管理功能，实现数据隔离和精细化权限控制。

---

## 🎯 业务目标

### 工厂老板端目标
1. 提升数据查看效率 50%
2. 缩短决策时间 30%
3. 缩短报表生成时间 60%
4. 实现商务权限精细化管理
5. 提升移动端使用体验

### 商务人员端目标
1. 提升达人管理效率 40%
2. 提升跟进效率 50%
3. 缩短数据录入时间 60%
4. 优化移动端办公体验

---

## 👥 用户角色

### 1. 工厂老板 (FACTORY_OWNER)
**需求**:
- 查看团队整体数据和趋势
- 深度分析商务绩效
- 管理商务权限
- 快速决策和操作
- 移动端查看关键数据

### 2. 商务人员 (BUSINESS_STAFF)
**需求**:
- 高效管理达人
- 简化跟进流程
- 快速录入数据
- 移动端办公支持
- 根据权限访问数据

---

## 📦 功能需求

## 第一部分：工厂老板端优化

### FR-1.1: 增强数据可视化

**优先级**: 高  
**工作量**: 1天

#### 用户故事
```
作为工厂老板
我想要看到GMV和成本的趋势图表
以便更直观地了解业务发展趋势
```

#### 验收标准
- [ ] GMV和成本趋势图支持7天/30天/90天切换
- [ ] 显示同比/环比数据
- [ ] ROI分析图表（柱状图、饼图、散点图）
- [ ] 管道分布漏斗图展示转化率
- [ ] 阶段停留时长分析
- [ ] 所有图表数据准确，加载速度 < 2秒

#### 技术要求
- 使用 recharts 图表库
- 新增 API: `/reports/dashboard/trends`, `/reports/dashboard/roi-analysis`, `/reports/dashboard/pipeline-funnel`
- 支持数据缓存，减少重复请求

---

### FR-1.2: 商务绩效深度分析

**优先级**: 高  
**工作量**: 1天

#### 用户故事
```
作为工厂老板
我想要对比多个商务的绩效
以便识别优秀员工和需要改进的地方
```

#### 验收标准
- [ ] 支持选择2-3个商务进行多维度对比
- [ ] 显示建联数、成交数、GMV、ROI、效率对比
- [ ] 商务工作质量综合评分
- [ ] 评分趋势图
- [ ] 商务工作日历显示工作安排
- [ ] 标注重要节点和工作负载

#### 技术要求
- 新增 API: `/reports/staff/:staffId/comparison`, `/reports/staff/:staffId/quality-score`, `/reports/staff/:staffId/calendar`
- 评分算法考虑跟进频率、转化率、ROI、效率等因素

---

### FR-1.3: 快捷操作和智能提醒

**优先级**: 中  
**工作量**: 1天

#### 用户故事
```
作为工厂老板
我想要快速查看需要关注的事项
以便及时处理重要问题
```

#### 验收标准
- [ ] 一键查看超期合作
- [ ] 一键查看待签收样品
- [ ] 一键查看待录入结果
- [ ] 一键导出报表
- [ ] 每日工作摘要（早上推送）
- [ ] 异常预警（实时推送）
- [ ] 周报/月报自动生成
- [ ] 重要节点提醒
- [ ] 支持自定义看板布局
- [ ] 保存个人偏好设置

#### 技术要求
- 新增 API: `/reports/dashboard/daily-summary`, `/reports/dashboard/alerts`, `POST /users/dashboard-layout`
- 使用 WebSocket 或轮询实现实时提醒
- 使用 react-dnd 实现拖拽布局

---

### FR-1.4: ⭐ 商务账号状态管理（新增）

**优先级**: 高  
**工作量**: 0.5天

#### 用户故事
```
作为工厂老板
我想要临时禁用商务账号
以便在商务休假或暂停工作时阻止其登录
```

#### 业务场景

**场景1: 商务休假**
- 商务人员请假期间，暂时禁用账号
- 休假结束后，重新启用账号

**场景2: 商务离职过渡期**
- 商务人员提出离职，但还在交接期
- 先禁用账号，交接完成后再删除

**场景3: 账号安全**
- 发现账号异常行为，立即禁用
- 调查清楚后再决定是否启用

#### 验收标准
- [ ] 工厂老板可以禁用商务账号
- [ ] 工厂老板可以启用已禁用的商务账号
- [ ] 禁用后商务人员无法登录
- [ ] 禁用后保留所有业务数据（达人、合作记录等）
- [ ] 启用后商务人员可以正常登录
- [ ] 状态变更立即生效
- [ ] 团队管理页面显示账号状态（正常/已禁用）
- [ ] 禁用的账号显示"启用"按钮
- [ ] 正常的账号显示"禁用"按钮

#### 技术要求
- 数据库：User 模型添加 `status` 字段（枚举类型：ACTIVE, DISABLED）
- 后端：登录时验证账号状态
- 后端：新增 API `PUT /staff/:staffId/status`
- 前端：团队管理页面显示状态标签
- 前端：禁用/启用按钮根据状态动态显示

---

### FR-1.5: ⭐ 商务权限管理（新增）

**优先级**: 高  
**工作量**: 2天

#### 用户故事
```
作为工厂老板
我想要控制每个商务能看到和操作的内容
以便保护数据隐私和实现精细化管理
```

#### 业务场景

**场景1: 数据隔离**
- 商务测试002不应该看到商务测试001的达人信息和业绩数据
- 解决方案：通过权限控制，限制商务只能查看自己的数据

**场景2: 样品管理权限**
- 普通商务不应该有权限创建/编辑/删除样品
- 解决方案：只有工厂老板或授权的高级商务才能管理样品

**场景3: 成本数据保密**
- 不希望所有商务都能看到成本数据
- 解决方案：通过权限控制，只有授权人员才能查看成本

**场景4: 团队主管权限**
- 团队主管需要查看所有商务的数据进行管理
- 解决方案：为团队主管配置更高的权限

#### 权限分类

**1. 数据可见性权限**
- `viewOthersInfluencers`: 查看其他商务的达人信息（默认：否）
- `viewOthersCollaborations`: 查看其他商务的合作记录（默认：否）
- `viewOthersPerformance`: 查看其他商务的业绩数据（默认：否）
- `viewTeamData`: 查看团队整体数据（默认：是）
- `viewRanking`: 查看排行榜（默认：是）

**2. 操作权限**
- `manageInfluencers`: 创建/编辑/删除达人（默认：是）
- `manageSamples`: 创建/编辑/删除样品（默认：否）
- `manageCollaborations`: 创建/编辑合作记录（默认：是）
- `deleteCollaborations`: 删除合作记录（默认：否）
- `exportData`: 导出数据（默认：是）
- `batchOperations`: 批量操作（默认：是）

**3. 高级权限**
- `viewCostData`: 查看成本数据（默认：否）
- `viewROIData`: 查看ROI数据（默认：是）
- `modifyOthersData`: 修改其他商务的数据（默认：否）

#### 权限模板

**基础商务（默认）**
- 适用对象：新入职商务、实习生
- 特点：只能管理自己的数据，不能查看其他商务详情，不能管理样品

**高级商务**
- 适用对象：资深商务、业绩优秀的商务
- 特点：可以管理样品，可以查看其他商务业绩（学习用）

**团队主管**
- 适用对象：团队负责人、商务经理
- 特点：可以查看所有数据，拥有最高权限（仅次于工厂老板）

**自定义**
- 适用对象：特殊需求的商务
- 特点：工厂老板自由组合权限

#### 验收标准
- [ ] 工厂老板可以为每个商务设置权限
- [ ] 权限模板可以正常应用
- [ ] 自定义权限可以保存
- [ ] 权限修改后立即生效（无需重新登录）
- [ ] ⭐ 基础商务只能看到自己创建的达人
- [ ] ⭐ 基础商务只能看到自己的合作记录
- [ ] ⭐ 基础商务不能查看其他商务的业绩数据
- [ ] ⭐ 基础商务不能管理样品
- [ ] ⭐ 高级商务可以管理样品
- [ ] ⭐ 高级商务可以查看其他商务的业绩（学习用）
- [ ] ⭐ 团队主管可以查看所有商务的数据
- [ ] ⭐ 团队主管可以修改其他商务的数据
- [ ] 前端隐藏的功能，后端也要验证权限
- [ ] 直接调用 API 也会被权限验证拦截
- [ ] 工厂老板始终拥有所有权限

#### 技术要求
- 数据库：User 模型添加 `permissions` 字段（Json 类型）
- 后端：权限验证中间件 `checkPermission(permission: string)`
- 后端：数据过滤中间件 `filterByPermission(permission: string)`
- 后端：新增 API
  - `GET /staff/:staffId/permissions`
  - `PUT /staff/:staffId/permissions`
  - `GET /staff/permission-templates`
- 后端：⭐ 在达人列表 API 中应用权限过滤
- 后端：⭐ 在合作列表 API 中应用权限过滤
- 后端：⭐ 在样品管理 API 中应用权限验证
- 前端：权限检查 Hook `usePermissions()`
- 前端：权限管理组件 `StaffPermissionsModal`
- 前端：⭐ 根据权限隐藏/显示功能按钮
- 应用权限到所有相关路由和页面

---

### FR-1.6: 移动端适配

**优先级**: 中  
**工作量**: 0.5天

#### 用户故事
```
作为工厂老板
我想要在手机上查看关键数据
以便随时随地了解业务情况
```

#### 验收标准
- [ ] 响应式布局优化
- [ ] 卡片在小屏幕上正常显示
- [ ] 表格转为卡片式展示
- [ ] 图表在移动端正常显示
- [ ] 支持下拉刷新
- [ ] 支持手势操作
- [ ] 优化触摸交互

#### 技术要求
- 使用 antd 响应式栅格系统
- 使用 `useMediaQuery` 检测移动端
- 移动端断点：768px

---

### FR-1.7: 报表导出增强

**优先级**: 低  
**工作量**: 0.5天

#### 用户故事
```
作为工厂老板
我想要导出多种格式的报表
以便分享给其他人或存档
```

#### 验收标准
- [ ] 支持 Excel 导出（已有）
- [ ] 支持 PDF 导出
- [ ] 支持图片导出（PNG/JPG）
- [ ] 支持自定义导出内容
- [ ] 支持选择时间范围
- [ ] 支持选择数据维度
- [ ] 支持定时导出（每日/每周/每月）
- [ ] 支持邮件发送报表

#### 技术要求
- 新增 API: `POST /reports/export/custom`, `POST /reports/export/schedule`
- 使用 jsPDF 生成 PDF
- 使用 html2canvas 生成图片

---

## 第二部分：商务人员端优化

### FR-2.1: 达人管理优化

**优先级**: 高  
**工作量**: 1天

#### 用户故事
```
作为商务人员
我想要快速找到和管理达人
以便提高工作效率
```

#### 验收标准
- [ ] 常用筛选条件可以保存
- [ ] 智能推荐达人（基于历史合作）
- [ ] 支持批量打标签
- [ ] 支持批量导出
- [ ] 达人详情显示合作历史
- [ ] 达人详情显示ROI数据
- [ ] 达人详情显示最佳合作样品
- [ ] 达人详情显示联系记录
- [ ] 支持自定义分组
- [ ] 支持拖拽移动分组
- [ ] 分组统计数据

#### 技术要求
- 新增 API: `/influencers/:id/collaboration-history`, `/influencers/:id/roi-stats`, `POST /influencers/groups`
- 使用 react-dnd 实现拖拽分组

---

### FR-2.2: 跟进流程优化

**优先级**: 高  
**工作量**: 1天

#### 用户故事
```
作为商务人员
我想要快速记录跟进信息
以便节省时间和提高跟进质量
```

#### 验收标准
- [ ] 跟进模板（常用话术）
- [ ] 支持语音输入
- [ ] 支持图片上传
- [ ] 自动记录跟进时间
- [ ] 智能提醒下次跟进时间
- [ ] 显示跟进频率建议
- [ ] 标注长时间未跟进的合作
- [ ] 跟进效果统计
- [ ] 最佳跟进时间分析
- [ ] 最佳跟进频率分析

#### 技术要求
- 新增 API: `/collaborations/follow-up-templates`, `POST /collaborations/:id/follow-up/quick`, `/collaborations/follow-up-analytics`
- 使用 react-speech-recognition 实现语音输入

---

### FR-2.3: 数据录入优化

**优先级**: 中  
**工作量**: 1天

#### 用户故事
```
作为商务人员
我想要减少重复录入
以便节省时间
```

#### 验收标准
- [ ] 自动填充历史数据
- [ ] 智能推荐样品
- [ ] 智能推荐报价
- [ ] 表单数据缓存
- [ ] 支持批量寄样
- [ ] 支持批量更新状态
- [ ] 支持批量设置截止日期
- [ ] 实时数据验证
- [ ] 重复数据检测
- [ ] 异常数据提醒

#### 技术要求
- 新增 API: `/collaborations/suggestions`, `POST /collaborations/batch-update`, `POST /collaborations/validate`
- 使用 localforage 实现表单缓存

---

### FR-2.4: 工作台优化

**优先级**: 中  
**工作量**: 1天

#### 用户故事
```
作为商务人员
我想要看到今日工作清单
以便合理安排工作
```

#### 验收标准
- [ ] 显示今日待办
- [ ] 显示今日目标
- [ ] 显示今日进度
- [ ] 支持快速完成待办
- [ ] 显示今日/本周/本月统计
- [ ] 显示目标完成度
- [ ] 显示排名变化
- [ ] 显示效率分析
- [ ] 快速添加达人入口
- [ ] 快速创建合作入口
- [ ] 快速寄样入口
- [ ] 快速跟进入口

#### 技术要求
- 新增 API: `/reports/my-dashboard/today-todos`, `/reports/my-dashboard/work-stats`

---

### FR-2.5: 移动端专属功能

**优先级**: 低  
**工作量**: 1天

#### 用户故事
```
作为商务人员
我想要在外出时也能办公
以便提高工作灵活性
```

#### 验收标准
- [ ] 扫码添加达人
- [ ] 语音记录跟进
- [ ] 拍照上传样品
- [ ] 位置签到
- [ ] 离线查看达人信息
- [ ] 离线记录跟进
- [ ] 自动同步数据
- [ ] 重要提醒推送
- [ ] 工作进度推送
- [ ] 排名变化推送

#### 技术要求
- 新增 API: `POST /influencers/scan-qrcode`, `POST /collaborations/voice-follow-up`, `POST /samples/upload-photo`
- 使用 localforage 实现离线存储
- 使用 Service Worker 实现离线功能

---

## 🔒 非功能需求

### NFR-1: 性能要求
- 页面加载时间 < 2秒
- API 响应时间 < 500ms
- 图表渲染时间 < 1秒
- 支持 1000+ 达人数据流畅操作

### NFR-2: 安全要求
- 权限验证前后端双重检查
- 敏感数据加密存储
- API 调用需要身份验证
- 防止 SQL 注入和 XSS 攻击

### NFR-3: 可用性要求
- 移动端适配（768px 断点）
- 支持主流浏览器（Chrome, Safari, Edge）
- 操作响应及时，有加载提示
- 错误提示友好，有操作指引

### NFR-4: 可维护性要求
- 代码模块化，组件可复用
- API 接口文档完整
- 关键功能有单元测试
- 代码注释清晰

---

## 📊 成功指标

### 工厂老板端
- 数据查看效率提升 50%
- 决策时间缩短 30%
- 报表生成时间缩短 60%
- 移动端使用率提升 40%
- 用户满意度 ≥ 4.5/5

### 商务人员端
- 达人管理效率提升 40%
- 跟进效率提升 50%
- 数据录入时间缩短 60%
- 移动端使用率提升 50%
- 用户满意度 ≥ 4.5/5

---

## 🚫 范围外

以下功能不在本次优化范围内：
- 平台管理端功能（已完成）
- 达人端口功能（另有规划）
- 小程序开发（另有规划）
- 第三方系统集成
- 多语言支持

---

## 📝 约束条件

### 技术约束
- 使用现有技术栈（React, TypeScript, Prisma, PostgreSQL）
- 不引入新的重型框架
- 保持与现有代码风格一致

### 时间约束
- 总工作量：7-11天
- 第一周：工厂老板端（6天）
- 第二周：商务人员端（5天）

### 资源约束
- 开发人员：1人
- 测试人员：用户自测
- 设计资源：使用 Ant Design 组件库

---

## 🔗 相关文档

- [方案B-业务端优化详细计划.md](../../../方案B-业务端优化详细计划.md)
- [商务权限管理功能规格.md](../../../商务权限管理功能规格.md)
- [数据库 Schema](../../../packages/backend/prisma/schema.prisma)
- [团队管理页面](../../../packages/frontend/src/pages/Team/index.tsx)

---

**文档状态**: ✅ 已创建  
**下一步**: 创建设计文档和任务分解
