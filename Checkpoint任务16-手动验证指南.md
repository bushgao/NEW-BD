# 📋 Checkpoint 任务16 - 手动验证指南

**目的**: 验证商务权限管理系统的各项功能  
**预计时间**: 15-20分钟

---

## 🎯 验证目标

1. ✅ 基础商务权限（只能看自己的数据）
2. ✅ 高级商务权限（可以管理样品）
3. ✅ 团队主管权限（可以看所有数据）
4. ✅ 权限修改立即生效
5. ✅ 前后端权限验证一致性

---

## 📝 测试账号

| 角色 | 邮箱 | 密码 | 权限模板 |
|------|------|------|----------|
| 工厂老板 | owner@demo.com | owner123 | 所有权限 |
| 基础商务 | staff@demo.com | staff123 | 基础商务 |
| 高级商务 | ceshi003@gmail.com | password123 | 高级商务 |
| 团队主管 | ceshi002@gmail.com | password123 | 团队主管 |

---

## 🧪 测试1: 基础商务权限（只能看自己的数据）

### 步骤1: 登录基础商务账号

1. 打开浏览器访问: http://localhost:5173
2. 使用基础商务账号登录:
   ```
   邮箱: staff@demo.com
   密码: staff123
   ```
3. 登录成功后，应该看到商务工作台

### 步骤2: 验证达人数据隔离

1. 点击左侧菜单"达人管理"
2. 查看达人列表
3. **预期结果**:
   - ✅ 只能看到自己创建的达人
   - ✅ 看不到其他商务创建的达人
   - ✅ 达人列表中的"创建人"都是"李商务"

### 步骤3: 验证合作数据隔离

1. 点击左侧菜单"合作管道"
2. 查看合作列表
3. **预期结果**:
   - ✅ 只能看到自己负责的合作
   - ✅ 看不到其他商务的合作
   - ✅ 所有合作的"负责商务"都是"李商务"

### 步骤4: 验证样品管理权限

1. 点击左侧菜单"样品管理"
2. 查看页面顶部的操作按钮
3. **预期结果**:
   - ✅ 看不到"创建样品"按钮
   - ✅ 样品列表中的操作列没有"编辑"和"删除"按钮
   - ✅ 只能查看样品信息

### 步骤5: 验证业绩数据权限

1. 尝试访问其他商务的业绩数据
2. **预期结果**:
   - ✅ 无法查看其他商务的详细业绩
   - ✅ 只能看到自己的工作统计

### ✅ 测试1完成检查清单

- [ ] 只能看到自己创建的达人
- [ ] 只能看到自己负责的合作
- [ ] 无法创建/编辑/删除样品
- [ ] 无法查看其他商务的业绩

---

## 🧪 测试2: 高级商务权限（可以管理样品）

### 步骤1: 登录高级商务账号

1. 退出当前账号
2. 使用高级商务账号登录:
   ```
   邮箱: ceshi003@gmail.com
   密码: password123
   ```

### 步骤2: 验证样品管理权限

1. 点击左侧菜单"样品管理"
2. 查看页面顶部的操作按钮
3. **预期结果**:
   - ✅ 可以看到"创建样品"按钮
   - ✅ 样品列表中有"编辑"和"删除"按钮

### 步骤3: 测试创建样品

1. 点击"创建样品"按钮
2. 填写样品信息:
   ```
   样品名称: 测试样品-高级商务
   SKU: TEST-ADV-001
   单件成本: 100
   建议零售价: 299
   ```
3. 点击"保存"
4. **预期结果**:
   - ✅ 样品创建成功
   - ✅ 样品列表中显示新创建的样品

### 步骤4: 验证业绩查看权限

1. 尝试查看其他商务的业绩数据
2. **预期结果**:
   - ✅ 可以查看其他商务的业绩（学习用）
   - ✅ 可以访问商务对比分析

### 步骤5: 验证数据隔离仍然生效

1. 点击"达人管理"
2. 查看达人列表
3. **预期结果**:
   - ✅ 仍然只能看到自己创建的达人
   - ✅ 数据隔离不受样品权限影响

### ✅ 测试2完成检查清单

- [ ] 可以创建样品
- [ ] 可以编辑样品
- [ ] 可以删除样品
- [ ] 可以查看其他商务业绩
- [ ] 仍然只能看到自己的达人和合作

---

## 🧪 测试3: 团队主管权限（可以看所有数据）

### 步骤1: 登录团队主管账号

1. 退出当前账号
2. 使用团队主管账号登录:
   ```
   邮箱: ceshi002@gmail.com
   密码: password123
   ```

### 步骤2: 验证全局数据访问

1. 点击"达人管理"
2. 查看达人列表
3. **预期结果**:
   - ✅ 可以看到所有商务创建的达人
   - ✅ 达人列表中有不同商务创建的达人
   - ✅ "创建人"列显示不同的商务名称

### 步骤3: 验证合作全局访问

1. 点击"合作管道"
2. 查看合作列表
3. **预期结果**:
   - ✅ 可以看到所有商务的合作
   - ✅ 合作卡片显示不同的负责商务

### 步骤4: 验证样品管理权限

1. 点击"样品管理"
2. **预期结果**:
   - ✅ 可以创建样品
   - ✅ 可以编辑样品
   - ✅ 可以删除样品

### 步骤5: 验证业绩数据访问

1. 查看商务对比分析
2. 查看商务绩效统计
3. **预期结果**:
   - ✅ 可以查看所有商务的业绩
   - ✅ 可以查看成本数据
   - ✅ 可以查看ROI数据

### ✅ 测试3完成检查清单

- [ ] 可以看到所有商务的达人
- [ ] 可以看到所有商务的合作
- [ ] 可以管理样品
- [ ] 可以查看所有商务的业绩
- [ ] 可以查看成本和ROI数据

---

## 🧪 测试4: 权限修改立即生效

### 步骤1: 工厂老板登录

1. 退出当前账号
2. 使用工厂老板账号登录:
   ```
   邮箱: owner@demo.com
   密码: owner123
   ```

### 步骤2: 修改基础商务权限

1. 点击左侧菜单"团队管理"
2. 找到"李商务"（staff@demo.com）
3. 点击操作列的"权限设置"按钮
4. 在权限设置弹窗中:
   - 找到"操作权限"部分
   - 勾选"创建/编辑/删除样品"
5. 点击"保存并应用"
6. **预期结果**:
   - ✅ 显示"权限更新成功"提示
   - ✅ 权限模板变为"自定义"

### 步骤3: 基础商务测试新权限（无需重新登录）

1. 在另一个浏览器标签页（或无痕模式）
2. 使用基础商务账号登录（如果已登录，刷新页面）:
   ```
   邮箱: staff@demo.com
   密码: staff123
   ```
3. 点击"样品管理"
4. **预期结果**:
   - ✅ 现在可以看到"创建样品"按钮
   - ✅ 样品列表中有"编辑"和"删除"按钮
   - ✅ 权限立即生效，无需重新登录

### 步骤4: 测试创建样品

1. 点击"创建样品"按钮
2. 填写样品信息并保存
3. **预期结果**:
   - ✅ 样品创建成功
   - ✅ 新权限正常工作

### 步骤5: 恢复原始权限

1. 切换回工厂老板账号
2. 再次打开"李商务"的权限设置
3. 取消勾选"创建/编辑/删除样品"
4. 点击"保存并应用"
5. 切换回基础商务账号，刷新页面
6. **预期结果**:
   - ✅ "创建样品"按钮立即消失
   - ✅ 权限修改立即生效

### ✅ 测试4完成检查清单

- [ ] 工厂老板可以修改商务权限
- [ ] 权限修改后立即生效
- [ ] 商务无需重新登录
- [ ] 权限恢复后立即生效

---

## 🧪 测试5: 前后端权限验证一致性

### 步骤1: 测试前端权限控制

1. 使用基础商务账号登录
2. 打开浏览器开发者工具（F12）
3. 查看"样品管理"页面
4. **预期结果**:
   - ✅ 前端不显示"创建样品"按钮
   - ✅ 前端根据权限隐藏功能

### 步骤2: 测试后端API拦截

1. 在开发者工具的"Console"标签页
2. 执行以下代码（尝试绕过前端直接调用API）:
   ```javascript
   fetch('http://localhost:3000/api/samples', {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
       'Authorization': 'Bearer ' + localStorage.getItem('token')
     },
     body: JSON.stringify({
       name: '测试样品',
       sku: 'TEST-001',
       cost: 100,
       retailPrice: 299
     })
   })
   .then(res => res.json())
   .then(data => console.log('响应:', data));
   ```
3. **预期结果**:
   - ✅ 返回403 Forbidden错误
   - ✅ 错误信息: "您没有权限执行此操作"
   - ✅ 后端成功拦截未授权请求

### 步骤3: 测试数据过滤

1. 在开发者工具的"Network"标签页
2. 点击"达人管理"，查看API请求
3. 找到 `/api/influencers` 请求
4. 查看响应数据
5. **预期结果**:
   - ✅ 返回的达人都是自己创建的
   - ✅ 后端自动过滤了其他商务的达人
   - ✅ 数据过滤在后端执行

### ✅ 测试5完成检查清单

- [ ] 前端根据权限显示/隐藏功能
- [ ] 后端API拦截未授权请求
- [ ] 直接调用API也会被拦截
- [ ] 数据过滤在后端执行
- [ ] 前后端权限验证一致

---

## 📊 验证结果记录

### 测试1: 基础商务权限
- [ ] 通过 ✅
- [ ] 失败 ❌
- 备注: _______________

### 测试2: 高级商务权限
- [ ] 通过 ✅
- [ ] 失败 ❌
- 备注: _______________

### 测试3: 团队主管权限
- [ ] 通过 ✅
- [ ] 失败 ❌
- 备注: _______________

### 测试4: 权限修改立即生效
- [ ] 通过 ✅
- [ ] 失败 ❌
- 备注: _______________

### 测试5: 前后端权限一致性
- [ ] 通过 ✅
- [ ] 失败 ❌
- 备注: _______________

---

## 🎯 总体评估

**所有测试通过**: [ ] 是 [ ] 否

**发现的问题**:
1. _______________
2. _______________
3. _______________

**建议改进**:
1. _______________
2. _______________
3. _______________

---

## 📝 验证签名

**验证人**: _______________  
**验证日期**: _______________  
**验证结果**: [ ] 通过 [ ] 需要修复

---

## 🆘 遇到问题？

### 无法登录
- 检查邮箱和密码是否正确
- 确认后端服务是否正常运行
- 查看浏览器控制台的错误信息

### 权限不生效
- 刷新页面重新获取用户信息
- 检查后端日志是否有错误
- 确认权限配置是否正确保存

### API调用失败
- 检查后端服务是否正常运行
- 查看Network标签页的请求详情
- 检查token是否有效

---

## 📚 相关文档

- [Day5-Checkpoint任务16验证完成报告.md](./Day5-Checkpoint任务16验证完成报告.md)
- [商务权限管理功能完成报告.md](./商务权限管理功能完成报告.md)
- [商务权限管理功能规格.md](./商务权限管理功能规格.md)

---

**祝测试顺利！** 🎉
