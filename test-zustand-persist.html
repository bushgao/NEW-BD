<!DOCTYPE html>
<html>
<head>
    <title>æµ‹è¯• Zustand Persist é—®é¢˜</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .section {
            background: #252526;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        h2 {
            color: #4ec9b0;
            margin-top: 0;
        }
        pre {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .error {
            color: #f48771;
        }
        .success {
            color: #4ec9b0;
        }
        .warning {
            color: #dcdcaa;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Zustand Persist é—®é¢˜è¯Šæ–­</h1>
    
    <div class="section">
        <h2>1. æ£€æŸ¥ LocalStorage åŸå§‹æ•°æ®</h2>
        <pre id="raw-data"></pre>
    </div>

    <div class="section">
        <h2>2. è§£æåçš„æ•°æ®ç»“æ„</h2>
        <pre id="parsed-data"></pre>
    </div>

    <div class="section">
        <h2>3. Token è¯¦ç»†åˆ†æ</h2>
        <pre id="token-analysis"></pre>
    </div>

    <div class="section">
        <h2>4. é—®é¢˜è¯Šæ–­</h2>
        <pre id="diagnosis"></pre>
    </div>

    <script>
        function analyze() {
            const rawDataEl = document.getElementById('raw-data');
            const parsedDataEl = document.getElementById('parsed-data');
            const tokenAnalysisEl = document.getElementById('token-analysis');
            const diagnosisEl = document.getElementById('diagnosis');

            // 1. è·å–åŸå§‹æ•°æ®
            const rawData = localStorage.getItem('auth-storage');
            if (!rawData) {
                rawDataEl.innerHTML = '<span class="error">âŒ æœªæ‰¾åˆ° auth-storage</span>';
                return;
            }

            rawDataEl.textContent = rawData;

            // 2. è§£ææ•°æ®
            let parsed;
            try {
                parsed = JSON.parse(rawData);
                parsedDataEl.textContent = JSON.stringify(parsed, null, 2);
            } catch (e) {
                parsedDataEl.innerHTML = '<span class="error">âŒ JSON è§£æå¤±è´¥: ' + e.message + '</span>';
                return;
            }

            // 3. Token åˆ†æ
            const state = parsed.state || parsed;
            const token = state.token;
            
            let tokenInfo = '';
            tokenInfo += 'Token å¯¹è±¡å­˜åœ¨: ' + (!!token ? 'âœ… æ˜¯' : 'âŒ å¦') + '\n';
            
            if (token) {
                tokenInfo += '\nToken ç»“æ„:\n';
                tokenInfo += '  - accessToken: ' + (typeof token.accessToken) + '\n';
                tokenInfo += '  - accessToken å€¼: ' + token.accessToken + '\n';
                tokenInfo += '  - accessToken === "null": ' + (token.accessToken === 'null' ? 'âš ï¸ æ˜¯' : 'âœ… å¦') + '\n';
                tokenInfo += '  - accessToken === null: ' + (token.accessToken === null ? 'âš ï¸ æ˜¯' : 'âœ… å¦') + '\n';
                tokenInfo += '  - refreshToken: ' + (typeof token.refreshToken) + '\n';
                tokenInfo += '  - expiresIn: ' + token.expiresIn + '\n';
                
                if (token.accessToken && token.accessToken !== 'null' && token.accessToken !== null) {
                    tokenInfo += '\nâœ… accessToken çœ‹èµ·æ¥æ­£å¸¸\n';
                    tokenInfo += 'é¢„è§ˆ: ' + token.accessToken.substring(0, 50) + '...\n';
                } else {
                    tokenInfo += '\nâŒ accessToken å¼‚å¸¸ï¼\n';
                }
            }
            
            tokenAnalysisEl.textContent = tokenInfo;

            // 4. è¯Šæ–­
            let diagnosis = '';
            
            if (!token) {
                diagnosis += 'âŒ é—®é¢˜ï¼šToken å¯¹è±¡ä¸å­˜åœ¨\n';
                diagnosis += 'å»ºè®®ï¼šé‡æ–°ç™»å½•\n';
            } else if (token.accessToken === 'null') {
                diagnosis += 'âŒ é—®é¢˜ï¼šaccessToken æ˜¯å­—ç¬¦ä¸² "null"\n';
                diagnosis += 'åŸå› ï¼šå¯èƒ½æ˜¯åºåˆ—åŒ–é—®é¢˜ï¼Œæˆ–è€…ç™»å½•æ—¶è¿”å›çš„ token å°±æ˜¯ null\n';
                diagnosis += 'å»ºè®®ï¼š\n';
                diagnosis += '  1. æ£€æŸ¥ç™»å½• API å“åº”\n';
                diagnosis += '  2. æ£€æŸ¥ setAuth å‡½æ•°è°ƒç”¨\n';
                diagnosis += '  3. æ¸…é™¤ LocalStorage å¹¶é‡æ–°ç™»å½•\n';
            } else if (token.accessToken === null) {
                diagnosis += 'âŒ é—®é¢˜ï¼šaccessToken æ˜¯ null\n';
                diagnosis += 'åŸå› ï¼šç™»å½•æ—¶å¯èƒ½æ²¡æœ‰æ­£ç¡®è®¾ç½® token\n';
                diagnosis += 'å»ºè®®ï¼šæ£€æŸ¥ç™»å½•æµç¨‹\n';
            } else if (!token.accessToken) {
                diagnosis += 'âŒ é—®é¢˜ï¼šaccessToken ä¸å­˜åœ¨æˆ–ä¸ºç©º\n';
                diagnosis += 'å»ºè®®ï¼šé‡æ–°ç™»å½•\n';
            } else {
                diagnosis += 'âœ… Token çœ‹èµ·æ¥æ­£å¸¸\n';
                diagnosis += '\nä½†å¦‚æœä»ç„¶æœ‰ 401 é”™è¯¯ï¼Œå¯èƒ½çš„åŸå› ï¼š\n';
                diagnosis += '  1. Token å·²è¿‡æœŸ\n';
                diagnosis += '  2. JWT_SECRET ä¸åŒ¹é…\n';
                diagnosis += '  3. Token æ ¼å¼ä¸æ­£ç¡®\n';
                diagnosis += '  4. åç«¯éªŒè¯é€»è¾‘æœ‰é—®é¢˜\n';
            }
            
            diagnosisEl.textContent = diagnosis;
        }

        // è‡ªåŠ¨æ‰§è¡Œåˆ†æ
        analyze();

        // æ¯ç§’åˆ·æ–°ä¸€æ¬¡
        setInterval(analyze, 1000);
    </script>
</body>
</html>
