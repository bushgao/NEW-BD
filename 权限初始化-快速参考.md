# æƒé™åˆå§‹åŒ– - å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸ºæ–°å•†åŠ¡è´¦å·åˆå§‹åŒ–æƒé™

```bash
cd packages/backend
npx ts-node scripts/init-permissions.ts
```

### éªŒè¯æƒé™é…ç½®

```bash
node verify-permissions-migration.js
```

### æŸ¥çœ‹æ‰€æœ‰è´¦å·

```bash
node check-test-accounts.js
```

---

## ğŸ“‹ é»˜è®¤æƒé™é…ç½®

### åŸºç¡€å•†åŠ¡ï¼ˆé»˜è®¤ï¼‰

```json
{
  "dataVisibility": {
    "viewOthersInfluencers": false,
    "viewOthersCollaborations": false,
    "viewOthersPerformance": false,
    "viewTeamData": true,
    "viewRanking": true
  },
  "operations": {
    "manageInfluencers": true,
    "manageSamples": false,
    "manageCollaborations": true,
    "deleteCollaborations": false,
    "exportData": true,
    "batchOperations": true
  },
  "advanced": {
    "viewCostData": false,
    "viewROIData": true,
    "modifyOthersData": false
  }
}
```

**ç‰¹ç‚¹**:
- âœ… å¯ä»¥ç®¡ç†è‡ªå·±çš„è¾¾äººå’Œåˆä½œ
- âŒ ä¸èƒ½æŸ¥çœ‹å…¶ä»–å•†åŠ¡çš„æ•°æ®
- âŒ ä¸èƒ½ç®¡ç†æ ·å“
- âŒ ä¸èƒ½æŸ¥çœ‹æˆæœ¬æ•°æ®

---

## ğŸ”§ å¸¸è§æ“ä½œ

### 1. æ£€æŸ¥å•†åŠ¡è´¦å·æƒé™çŠ¶æ€

```javascript
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

const staff = await prisma.user.findMany({
  where: { role: 'BUSINESS_STAFF' },
  select: { name: true, email: true, permissions: true }
});
```

### 2. æ‰‹åŠ¨è®¾ç½®æƒé™

```javascript
await prisma.user.update({
  where: { id: 'staff-id' },
  data: {
    permissions: {
      dataVisibility: { ... },
      operations: { ... },
      advanced: { ... }
    }
  }
});
```

### 3. æ‰¹é‡åˆå§‹åŒ–æƒé™

ä½¿ç”¨è¿ç§»è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æŸ¥æ‰¾æ‰€æœ‰å•†åŠ¡è´¦å·
2. è¯†åˆ«æœªé…ç½®æƒé™çš„è´¦å·
3. åº”ç”¨é»˜è®¤æƒé™
4. éªŒè¯ç»“æœ

---

## ğŸ“Š æƒé™æ¨¡æ¿

### åŸºç¡€å•†åŠ¡
- é€‚ç”¨ï¼šæ–°å…¥èŒå•†åŠ¡ã€å®ä¹ ç”Ÿ
- ç‰¹ç‚¹ï¼šåªèƒ½ç®¡ç†è‡ªå·±çš„æ•°æ®

### é«˜çº§å•†åŠ¡
- é€‚ç”¨ï¼šèµ„æ·±å•†åŠ¡ã€ä¸šç»©ä¼˜ç§€çš„å•†åŠ¡
- ç‰¹ç‚¹ï¼šå¯ä»¥ç®¡ç†æ ·å“ï¼Œå¯ä»¥æŸ¥çœ‹å…¶ä»–å•†åŠ¡ä¸šç»©

### å›¢é˜Ÿä¸»ç®¡
- é€‚ç”¨ï¼šå›¢é˜Ÿè´Ÿè´£äººã€å•†åŠ¡ç»ç†
- ç‰¹ç‚¹ï¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å·¥å‚è€æ¿**: å§‹ç»ˆæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œä¸éœ€è¦é…ç½®
2. **å¹³å°ç®¡ç†å‘˜**: å§‹ç»ˆæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œä¸éœ€è¦é…ç½®
3. **æ–°å•†åŠ¡è´¦å·**: åˆ›å»ºåéœ€è¦è¿è¡Œè¿ç§»è„šæœ¬åˆå§‹åŒ–æƒé™
4. **æƒé™ä¿®æ”¹**: é€šè¿‡å‰ç«¯æƒé™ç®¡ç†ç•Œé¢æˆ– API ä¿®æ”¹

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šå•†åŠ¡è´¦å·æ²¡æœ‰æƒé™

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd packages/backend
npx ts-node scripts/init-permissions.ts
```

### é—®é¢˜ï¼šæƒé™é…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ•°æ®åº“ä¸­çš„ `permissions` å­—æ®µ
2. ä½¿ç”¨å·¥å‚è€æ¿è´¦å·åœ¨å‰ç«¯ä¿®æ”¹æƒé™
3. æˆ–æ‰‹åŠ¨æ›´æ–°æ•°æ®åº“

### é—®é¢˜ï¼šéªŒè¯å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
node verify-permissions-migration.js
```
æŸ¥çœ‹è¯¦ç»†çš„éªŒè¯æŠ¥å‘Š

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- è¿ç§»è„šæœ¬: `packages/backend/scripts/init-permissions.ts`
- éªŒè¯è„šæœ¬: `verify-permissions-migration.js`
- è´¦å·æ£€æŸ¥: `check-test-accounts.js`
- æƒé™ç±»å‹: `packages/backend/src/types/permissions.ts`
- æƒé™ä¸­é—´ä»¶: `packages/backend/src/middleware/permission.middleware.ts`

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- å®ŒæˆæŠ¥å‘Š: `ä»»åŠ¡13.2-æƒé™åˆå§‹åŒ–å®ŒæˆæŠ¥å‘Š.md`
- éœ€æ±‚æ–‡æ¡£: `.kiro/specs/business-end-optimization/requirements.md`
- è®¾è®¡æ–‡æ¡£: `.kiro/specs/business-end-optimization/design.md`
