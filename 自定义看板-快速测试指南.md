# 自定义看板功能 - 快速测试指南

## 🚀 前置条件

1. **启动后端服务**
   ```bash
   cd packages/backend
   npm run dev
   ```

2. **启动前端服务**
   ```bash
   cd packages/frontend
   npm run dev
   ```

3. **确保数据库已初始化**
   ```bash
   cd packages/backend
   npx prisma db push
   npx prisma db seed
   ```

---

## 📝 测试步骤

### 步骤 1: 登录工厂老板账号

1. 打开浏览器访问: `http://localhost:5173`
2. 使用以下凭证登录:
   - **邮箱**: `owner@demo.com`
   - **密码**: `owner123`

### 步骤 2: 进入 Dashboard

1. 登录成功后自动进入 Dashboard 页面
2. 你应该能看到所有的看板卡片（共12个）

### 步骤 3: 进入编辑模式

1. 找到页面顶部的控制栏
2. 点击"自定义布局"按钮
3. 观察变化:
   - ✅ 控制栏背景变为蓝色
   - ✅ 显示"编辑模式"文字
   - ✅ 每个卡片右上角出现显示/隐藏开关
   - ✅ 显示操作提示文字

### 步骤 4: 测试拖拽功能

1. 将鼠标悬停在任意卡片上
2. 按住鼠标左键
3. 拖动卡片到新位置
4. 释放鼠标
5. 验证:
   - ✅ 卡片顺序已改变
   - ✅ 拖拽过程中卡片半透明
   - ✅ 释放后卡片恢复正常

### 步骤 5: 测试显示/隐藏功能

1. 找到"趋势图表"卡片
2. 点击右上角的开关，关闭它
3. 观察:
   - ✅ 卡片变为半透明
   - ✅ 开关显示为关闭状态

4. 找到"商务对比分析"卡片
5. 点击右上角的开关，关闭它
6. 观察:
   - ✅ 卡片变为半透明

### 步骤 6: 保存布局

1. 点击"完成编辑"按钮
2. 观察:
   - ✅ 控制栏背景恢复正常
   - ✅ 显示"布局保存成功"提示
   - ✅ 隐藏的卡片完全消失
   - ✅ 卡片右上角的开关消失

### 步骤 7: 验证持久化

1. 刷新页面（F5）
2. 验证:
   - ✅ 卡片顺序保持不变
   - ✅ 隐藏的卡片仍然隐藏
   - ✅ 布局配置已保存

3. 退出登录
4. 重新登录
5. 验证:
   - ✅ 布局配置仍然保持

---

## 🎯 测试检查清单

### 基础功能
- [ ] 能够进入编辑模式
- [ ] 能够退出编辑模式
- [ ] 编辑模式有明显的视觉提示

### 拖拽功能
- [ ] 能够拖拽卡片
- [ ] 拖拽时有视觉反馈
- [ ] 释放后顺序正确更新
- [ ] 拖拽流畅无卡顿

### 显示/隐藏功能
- [ ] 能够隐藏卡片
- [ ] 能够显示卡片
- [ ] 隐藏的卡片在编辑模式下半透明
- [ ] 隐藏的卡片在非编辑模式下完全不显示

### 保存功能
- [ ] 退出编辑模式时自动保存
- [ ] 显示保存成功提示
- [ ] 刷新页面后布局保持
- [ ] 重新登录后布局保持

### 用户体验
- [ ] 操作流畅
- [ ] 提示信息清晰
- [ ] 错误处理完善
- [ ] 界面美观

---

## 🔍 API 测试（可选）

如果你想测试后端 API，可以使用以下方法:

### 1. 使用 Postman 或 curl

#### 获取布局配置
```bash
curl -X GET http://localhost:3000/api/users/dashboard-layout \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

#### 保存布局配置
```bash
curl -X POST http://localhost:3000/api/users/dashboard-layout \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "layout": {
      "cards": [
        {"id": "quota-usage", "visible": true, "order": 0},
        {"id": "key-metrics", "visible": true, "order": 1}
      ]
    }
  }'
```

### 2. 使用浏览器开发者工具

1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 在前端操作自定义看板
4. 观察网络请求:
   - `GET /api/users/dashboard-layout` - 加载布局
   - `POST /api/users/dashboard-layout` - 保存布局

---

## 🐛 常见问题

### 问题 1: 看不到"自定义布局"按钮
**原因**: 可能不是工厂老板账号  
**解决**: 确保使用 `owner@demo.com` 登录

### 问题 2: 拖拽不生效
**原因**: 可能没有进入编辑模式  
**解决**: 点击"自定义布局"按钮进入编辑模式

### 问题 3: 保存后刷新页面布局没有保持
**原因**: 后端 API 可能没有正常工作  
**解决**: 
1. 检查后端服务是否运行
2. 检查浏览器控制台是否有错误
3. 检查 Network 标签中的 API 请求是否成功

### 问题 4: 显示"无效的访问令牌"
**原因**: Token 可能已过期  
**解决**: 退出登录后重新登录

---

## 📊 预期结果

完成所有测试后，你应该能够:

1. ✅ 自由调整看板卡片的顺序
2. ✅ 隐藏不需要的卡片
3. ✅ 显示需要的卡片
4. ✅ 保存自定义的布局
5. ✅ 下次登录时自动加载保存的布局

---

## 🎉 测试完成

如果所有测试都通过，恭喜！自定义看板功能已经可以正常使用了。

如果遇到问题，请检查:
1. 后端服务是否正常运行
2. 前端服务是否正常运行
3. 数据库是否正确初始化
4. 浏览器控制台是否有错误信息

---

## 📝 反馈

如果你发现任何问题或有改进建议，请记录下来：

- 问题描述:
- 复现步骤:
- 预期行为:
- 实际行为:
- 浏览器版本:
- 截图（如有）:
