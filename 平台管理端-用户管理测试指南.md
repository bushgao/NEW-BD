# 平台管理端 - 用户管理功能测试指南

## 功能概述

用户管理功能允许平台管理员查看、搜索、筛选和管理系统中的所有用户，包括平台管理员、工厂老板和商务人员。

## 测试环境

- **前端**: http://localhost:5173
- **后端**: http://localhost:3000
- **测试账号**: admin@example.com / admin123

## 功能清单

### ✅ 已完成功能

1. **用户列表展示**
   - 显示所有用户的基本信息
   - 支持分页（默认每页10条）
   - 显示字段：姓名、邮箱、角色、所属工厂、状态、注册时间、最后登录

2. **搜索功能**
   - 支持按姓名或邮箱搜索
   - 实时搜索

3. **筛选功能**
   - 角色筛选：平台管理员、工厂老板、商务人员
   - 状态筛选：启用、禁用

4. **用户详情查看**
   - 基本信息标签页
   - 工作数据标签页（仅商务人员）
   - 达人列表标签页（仅商务人员）
   - 合作列表标签页（仅商务人员）

5. **用户状态管理**
   - 启用/禁用用户账号
   - 不能禁用平台管理员
   - 不能禁用自己的账号

## 测试步骤

### 1. 访问用户管理页面

1. 使用平台管理员账号登录系统
2. 点击左侧菜单 "👥 用户管理"
3. 确认页面正常加载，显示用户列表

**预期结果**:
- 页面显示用户列表表格
- 显示搜索框和筛选器
- 显示分页控件
- 显示总用户数

### 2. 测试用户列表展示

**测试内容**:
- 查看用户列表是否正确显示
- 检查每个用户的信息是否完整

**预期结果**:
- 显示所有用户的基本信息
- 角色标签颜色正确：
  - 平台管理员：紫色
  - 工厂老板：蓝色
  - 商务人员：绿色
- 状态标签正确：
  - 启用：绿色
  - 禁用：红色

### 3. 测试搜索功能

**测试步骤**:
1. 在搜索框输入用户姓名（如"张三"）
2. 点击搜索按钮或按回车
3. 清空搜索框，再次搜索

**预期结果**:
- 搜索结果只显示匹配的用户
- 支持模糊搜索
- 清空搜索后显示所有用户

### 4. 测试角色筛选

**测试步骤**:
1. 选择"商务人员"角色筛选
2. 确认只显示商务人员
3. 选择"工厂老板"角色筛选
4. 清空筛选，显示所有用户

**预期结果**:
- 筛选结果准确
- 可以清空筛选
- 筛选和搜索可以组合使用

### 5. 测试状态筛选

**测试步骤**:
1. 选择"启用"状态筛选
2. 确认只显示启用的用户
3. 选择"禁用"状态筛选
4. 清空筛选

**预期结果**:
- 状态筛选准确
- 可以与其他筛选条件组合

### 6. 测试用户详情查看

**测试步骤**:
1. 点击任意用户的"详情"按钮
2. 查看"基本信息"标签页
3. 如果是商务人员，查看"工作数据"标签页
4. 查看"达人列表"标签页
5. 查看"合作列表"标签页

**预期结果**:
- 弹出详情模态框
- 基本信息显示完整
- 商务人员显示工作统计数据：
  - 添加达人数
  - 创建合作数
  - 完成合作数
  - 成功率
- 达人列表和合作列表支持分页
- 非商务人员显示"该角色无工作数据统计"

### 7. 测试用户状态切换

**测试步骤**:
1. 找到一个启用状态的非管理员用户
2. 点击"禁用"按钮
3. 确认操作
4. 再次点击"启用"按钮

**预期结果**:
- 成功禁用用户
- 显示成功提示消息
- 用户状态标签更新为"禁用"
- 可以重新启用用户
- 平台管理员账号的禁用按钮不可用
- 不能禁用自己的账号

### 8. 测试分页功能

**测试步骤**:
1. 如果用户总数超过10个，测试翻页
2. 修改每页显示数量
3. 跳转到指定页码

**预期结果**:
- 分页控件正常工作
- 显示总用户数
- 可以修改每页显示数量（10/20/50/100）

### 9. 测试商务人员工作数据

**测试步骤**:
1. 找到一个商务人员用户
2. 点击"详情"按钮
3. 切换到"工作数据"标签页
4. 查看统计数据

**预期结果**:
- 显示4个统计卡片：
  - 添加达人数
  - 创建合作数
  - 完成合作数
  - 成功率（百分比）
- 数据准确无误

### 10. 测试达人列表和合作列表

**测试步骤**:
1. 在商务人员详情中，切换到"达人列表"标签页
2. 查看达人列表
3. 切换到"合作列表"标签页
4. 查看合作列表

**预期结果**:
- 达人列表显示：
  - 达人名称
  - 平台
  - 粉丝数
  - 添加时间
- 合作列表显示：
  - 达人名称
  - 状态
  - 创建时间
  - 完成时间
- 两个列表都支持分页

## API测试

已创建自动化测试脚本 `test-user-management.js`，可以运行以下命令测试：

```bash
node test-user-management.js
```

**测试覆盖**:
- ✅ 用户列表获取
- ✅ 搜索功能
- ✅ 角色筛选
- ✅ 用户详情获取
- ✅ 商务人员工作统计

## 已知问题

无

## 数据库变更

已添加以下字段到 User 模型：
- `isActive`: Boolean (默认 true) - 用户启用状态
- `lastLoginAt`: DateTime? - 最后登录时间
- `disabledAt`: DateTime? - 禁用时间
- `disabledBy`: String? - 禁用操作人ID

迁移文件: `20260106091833_add_user_status_fields`

## 后端API端点

1. `GET /api/platform/users` - 获取用户列表
2. `GET /api/platform/users/:userId` - 获取用户详情
3. `POST /api/platform/users/:userId/toggle-status` - 切换用户状态
4. `GET /api/platform/staff/:staffId/stats` - 获取商务人员工作统计
5. `GET /api/platform/staff/:staffId/influencers` - 获取商务人员的达人列表
6. `GET /api/platform/staff/:staffId/collaborations` - 获取商务人员的合作列表

## 前端组件

1. `packages/frontend/src/pages/Admin/Users.tsx` - 用户列表页面
2. `packages/frontend/src/pages/Admin/UserDetailModal.tsx` - 用户详情模态框
3. `packages/frontend/src/services/platform.service.ts` - API服务层

## 测试完成标准

- [ ] 所有功能正常工作
- [ ] 无TypeScript编译错误
- [ ] 无控制台错误
- [ ] API测试脚本全部通过
- [ ] 用户体验流畅
- [ ] 数据显示准确

## 下一步

完成用户管理功能测试后，可以继续进行：
- 阶段4：数据统计和报表功能
- 或根据实际需求调整优先级
