# 平台管理端达人管理功能 - 测试指南

## 🎯 测试目标

验证平台管理端达人管理功能的完整性，包括来源追踪、认证系统和数据统计。

---

## 📋 测试前准备

### 1. 确认数据库迁移

```bash
# 检查迁移状态
cd packages/backend
npx prisma migrate status
```

应该看到：`Database schema is up to date!`

### 2. 重启后端服务

```bash
cd packages/backend
npm run dev
```

### 3. 准备测试账号

需要以下类型的账号：
- ✅ 平台管理员账号（PLATFORM_ADMIN）
- ✅ 工厂老板账号（FACTORY_OWNER）
- ✅ 商务人员账号（BUSINESS_STAFF）

---

## 🧪 测试用例

### 测试 1: 来源追踪 - 商务添加达人

**目标**: 验证商务人员添加达人时自动记录来源

**步骤**:
1. 使用商务人员账号登录
2. 进入"达人管理"页面
3. 点击"添加达人"
4. 填写达人信息并提交
5. 使用平台管理员账号登录
6. 进入"平台管理" → "达人管理"
7. 找到刚添加的达人，点击"查看"

**预期结果**:
- ✅ 来源类型显示为"商务添加"
- ✅ 添加人显示商务人员姓名
- ✅ 认证状态显示为"未认证"

---

### 测试 2: 来源追踪 - 工厂添加达人

**目标**: 验证工厂老板添加达人时自动记录来源

**步骤**:
1. 使用工厂老板账号登录
2. 进入"达人管理"页面
3. 点击"添加达人"
4. 填写达人信息并提交
5. 使用平台管理员账号登录
6. 查看该达人详情

**预期结果**:
- ✅ 来源类型显示为"工厂添加"
- ✅ 添加人显示工厂老板姓名
- ✅ 认证状态显示为"未认证"

---

### 测试 3: 达人认证 - 通过

**目标**: 验证平台管理员可以通过达人认证

**步骤**:
1. 使用平台管理员账号登录
2. 进入"平台管理" → "达人管理"
3. 筛选"未认证"状态的达人
4. 选择一个达人，点击"认证"
5. 选择"通过"
6. 填写备注："信息真实可靠"
7. 提交认证

**预期结果**:
- ✅ 认证状态变为"已认证"
- ✅ 显示认证时间
- ✅ 显示认证人（平台管理员）
- ✅ 工厂老板收到通知
- ✅ 添加人收到通知（如果不是工厂老板）

---

### 测试 4: 达人认证 - 拒绝

**目标**: 验证平台管理员可以拒绝达人认证

**步骤**:
1. 使用平台管理员账号登录
2. 进入"平台管理" → "达人管理"
3. 选择一个未认证达人，点击"认证"
4. 选择"拒绝"
5. 填写备注："粉丝数不符"
6. 提交认证

**预期结果**:
- ✅ 认证状态变为"认证失败"
- ✅ 显示拒绝原因
- ✅ 工厂老板收到通知（含拒绝原因）
- ✅ 添加人收到通知（含拒绝原因）

---

### 测试 5: 认证历史记录

**目标**: 验证认证历史完整记录

**步骤**:
1. 使用平台管理员账号登录
2. 对同一个达人进行多次认证操作：
   - 第一次：拒绝（"粉丝数不符"）
   - 第二次：通过（"信息已更新，通过认证"）
3. 查看达人详情 → "认证信息"标签页

**预期结果**:
- ✅ 显示完整的认证历史时间线
- ✅ 每条记录包含：操作、时间、操作人、备注
- ✅ 按时间倒序排列（最新的在上）

---

### 测试 6: 多维度筛选

**目标**: 验证达人列表的筛选功能

**步骤**:
1. 使用平台管理员账号登录
2. 进入"平台管理" → "达人管理"
3. 测试各种筛选组合：
   - 按平台筛选（抖音/小红书/快手）
   - 按来源类型筛选（平台/工厂/商务）
   - 按认证状态筛选（未认证/已认证/认证失败）
   - 按工厂筛选
   - 关键词搜索（昵称/账号ID/手机号）

**预期结果**:
- ✅ 每个筛选条件都能正确过滤数据
- ✅ 多个筛选条件可以组合使用
- ✅ 搜索功能正确匹配关键词
- ✅ 分页功能正常

---

### 测试 7: 数据统计

**目标**: 验证统计数据的准确性

**步骤**:
1. 使用平台管理员账号登录
2. 进入"平台管理" → "数据概览"
3. 查看各项统计数据

**预期结果**:
- ✅ 总数统计正确
- ✅ 认证状态分布正确（未认证/已认证/认证失败）
- ✅ 来源分布正确（平台/工厂/商务）
- ✅ 平台分布正确（抖音/小红书/快手等）
- ✅ 工厂排名显示 Top 10
- ✅ 来源质量分析数据合理

---

### 测试 8: 达人详情查看

**目标**: 验证达人详情的完整性

**步骤**:
1. 使用平台管理员账号登录
2. 进入"平台管理" → "达人管理"
3. 点击任意达人的"查看"按钮
4. 依次查看各个标签页

**预期结果**:

**基本信息标签页**:
- ✅ 显示昵称、平台、账号ID
- ✅ 显示粉丝数、手机号、微信号
- ✅ 显示分类和标签
- ✅ 显示备注

**来源信息标签页**:
- ✅ 显示所属工厂
- ✅ 显示来源类型
- ✅ 显示添加人信息
- ✅ 显示添加时间

**认证信息标签页**:
- ✅ 显示当前认证状态
- ✅ 显示认证时间和认证人
- ✅ 显示认证备注
- ✅ 显示认证历史时间线

**合作记录标签页**:
- ✅ 显示历史合作列表
- ✅ 显示合作阶段和状态
- ✅ 显示合作时间

---

### 测试 9: 导出功能

**目标**: 验证达人数据导出

**步骤**:
1. 使用平台管理员账号登录
2. 进入"平台管理" → "达人管理"
3. 设置筛选条件（可选）
4. 点击"导出"按钮
5. 下载并打开 Excel 文件

**预期结果**:
- ✅ 成功下载 Excel 文件
- ✅ 文件包含所有筛选后的达人数据
- ✅ 包含所有必要字段（昵称、平台、来源、认证状态等）
- ✅ 数据格式正确

---

### 测试 10: 权限控制

**目标**: 验证非管理员无法访问平台管理功能

**步骤**:
1. 使用工厂老板或商务人员账号登录
2. 尝试访问平台管理页面

**预期结果**:
- ✅ 侧边栏不显示"平台管理"菜单
- ✅ 直接访问 URL 会被拦截
- ✅ 显示权限不足提示

---

### 测试 11: 通知系统

**目标**: 验证认证通知的发送

**步骤**:
1. 使用平台管理员账号认证一个达人
2. 使用工厂老板账号登录
3. 查看通知中心
4. 如果添加人不是工厂老板，使用添加人账号登录查看通知

**预期结果**:
- ✅ 工厂老板收到认证通知
- ✅ 通知标题清晰（"达人认证通过"或"达人认证失败"）
- ✅ 通知内容包含达人昵称
- ✅ 认证失败时包含拒绝原因
- ✅ 添加人也收到通知（如果不是工厂老板）

---

### 测试 12: 向后兼容性

**目标**: 验证现有功能不受影响

**步骤**:
1. 使用工厂老板或商务人员账号登录
2. 测试原有的达人管理功能：
   - 查看达人列表
   - 添加新达人
   - 编辑达人信息
   - 删除达人
   - 创建合作

**预期结果**:
- ✅ 所有原有功能正常工作
- ✅ 没有报错或异常
- ✅ 用户体验没有变化

---

## 🐛 常见问题排查

### 问题 1: 来源类型显示错误

**症状**: 达人的来源类型不正确

**排查**:
1. 检查添加达人时是否传递了 `userId`
2. 检查后端 `influencer.service.ts` 的 `determineSourceType` 方法
3. 查看数据库中的 `sourceType` 字段值

### 问题 2: 认证操作失败

**症状**: 点击认证按钮后报错

**排查**:
1. 检查用户是否有 `PLATFORM_ADMIN` 角色
2. 检查后端 API `/api/platform/influencers/:id/verify` 是否正常
3. 查看浏览器控制台和后端日志

### 问题 3: 统计数据不准确

**症状**: 统计数据与实际不符

**排查**:
1. 检查后端 `platform.service.ts` 的 `getInfluencerStats` 方法
2. 直接查询数据库验证数据
3. 检查是否有数据缓存问题

### 问题 4: 通知未发送

**症状**: 认证后没有收到通知

**排查**:
1. 检查后端 `platform.service.ts` 的通知创建代码
2. 查看数据库 `Notification` 表
3. 检查前端通知组件是否正常

---

## ✅ 测试检查清单

完成所有测试后，确认以下项目：

### 功能测试
- [ ] 商务添加达人 - 来源追踪正确
- [ ] 工厂添加达人 - 来源追踪正确
- [ ] 达人认证通过 - 状态更新正确
- [ ] 达人认证拒绝 - 状态更新正确
- [ ] 认证历史记录 - 完整准确
- [ ] 多维度筛选 - 功能正常
- [ ] 数据统计 - 数据准确
- [ ] 达人详情 - 信息完整
- [ ] 导出功能 - 正常工作
- [ ] 权限控制 - 正确限制
- [ ] 通知系统 - 正常发送
- [ ] 向后兼容 - 原有功能正常

### 性能测试
- [ ] 达人列表加载速度正常（< 2秒）
- [ ] 筛选响应速度快（< 1秒）
- [ ] 统计数据加载正常（< 3秒）
- [ ] 大量数据时分页正常

### UI/UX 测试
- [ ] 界面布局合理
- [ ] 按钮和操作清晰
- [ ] 错误提示友好
- [ ] 加载状态明确
- [ ] 响应式设计正常

---

## 📊 测试报告模板

测试完成后，可以使用以下模板记录结果：

```markdown
# 平台管理端达人管理功能 - 测试报告

**测试时间**: YYYY-MM-DD
**测试人员**: [姓名]
**测试环境**: [开发/测试/生产]

## 测试结果汇总

- 总测试用例: 12
- 通过: X
- 失败: Y
- 跳过: Z

## 详细测试结果

### 测试 1: 来源追踪 - 商务添加达人
- 状态: ✅ 通过 / ❌ 失败
- 备注: [如有问题，记录详情]

[继续记录其他测试...]

## 发现的问题

1. [问题描述]
   - 严重程度: 高/中/低
   - 复现步骤: [...]
   - 预期结果: [...]
   - 实际结果: [...]

## 建议

[测试过程中的改进建议]
```

---

## 🎉 测试完成

完成所有测试后，如果一切正常，恭喜！平台管理端达人管理功能已经可以正式使用了！

如有任何问题，请参考：
- [功能完成报告](./平台管理端达人管理功能完成报告.md)
- [数据库迁移报告](./平台管理端达人管理-数据库迁移完成.md)
- [快速使用指南](./平台管理端达人管理-快速使用指南.md)
