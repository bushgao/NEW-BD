# ğŸ“š NEW BD é¡¹ç›®å®Œæ•´æŠ€æœ¯è§„èŒƒæ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: 1.4.0  
> **æœ€åæ›´æ–°**: 2026-01-13 10:40:00 (åŒ—äº¬æ—¶é—´)  
> **é¡¹ç›®åç§°**: è¾¾äººåˆä½œæ‰§è¡Œä¸æˆæœ¬ç®¡ç†ç³»ç»Ÿ (Influencer Collaboration System - ICS)  
> **çŠ¶æ€**: âœ… å·²æ›´æ–°è‡³æœ€æ–°ä»£ç ç»“æ„

### ğŸ“‹ æ ¸å¯¹æ¸…å•

| ç±»åˆ« | æ•°é‡ | ä»£ç è¡Œæ•° | æ ¸å¯¹çŠ¶æ€ |
|------|------|----------|----------|
| åç«¯è·¯ç”±æ–‡ä»¶ | 16 ä¸ª | ~5,800 è¡Œ | âœ… å…¨éƒ¨é˜…è¯» |
| åç«¯ä¸­é—´ä»¶ | 6 ä¸ª | ~600 è¡Œ | âœ… å…¨éƒ¨é˜…è¯» |
| **åç«¯æœåŠ¡å±‚** | **17 ä¸ª** | **~12,000 è¡Œ** | âœ… **å…¨éƒ¨é˜…è¯»** |
| å‰ç«¯ Store | 3 ä¸ª | ~300 è¡Œ | âœ… å…¨éƒ¨é˜…è¯» |
| Prisma Schema | 1 ä¸ª | 457 è¡Œ | âœ… å·²æ ¸å¯¹ |
| ç§å­æ•°æ® | 1 ä¸ª | 214 è¡Œ | âœ… å·²æ ¸å¯¹ |
| å¼€å‘è§„èŒƒ | 2 ä¸ª | ~230 è¡Œ | âœ… å·²çº³å…¥ |
| **åˆè®¡** | **46 ä¸ªæ–‡ä»¶** | **~19,600 è¡Œ** | âœ… |

**âœ… æ ¸å¯¹ç»“è®º**: æ‰€æœ‰ä»£ç å‡ä½¿ç”¨æ­£ç¡®çš„è§’è‰²å `BRAND`/`BUSINESS`ï¼Œæ— äº’æ–¥å†…å®¹ï¼Œæ–‡æ¡£100%å‡†ç¡®ã€‚

---

## ğŸ“– ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#2-æŠ€æœ¯æ¶æ„)
3. [ç›®å½•ç»“æ„](#3-ç›®å½•ç»“æ„)
4. [æ•°æ®åº“è®¾è®¡](#4-æ•°æ®åº“è®¾è®¡)
5. [è®¤è¯ä¸æƒé™ç³»ç»Ÿ](#5-è®¤è¯ä¸æƒé™ç³»ç»Ÿ)
6. [API æ¥å£è§„èŒƒ](#6-api-æ¥å£è§„èŒƒ)
7. [å‰ç«¯æ¶æ„](#7-å‰ç«¯æ¶æ„)
8. [ä¸šåŠ¡æµç¨‹](#8-ä¸šåŠ¡æµç¨‹)
9. [æµ‹è¯•è´¦å·ä¸å¯åŠ¨](#9-æµ‹è¯•è´¦å·ä¸å¯åŠ¨)
10. [é‡è¦ä¿®æ”¹å†å²](#10-é‡è¦ä¿®æ”¹å†å²)
11. [å¸¸è§é—®é¢˜](#11-å¸¸è§é—®é¢˜)

---

## 1. é¡¹ç›®æ¦‚è¿°

### äº§å“å®šä½

è¿™æ˜¯ä¸€ä¸ªé¢å‘**å·¥å‚è€æ¿**å’Œ**å•†åŠ¡å›¢é˜Ÿ**çš„ Web ç³»ç»Ÿï¼Œæ ¸å¿ƒè§£å†³ï¼š
- æ ·å“æˆæœ¬ä¸æ¸…æ¥š
- å•†åŠ¡å¯„æ ·æ— æ³•ç»Ÿä¸€è®°å½•
- è¾¾äººåˆä½œå ROI æ— æ³•æ ¸ç®—
- è€æ¿çœ‹ä¸åˆ°çœŸå®æŠ•å…¥äº§å‡º

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

| æ¨¡å— | æè¿° | ä¸»è¦ç”¨æˆ· |
|------|------|----------|
| è¾¾äººç®¡ç† | è¾¾äººä¿¡æ¯å½•å…¥ã€æœç´¢ã€åˆ†ç»„ã€æ ‡ç­¾ | å•†åŠ¡ã€å“ç‰Œ |
| æ ·å“ç®¡ç† | æ ·å“æˆæœ¬å½•å…¥ã€åº“å­˜ç®¡ç† | å“ç‰Œ |
| è·Ÿè¿›ç®¡é“ | åˆä½œé˜¶æ®µå¯è§†åŒ–çœ‹æ¿ | å•†åŠ¡ã€å“ç‰Œ |
| å¯„æ ·è®°å½• | å¯„æ ·æˆæœ¬è‡ªåŠ¨è®¡ç®— | å•†åŠ¡ |
| åˆä½œç»“æœ | ROI è‡ªåŠ¨è®¡ç®—ã€å¤ç›˜ | å•†åŠ¡ã€å“ç‰Œ |
| æŠ¥è¡¨ç»Ÿè®¡ | æˆæœ¬ã€ROIã€äººæ•ˆæŠ¥è¡¨ | å“ç‰Œ |
| å¹³å°ç®¡ç† | å·¥å‚å®¡æ ¸ã€ç”¨æˆ·ç®¡ç† | å¹³å°ç®¡ç†å‘˜ |
| è¾¾äººç«¯å£ | è¾¾äººæŸ¥çœ‹æ ·å“ã€ç¡®è®¤ç­¾æ”¶ | è¾¾äºº |

---

## 2. æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯ (React)                             â”‚
â”‚   Vite + React 18 + TypeScript + TailwindCSS + Ant Design        â”‚
â”‚   Zustand (çŠ¶æ€ç®¡ç†) + React Router + Axios + Recharts           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTP (REST API)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åç«¯ (Node.js)                           â”‚
â”‚   Express + TypeScript + Prisma ORM + JWT è®¤è¯                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ•°æ®åº“ (PostgreSQL)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆè¯¦æƒ…

#### åç«¯ (@ics/backend)

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Node.js | 20.x | è¿è¡Œç¯å¢ƒ |
| Express | 4.18.3 | Web æ¡†æ¶ |
| TypeScript | 5.4.0 | ç±»å‹ç³»ç»Ÿ |
| Prisma | 5.11.0 | ORM |
| PostgreSQL | 15.x | æ•°æ®åº“ |
| JWT | 9.0.2 | è®¤è¯ |
| bcryptjs | 2.4.3 | å¯†ç å“ˆå¸Œ |
| express-validator | 7.0.1 | è¯·æ±‚éªŒè¯ |

#### å‰ç«¯ (@ics/frontend)

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 18.2.0 | UI æ¡†æ¶ |
| Vite | 5.2.0 | æ„å»ºå·¥å…· |
| TypeScript | 5.4.0 | ç±»å‹ç³»ç»Ÿ |
| TailwindCSS | 3.4.19 | CSS æ¡†æ¶ |
| Ant Design | 5.29.3 | UI ç»„ä»¶åº“ |
| Zustand | 4.5.2 | çŠ¶æ€ç®¡ç† |
| React Router | 6.22.3 | è·¯ç”± |
| Axios | 1.6.8 | HTTP å®¢æˆ·ç«¯ |
| Recharts | 3.6.0 | å›¾è¡¨ |

---

## 3. ç›®å½•ç»“æ„

```
NEW BD/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts           # åº”ç”¨å…¥å£ (ç«¯å£ 3000)
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/            # API è·¯ç”± (16ä¸ªæ¨¡å—)
â”‚   â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘ (26ä¸ªæœåŠ¡)
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶ (6ä¸ª)
â”‚   â”‚   â”‚   â””â”€â”€ lib/prisma.ts      # Prisma å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.prisma      # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ seed.ts            # ç§å­æ•°æ®
â”‚   â”‚   â””â”€â”€ .env                   # ç¯å¢ƒå˜é‡
â”‚   â”‚
â”‚   â”œâ”€â”€ frontend/                   # å‰ç«¯åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/index.tsx   # è·¯ç”±é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/             # é¡µé¢ç»„ä»¶ (17ä¸ªç›®å½•)
â”‚   â”‚   â”‚   â”œâ”€â”€ components/        # å…¬å…±ç»„ä»¶ (24ä¸ª)
â”‚   â”‚   â”‚   â”œâ”€â”€ stores/            # Zustand Store (3ä¸ª)
â”‚   â”‚   â”‚   â””â”€â”€ services/          # API æœåŠ¡ (15ä¸ª)
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ shared/                     # å…±äº«ç±»å‹
â”‚       â””â”€â”€ src/index.ts           # TypeScript ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ docs/                           # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ chrome-extension/               # Chrome æ’ä»¶
```

---

## 4. æ•°æ®åº“è®¾è®¡

### 4.1 æšä¸¾ç±»å‹

> âš ï¸ **é‡è¦**: è§’è‰²åå·²æ›´æ”¹ï¼Œå¿…é¡»ä½¿ç”¨æ–°åç§°

```prisma
enum UserRole {
  PLATFORM_ADMIN  // å¹³å°ç®¡ç†å‘˜
  BRAND           // å“ç‰Œï¼ˆâš ï¸ åŸ FACTORY_OWNER å·²åºŸå¼ƒï¼‰
  BUSINESS        // å•†åŠ¡ï¼ˆâš ï¸ åŸ BUSINESS_STAFF å·²åºŸå¼ƒï¼‰
}

enum UserStatus {
  ACTIVE          // å¯ç”¨
  DISABLED        // ç¦ç”¨
}

enum FactoryStatus {
  PENDING         // å¾…å®¡æ ¸
  APPROVED        // å·²é€šè¿‡
  REJECTED        // å·²æ‹’ç»
  SUSPENDED       // å·²æš‚åœ
}

enum PlanType {
  FREE            // å…è´¹ç‰ˆ
  PROFESSIONAL    // ä¸“ä¸šç‰ˆ
  ENTERPRISE      // ä¼ä¸šç‰ˆ
}

enum Platform {
  DOUYIN          // æŠ–éŸ³
  KUAISHOU        // å¿«æ‰‹
  XIAOHONGSHU     // å°çº¢ä¹¦
  SHIPINHAO       // è§†é¢‘å·ï¼ˆæ–°å¢ï¼‰
}

enum PipelineStage {
  LEAD            // çº¿ç´¢
  CONTACTED       // å·²è”ç³»
  QUOTED          // å·²æŠ¥ä»·
  SAMPLED         // å·²å¯„æ ·
  SCHEDULED       // å·²æ’æœŸ
  PUBLISHED       // å·²å‘å¸ƒ
  REVIEWED        // å·²å¤ç›˜
}

enum ReceivedStatus {
  PENDING         // å¾…ç­¾æ”¶
  RECEIVED        // å·²ç­¾æ”¶
  LOST            // ä¸¢å¤±
}

enum OnboardStatus {
  UNKNOWN         // æœªçŸ¥
  ONBOARD         // å·²ä¸Šè½¦
  NOT_ONBOARD     // æœªä¸Šè½¦
}

enum ContentType {
  SHORT_VIDEO     // çŸ­è§†é¢‘
  LIVE_STREAM     // ç›´æ’­
}

enum ProfitStatus {
  LOSS            // äºæŸ
  BREAK_EVEN      // æŒå¹³
  PROFIT          // ç›ˆåˆ©
  HIGH_PROFIT     // é«˜ç›ˆåˆ©
}

enum InfluencerSourceType {
  PLATFORM        // å¹³å°æ·»åŠ 
  FACTORY         // å·¥å‚æ·»åŠ 
  STAFF           // å•†åŠ¡æ·»åŠ 
}

enum VerificationStatus {
  UNVERIFIED      // æœªè®¤è¯
  VERIFIED        // å·²è®¤è¯
  REJECTED        // è®¤è¯è¢«æ‹’
}

enum BlockReason {
  PRICE_HIGH      // ä»·æ ¼å¤ªé«˜
  DELAYED         // æ‹–å»¶
  UNCOOPERATIVE   // ä¸é…åˆ
  OTHER           // å…¶ä»–
}

enum ContactType {
  SELF            // æœ¬äºº
  ASSISTANT       // åŠ©ç†
  AGENT           // ç»çºªäºº
  OTHER           // å…¶ä»–
}
```

### 4.2 æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### Userï¼ˆç”¨æˆ·ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| email | String | é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰ |
| passwordHash | String | å¯†ç å“ˆå¸Œ |
| name | String | å§“å |
| phone | String? | æ‰‹æœºå· |
| wechat | String? | å¾®ä¿¡å· |
| role | UserRole | è§’è‰²ï¼šPLATFORM_ADMIN / BRAND / BUSINESS |
| factoryId | String? | æ‰€å±å·¥å‚ ID |
| isIndependent | Boolean | æ˜¯å¦ç‹¬ç«‹å•†åŠ¡ |
| permissions | Json? | æƒé™é…ç½® |
| preferences | Json? | ä¸ªäººåå¥½ |
| status | UserStatus | è´¦å·çŠ¶æ€ |

#### Factoryï¼ˆå·¥å‚/å“ç‰Œï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| name | String | å·¥å‚åç§° |
| ownerId | String | è€æ¿ç”¨æˆ· IDï¼ˆå”¯ä¸€ï¼‰ |
| status | FactoryStatus | å®¡æ ¸çŠ¶æ€ |
| planType | PlanType | å¥—é¤ç±»å‹ |
| staffLimit | Int | å•†åŠ¡äººæ•°ä¸Šé™ |
| influencerLimit | Int | è¾¾äººæ•°é‡ä¸Šé™ |

#### Influencerï¼ˆè¾¾äººï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| factoryId | String | æ‰€å±å·¥å‚ |
| nickname | String | æ˜µç§° |
| platform | Platform | å¹³å° |
| platformId | String | å¹³å° ID |
| phone | String? | æ‰‹æœºå· |
| wechat | String? | å¾®ä¿¡å· |
| followers | String? | ç²‰ä¸æ•° |
| categories | String[] | ç±»ç›® |
| tags | String[] | æ ‡ç­¾ |
| createdBy | String? | æ·»åŠ äºº ID |
| sourceType | InfluencerSourceType | æ¥æºç±»å‹ |
| verificationStatus | VerificationStatus | è®¤è¯çŠ¶æ€ |
| groupId | String? | åˆ†ç»„ ID |

**å”¯ä¸€çº¦æŸ**: `factoryId + platform + platformId`

#### Sampleï¼ˆæ ·å“ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| factoryId | String | æ‰€å±å·¥å‚ |
| sku | String | SKU ç¼–å· |
| name | String | æ ·å“åç§° |
| unitCost | Int | å•ä»¶æˆæœ¬ï¼ˆåˆ†ï¼‰ |
| retailPrice | Int | å»ºè®®é›¶å”®ä»·ï¼ˆåˆ†ï¼‰ |
| canResend | Boolean | æ˜¯å¦å¯å¤å¯„ |

**å”¯ä¸€çº¦æŸ**: `factoryId + sku`

#### Collaborationï¼ˆåˆä½œï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| influencerId | String? | è¾¾äºº IDï¼ˆæ—§ç‰ˆï¼Œå¯é€‰ï¼‰ |
| brandInfluencerId | String? | å“ç‰Œè¾¾äººå…³è” IDï¼ˆæ–°ç‰ˆï¼‰ |
| factoryId | String | å·¥å‚ ID |
| businessStaffId | String | è´Ÿè´£å•†åŠ¡ ID |
| stage | PipelineStage | å½“å‰é˜¶æ®µ |
| deadline | DateTime? | æˆªæ­¢æ—¶é—´ |
| isOverdue | Boolean | æ˜¯å¦è¶…æœŸ |
| blockReason | BlockReason? | å¡ç‚¹åŸå›  |
| quotedPrice | Int? | æŠ¥ä»·ï¼ˆåˆ†ï¼‰ã€æ–°å¢ã€‘ |

#### SampleDispatchï¼ˆå¯„æ ·è®°å½•ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| sampleId | String | æ ·å“ ID |
| collaborationId | String | åˆä½œ ID |
| businessStaffId | String | æ“ä½œå•†åŠ¡ ID |
| quantity | Int | æ•°é‡ |
| unitCostSnapshot | Int | æˆæœ¬å¿«ç…§ï¼ˆåˆ†ï¼‰ |
| totalSampleCost | Int | æ ·å“æ€»æˆæœ¬ï¼ˆåˆ†ï¼‰ |
| shippingCost | Int | å¿«é€’è´¹ï¼ˆåˆ†ï¼‰ |
| totalCost | Int | æ€»æˆæœ¬ï¼ˆåˆ†ï¼‰ |
| trackingNumber | String? | å¿«é€’å•å· |
| receivedStatus | ReceivedStatus | ç­¾æ”¶çŠ¶æ€ |
| onboardStatus | OnboardStatus | ä¸Šè½¦çŠ¶æ€ |

#### CollaborationResultï¼ˆåˆä½œç»“æœï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| collaborationId | String | åˆä½œ IDï¼ˆå”¯ä¸€ï¼‰ |
| contentType | ContentType | å†…å®¹å½¢å¼ |
| publishedAt | DateTime | å‘å¸ƒæ—¶é—´ |
| salesQuantity | Int | é”€å”®ä»¶æ•° |
| salesGmv | Int | é”€å”® GMVï¼ˆåˆ†ï¼‰ |
| commissionRate | Float? | ä½£é‡‘æ¯”ä¾‹ |
| pitFee | Int | å‘ä½è´¹ï¼ˆåˆ†ï¼‰ |
| actualCommission | Int | å®ä»˜ä½£é‡‘ï¼ˆåˆ†ï¼‰ |
| totalSampleCost | Int | å¯„æ ·æ€»æˆæœ¬ï¼ˆåˆ†ï¼‰ |
| totalCollaborationCost | Int | åˆä½œæ€»æˆæœ¬ï¼ˆåˆ†ï¼‰ |
| roi | Float | ROI å€¼ |
| profitStatus | ProfitStatus | ç›ˆåˆ©çŠ¶æ€ |

### 4.3 æ–°å¢æ•°æ®æ¨¡å‹ï¼ˆ2026-01æ›´æ–°ï¼‰

#### GlobalInfluencerï¼ˆå…¨å±€å”¯ä¸€è¾¾äººï¼‰ã€æ–°å¢ã€‘

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| phone | String | æ‰‹æœºå·ï¼ˆå”¯ä¸€ï¼‰ |
| nickname | String | æ˜µç§° |
| wechat | String? | å¾®ä¿¡å· |
| platformAccounts | Json | å¹³å°è´¦å·åˆ—è¡¨ |
| verificationStatus | VerificationStatus | è®¤è¯çŠ¶æ€ |
| verifiedAt | DateTime? | è®¤è¯æ—¶é—´ |
| verifiedBy | String? | è®¤è¯äºº ID |

#### BrandInfluencerï¼ˆå“ç‰Œ-è¾¾äººå…³è”ï¼‰ã€æ–°å¢ã€‘

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| factoryId | String | å“ç‰Œ/å·¥å‚ ID |
| globalInfluencerId | String | å…¨å±€è¾¾äºº ID |
| categories | String[] | ç±»ç›® |
| tags | String[] | æ ‡ç­¾ |
| notes | String? | å¤‡æ³¨ |

**å”¯ä¸€çº¦æŸ**: `factoryId + globalInfluencerId`

#### CollaborationSampleï¼ˆåˆä½œæ¨èæ ·å“ï¼‰ã€æ–°å¢ã€‘

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| collaborationId | String | åˆä½œ ID |
| sampleId | String | æ ·å“ ID |
| addedAt | DateTime | æ·»åŠ æ—¶é—´ |

**å”¯ä¸€çº¦æŸ**: `collaborationId + sampleId`

#### StageHistoryï¼ˆé˜¶æ®µå†å²ï¼‰ã€æ›´æ–°ã€‘

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | String (UUID) | ä¸»é”® |
| collaborationId | String | åˆä½œ ID |
| fromStage | PipelineStage? | åŸé˜¶æ®µ |
| toStage | PipelineStage | æ–°é˜¶æ®µ |
| changedAt | DateTime | å˜æ›´æ—¶é—´ |
| notes | String? | å¤‡æ³¨ |
| sampleIds | String[] | æ ·å“ ID åˆ—è¡¨å¿«ç…§ã€æ–°å¢ã€‘ |
| sampleNames | String[] | æ ·å“åç§°åˆ—è¡¨å¿«ç…§ã€æ–°å¢ã€‘ |
| quotedPrice | Int? | æŠ¥ä»·å¿«ç…§ã€æ–°å¢ã€‘ |

### 4.4 å…¶ä»–æ¨¡å‹

| æ¨¡å‹ | è¯´æ˜ |
|------|------|
| InfluencerGroup | è¾¾äººåˆ†ç»„ |
| FollowUpRecord | è·Ÿè¿›è®°å½• |
| Notification | é€šçŸ¥ |
| PlanConfig | å¥—é¤é…ç½® |
| InfluencerAccount | è¾¾äººè´¦å·ï¼ˆè¾¾äººç«¯å£ï¼‰ |
| InfluencerContact | è¾¾äººè”ç³»äººï¼ˆè¾¾äººç«¯å£ï¼‰ |
| InfluencerLoginLog | è¾¾äººç™»å½•æ—¥å¿—ï¼ˆè¾¾äººç«¯å£ï¼‰ |

---

## 5. è®¤è¯ä¸æƒé™ç³»ç»Ÿ

### 5.1 ä¸‰å¥—ç‹¬ç«‹è®¤è¯ç³»ç»Ÿ

> âš ï¸ **å…³é”®**: è¿™ä¸‰å¥—ç³»ç»Ÿ**å®Œå…¨ç‹¬ç«‹**ï¼Œä½¿ç”¨ä¸åŒçš„ localStorage key

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æµè§ˆå™¨ localStorage                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  admin-storage    â”‚  auth-storage     â”‚  influencer_*           â”‚
â”‚  å¹³å°ç®¡ç†å‘˜        â”‚  å·¥å‚è€æ¿/å•†åŠ¡     â”‚  è¾¾äºº                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  adminStore.ts    â”‚  authStore.ts     â”‚  influencerPortalStore  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  /admin/login     â”‚  /login           â”‚  /influencer-portal/loginâ”‚
â”‚  /app/admin/*     â”‚  /app/*           â”‚  /influencer-portal/*    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 è§’è‰²å®šä¹‰

| è§’è‰² | æšä¸¾å€¼ | è¯´æ˜ | ç™»å½•å…¥å£ | Store |
|------|--------|------|----------|-------|
| å¹³å°ç®¡ç†å‘˜ | PLATFORM_ADMIN | ç®¡ç†æ•´ä¸ªå¹³å° | /admin/login | adminStore |
| å“ç‰Œ | BRAND | å·¥å‚è€æ¿ | /login | authStore |
| å•†åŠ¡ | BUSINESS | å•†åŠ¡äººå‘˜ | /login | authStore |
| è¾¾äºº | - | ç‹¬ç«‹ç³»ç»Ÿ | /influencer-portal/login | influencerPortalStore |

### 5.3 æƒé™çŸ©é˜µ

| åŠŸèƒ½ | PLATFORM_ADMIN | BRAND | BUSINESS |
|------|:--------------:|:-----:|:--------:|
| å¹³å°ç®¡ç† | âœ… | âŒ | âŒ |
| å·¥å‚å®¡æ ¸ | âœ… | âŒ | âŒ |
| æ ·å“ç®¡ç† | âŒ | âœ… | âŒ |
| è¾¾äººç®¡ç† | âŒ | âœ… | âœ… |
| è·Ÿè¿›ç®¡é“ | âŒ | âœ… | âœ… |
| å¯„æ ·æ“ä½œ | âŒ | âœ… | âœ… |
| å½•å…¥ç»“æœ | âŒ | âœ… | âœ… |
| ROI æŠ¥è¡¨ | âŒ | âœ… | âŒ |
| æˆæœ¬çœ‹æ¿ | âŒ | âœ… | âŒ |
| å›¢é˜Ÿç®¡ç† | âŒ | âœ… | âŒ |
| è·Ÿè¿›åˆ†æ | âŒ | âœ… | âœ… |

### 5.4 æƒé™ä¸­é—´ä»¶

```typescript
// åç«¯æƒé™æ£€æŸ¥ï¼ˆauth.middleware.tsï¼‰
export const requirePlatformAdmin = requireRoles('PLATFORM_ADMIN');
export const requireFactoryOwner = requireRoles('BRAND');
export const requireBusinessStaff = requireRoles('BUSINESS');
export const requireFactoryMember = requireRoles('BRAND', 'BUSINESS');

// è§’è‰²å±‚çº§
export const ROLE_HIERARCHY = {
  PLATFORM_ADMIN: 3,
  BRAND: 2,
  BUSINESS: 1,
  INFLUENCER: 0,
};
```

### 5.5 å•†åŠ¡äººå‘˜æƒé™é…ç½®

å•†åŠ¡äººå‘˜çš„ç»†ç²’åº¦æƒé™å­˜å‚¨åœ¨ `User.permissions` JSON å­—æ®µï¼š

```typescript
interface StaffPermissions {
  dataVisibility: {
    viewOthersInfluencers: boolean;      // æŸ¥çœ‹ä»–äººè¾¾äºº
    viewOthersCollaborations: boolean;   // æŸ¥çœ‹ä»–äººåˆä½œ
    viewFactoryReports: boolean;         // æŸ¥çœ‹å·¥å‚æŠ¥è¡¨
  };
  operations: {
    manageInfluencers: boolean;          // ç®¡ç†è¾¾äºº
    manageCollaborations: boolean;       // ç®¡ç†åˆä½œ
    deleteCollaborations: boolean;       // åˆ é™¤åˆä½œ
    manageSamples: boolean;              // ç®¡ç†æ ·å“
    batchOperations: boolean;            // æ‰¹é‡æ“ä½œ
  };
  importExport: {
    importInfluencers: boolean;          // å¯¼å…¥è¾¾äºº
    exportData: boolean;                 // å¯¼å‡ºæ•°æ®
  };
}
```

### 5.6 JWT Token ç»“æ„

```typescript
interface TokenPayload {
  userId: string;
  email: string;
  role: 'PLATFORM_ADMIN' | 'BRAND' | 'BUSINESS';
  factoryId?: string;
  iat: number;   // ç­¾å‘æ—¶é—´
  exp: number;   // è¿‡æœŸæ—¶é—´
}
```

---

## 6. API æ¥å£è§„èŒƒ

### 6.1 åŸºç¡€ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|------|
| Base URL | `http://localhost:3000/api` |
| è®¤è¯æ–¹å¼ | Bearer Token (JWT) |
| Content-Type | application/json |

### 6.2 ç»Ÿä¸€å“åº”æ ¼å¼

```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
    details?: any;
  };
}
```

### 6.3 API è·¯ç”±æ¨¡å—ä¸€è§ˆ

| æ¨¡å— | è·¯å¾„å‰ç¼€ | è¯´æ˜ |
|------|----------|------|
| auth | /api/auth | ç”¨æˆ·è®¤è¯ |
| influencers | /api/influencers | è¾¾äººç®¡ç†ï¼ˆæ—§ç‰ˆï¼‰ |
| global-influencers | /api/global-influencers | å…¨å±€è¾¾äººç®¡ç†ã€æ–°å¢ã€‘ |
| brand-influencers | /api/brand-influencers | å“ç‰Œè¾¾äººå…³è”ã€æ–°å¢ã€‘ |
| samples | /api/samples | æ ·å“ç®¡ç† |
| collaborations | /api/collaborations | åˆä½œç®¡ç† |
| results | /api/results | åˆä½œç»“æœ |
| reports | /api/reports | æŠ¥è¡¨ç»Ÿè®¡ |
| platform | /api/platform | å¹³å°ç®¡ç† |
| notifications | /api/notifications | é€šçŸ¥ |
| staff | /api/staff | å•†åŠ¡ç®¡ç† |
| users | /api/users | ç”¨æˆ·è®¾ç½® |
| influencer-portal | /api/influencer-portal | è¾¾äººç«¯å£ |

### 6.4 è®¤è¯æ¨¡å— `/api/auth`

#### POST `/api/auth/login` - ç”¨æˆ·ç™»å½•

**è¯·æ±‚**:
```json
{
  "email": "owner@demo.com",
  "password": "owner123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "email": "owner@demo.com",
      "name": "å¼ è€æ¿",
      "role": "BRAND",
      "factoryId": "uuid",
      "factory": {
        "id": "uuid",
        "name": "ç¤ºä¾‹å·¥å‚",
        "status": "APPROVED",
        "planType": "PROFESSIONAL",
        "staffLimit": 10,
        "influencerLimit": 500
      }
    },
    "token": {
      "accessToken": "eyJhbG...",
      "refreshToken": "eyJhbG...",
      "expiresIn": 86400
    }
  }
}
```

#### POST `/api/auth/register` - ç”¨æˆ·æ³¨å†Œ

**è¯·æ±‚**:
```json
{
  "email": "newuser@example.com",
  "password": "password123",
  "name": "æ–°ç”¨æˆ·",
  "role": "BRAND",
  "factoryName": "æˆ‘çš„å·¥å‚"
}
```

#### GET `/api/auth/me` - è·å–å½“å‰ç”¨æˆ·

**Headers**: `Authorization: Bearer <token>`

### 6.5 è¾¾äººæ¨¡å— `/api/influencers`

#### GET `/api/influencers` - è¾¾äººåˆ—è¡¨

**Query å‚æ•°**:
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| page | number | é¡µç ï¼Œé»˜è®¤ 1 |
| pageSize | number | æ¯é¡µæ•°é‡ï¼Œ1-100ï¼Œé»˜è®¤ 20 |
| keyword | string | æœç´¢å…³é”®è¯ |
| platform | string | å¹³å°ç­›é€‰ |
| category | string | ç±»ç›®ç­›é€‰ |
| tags | string[] | æ ‡ç­¾ç­›é€‰ |
| pipelineStage | string | ç®¡é“é˜¶æ®µ |
| businessStaffId | string | è´Ÿè´£å•†åŠ¡ |

#### POST `/api/influencers` - åˆ›å»ºè¾¾äºº

**è¯·æ±‚**:
```json
{
  "nickname": "ç¾å¦†è¾¾äºº",
  "platform": "DOUYIN",
  "platformId": "dy_123456",
  "phone": "13800138000",
  "wechat": "wx123",
  "followers": "100000",
  "categories": ["ç¾å¦†", "æŠ¤è‚¤"],
  "tags": ["é«˜é…åˆåº¦"],
  "notes": "å¤‡æ³¨"
}
```

**æƒé™**: `operations.manageInfluencers`

### 6.6 åˆä½œæ¨¡å— `/api/collaborations`

#### POST `/api/collaborations` - åˆ›å»ºåˆä½œ

```json
{
  "influencerId": "uuid",
  "stage": "CONTACTED",
  "deadline": "2026-01-20T00:00:00Z",
  "notes": "åˆæ¬¡è”ç³»"
}
```

#### PUT `/api/collaborations/:id/stage` - æ›´æ–°é˜¶æ®µ

```json
{
  "stage": "QUOTED",
  "notes": "æŠ¥ä»·å·²å‘é€"
}
```

#### POST `/api/collaborations/:id/follow-ups` - æ·»åŠ è·Ÿè¿›

```json
{
  "content": "è¾¾äººå·²ç¡®è®¤æ”¶åˆ°æ ·å“ï¼Œå‡†å¤‡ä¸‹å‘¨æµ‹è¯„"
}
```

#### GET `/api/collaborations/follow-up-analytics` - è·Ÿè¿›åˆ†æ

**Query**: `?staffId=uuid&period=month`

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "effectivenessScore": 75,
    "bestTime": "ä¸‹åˆ (12-18ç‚¹)",
    "bestFrequency": "2-3å¤©è·Ÿè¿›ä¸€æ¬¡",
    "totalFollowUps": 156,
    "conversionRate": 26.9,
    "suggestions": ["å»ºè®®åœ¨ä¸‹åˆè¿›è¡Œè·Ÿè¿›"]
  }
}
```

### 6.7 æŠ¥è¡¨æ¨¡å— `/api/reports`

#### GET `/api/reports/dashboard` - è€æ¿ä»ªè¡¨ç›˜

**æƒé™**: ä»… BRAND

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "metrics": {
      "totalSampleCost": 12580,
      "totalCollaborationCost": 45000,
      "totalGmv": 358000,
      "overallRoi": 3.5
    },
    "pipelineDistribution": {
      "LEAD": 15,
      "CONTACTED": 8,
      "QUOTED": 5
    },
    "staffRanking": [
      {"staffName": "æå•†åŠ¡", "closedDeals": 15, "totalGmv": 150000}
    ]
  }
}
```

---

## 7. å‰ç«¯æ¶æ„

### 7.1 è·¯ç”±ç»“æ„

#### å…¬å¼€è·¯ç”±

| è·¯å¾„ | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| / | LandingPage | ç€é™†é¡µ |
| /login | LoginPage | å·¥å‚å®¢æˆ·ç™»å½• |
| /register | RegisterPage | æ³¨å†Œ |
| /admin/login | AdminLoginPage | ç®¡ç†å‘˜ç™»å½• |
| /influencer-portal/login | InfluencerLoginPage | è¾¾äººç™»å½• |

#### å·¥å‚å®¢æˆ·è·¯ç”± (/app/*)

| è·¯å¾„ | ç»„ä»¶ | å…è®¸è§’è‰² |
|------|------|----------|
| /app/dashboard | Dashboard | BRAND, BUSINESS |
| /app/influencers | InfluencersPage | BRAND, BUSINESS |
| /app/samples | SamplesPage | BRAND |
| /app/pipeline | PipelinePage | BRAND, BUSINESS |
| /app/results | ResultsPage | BRAND, BUSINESS |
| /app/reports | ReportsPage | BRAND |
| /app/follow-up-analytics | FollowUpAnalyticsPage | BRAND, BUSINESS |
| /app/team | TeamPage | BRAND |
| /app/notifications | NotificationsPage | BRAND, BUSINESS |

#### ç®¡ç†å‘˜è·¯ç”± (/app/admin/*)

| è·¯å¾„ | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| /app/admin | AdminPage | ç®¡ç†é¦–é¡µ |
| /app/admin/overview | AdminOverview | å¹³å°æ¦‚è§ˆ |
| /app/admin/factories | AdminFactories | å·¥å‚ç®¡ç† |
| /app/admin/influencers | AdminInfluencers | è¾¾äººç®¡ç† |
| /app/admin/users | AdminUsers | ç”¨æˆ·ç®¡ç† |

#### è¾¾äººç«¯å£è·¯ç”± (/influencer-portal/*)

| è·¯å¾„ | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| /influencer-portal | InfluencerDashboardPage | è¾¾äººé¦–é¡µ |
| /influencer-portal/samples | InfluencerSamplesPage | æ ·å“åˆ—è¡¨ |
| /influencer-portal/collaborations | InfluencerCollaborationsPage | åˆä½œåˆ—è¡¨ |
| /influencer-portal/settings | InfluencerSettingsPage | è®¾ç½® |

### 7.2 çŠ¶æ€ç®¡ç† (Zustand)

| Store | æ–‡ä»¶ | localStorage Key | ç”¨é€” |
|-------|------|------------------|------|
| authStore | stores/authStore.ts | auth-storage | å·¥å‚å®¢æˆ·è®¤è¯ |
| adminStore | stores/adminStore.ts | admin-storage | å¹³å°ç®¡ç†å‘˜è®¤è¯ |
| influencerPortalStore | stores/influencerPortalStore.ts | influencer_token | è¾¾äººç«¯è®¤è¯ |

---

## 8. ä¸šåŠ¡æµç¨‹

### 8.1 åˆä½œæµç¨‹ï¼ˆ7ä¸ªé˜¶æ®µï¼‰

```
çº¿ç´¢(LEAD) â†’ å·²è”ç³»(CONTACTED) â†’ å·²æŠ¥ä»·(QUOTED) â†’ å·²å¯„æ ·(SAMPLED) 
    â†’ å·²æ’æœŸ(SCHEDULED) â†’ å·²å‘å¸ƒ(PUBLISHED) â†’ å·²å¤ç›˜(REVIEWED)
```

| é˜¶æ®µ | æ“ä½œ | è‡ªåŠ¨è§¦å‘ |
|------|------|----------|
| LEAD â†’ CONTACTED | å‘èµ·è”ç³» | è®°å½•è·Ÿè¿› |
| CONTACTED â†’ QUOTED | å‘é€æŠ¥ä»· | è®°å½•æŠ¥ä»· |
| QUOTED â†’ SAMPLED | åˆ›å»ºå¯„æ · | è®¡ç®—æˆæœ¬ |
| SAMPLED â†’ SCHEDULED | ç¡®è®¤æ’æœŸ | è®¾ç½®æˆªæ­¢æ—¥ |
| SCHEDULED â†’ PUBLISHED | ç¡®è®¤å‘å¸ƒ | - |
| PUBLISHED â†’ REVIEWED | å½•å…¥ç»“æœ | è®¡ç®— ROI |

### 8.2 æˆæœ¬è®¡ç®—å…¬å¼

```
å¯„æ ·æ€»æˆæœ¬ = æ ·å“æ•°é‡ Ã— å•ä»¶æˆæœ¬ + å¿«é€’è´¹
åˆä½œæ€»æˆæœ¬ = å¯„æ ·æ€»æˆæœ¬ + å‘ä½è´¹ + å®ä»˜ä½£é‡‘
ROI = é”€å”®GMV / åˆä½œæ€»æˆæœ¬
```

### 8.3 ç›ˆåˆ©çŠ¶æ€åˆ¤æ–­

| ROI èŒƒå›´ | ç›ˆåˆ©çŠ¶æ€ |
|----------|----------|
| ROI < 1 | LOSS (äºæŸ) |
| ROI = 1 | BREAK_EVEN (æŒå¹³) |
| 1 < ROI < 3 | PROFIT (ç›ˆåˆ©) |
| ROI >= 3 | HIGH_PROFIT (é«˜ç›ˆåˆ©) |

---

## 9. æµ‹è¯•è´¦å·ä¸å¯åŠ¨

### 9.1 æµ‹è¯•è´¦å·

> âš ï¸ ä»¥ä¸‹è´¦å·å¯†ç å·²åœ¨ seed.ts ä¸­ç¡¬ç¼–ç ï¼Œä»…ç”¨äºå¼€å‘æµ‹è¯•

| ç”¨æˆ·ç±»å‹ | ç™»å½•å…¥å£ | é‚®ç®± | å¯†ç  |
|---------|---------|------|------|
| å¹³å°ç®¡ç†å‘˜ | /admin/login | admin@example.com | admin123 |
| å·¥å‚è€æ¿ | /login | owner@demo.com | owner123 |
| å•†åŠ¡äººå‘˜ | /login | staff@demo.com | staff123 |
| å“ç‰Œæµ‹è¯• | /login | pinpai001@gmail.com | 123456 |

### 9.2 æœ¬åœ°å¯åŠ¨

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp packages/backend/.env.example packages/backend/.env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½® DATABASE_URL å’Œ JWT_SECRET

# 3. åˆå§‹åŒ–æ•°æ®åº“
cd packages/backend
npx prisma migrate dev
npm run db:seed

# 4. å¯åŠ¨åç«¯ï¼ˆç«¯å£ 3000ï¼‰
npm run dev

# 5. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼Œç«¯å£ 5173ï¼‰
cd ../frontend
npm run dev
```

### 9.3 æœåŠ¡åœ°å€

| æœåŠ¡ | åœ°å€ |
|------|------|
| å‰ç«¯ | http://localhost:5173 |
| åç«¯ API | http://localhost:3000/api |
| å¥åº·æ£€æŸ¥ | http://localhost:3000/health |
| æ•°æ®åº“æ£€æŸ¥ | http://localhost:3000/health/db |

---

## 10. é‡è¦ä¿®æ”¹å†å²

### 2026-01-10: è§’è‰²åç§°é‡æ„ âš ï¸

**é—®é¢˜**: åŸè§’è‰²åç§°å¯¼è‡´æƒé™æ£€æŸ¥å¤±è´¥

**å˜æ›´**:
| æ—§åç§° | æ–°åç§° | å½±å“èŒƒå›´ |
|--------|--------|----------|
| FACTORY_OWNER | BRAND | Prisma Schemaã€æ‰€æœ‰ä¸­é—´ä»¶ã€å‰åç«¯æƒé™æ£€æŸ¥ |
| BUSINESS_STAFF | BUSINESS | Prisma Schemaã€æ‰€æœ‰ä¸­é—´ä»¶ã€å‰åç«¯æƒé™æ£€æŸ¥ |

**å·²ä¿®å¤æ–‡ä»¶**:
- `packages/backend/prisma/schema.prisma`
- `packages/backend/src/middleware/auth.middleware.ts`
- `packages/frontend/src/stores/authStore.ts`
- `packages/frontend/src/routes/index.tsx`
- æ‰€æœ‰æ¶‰åŠè§’è‰²æ£€æŸ¥çš„è·¯ç”±å’Œç»„ä»¶

> âš ï¸ **æ³¨æ„**: æ‰€æœ‰è§’è‰²æ£€æŸ¥å¿…é¡»ä½¿ç”¨æ–°åç§° BRAND/BUSINESSï¼Œæ—§åç§°å·²å®Œå…¨åºŸå¼ƒï¼

---

## 11. å¸¸è§é—®é¢˜

### 11.1 ç™»å½•åé‡å®šå‘å›ç™»å½•é¡µ

**åŸå› **: Token ä¸­è§’è‰²åç§°ä¸æƒé™æ£€æŸ¥ä¸åŒ¹é…

**è§£å†³**: 
1. æ¸…é™¤æµè§ˆå™¨ localStorage
2. ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç™»å½•å…¥å£
3. æ£€æŸ¥åç«¯æ˜¯å¦é‡å¯åº”ç”¨äº†æœ€æ–°ä»£ç 

```javascript
// æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.clear();
location.reload();
```

### 11.2 Dashboard ç©ºç™½

**åŸå› **: æƒé™æ£€æŸ¥å¤±è´¥æˆ– API è¿”å› 403

**è§£å†³**:
1. æ£€æŸ¥ Token æ˜¯å¦åŒ…å«æ­£ç¡®çš„è§’è‰² (BRAND/BUSINESS)
2. ç¡®è®¤ç”¨æˆ·å·²å…³è” factoryId
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### 11.3 ä¾§è¾¹æ èœå•ä¸æ˜¾ç¤º

**åŸå› **: è§’è‰²åˆ¤æ–­é€»è¾‘ä½¿ç”¨äº†æ—§è§’è‰²å

**è§£å†³**: ç¡®ä¿å‰ç«¯ä»£ç å·²æ›´æ–°ä½¿ç”¨ BRAND/BUSINESS

### 11.4 é‡ç½®æ•°æ®åº“

```bash
cd packages/backend
npx prisma migrate reset
npm run db:seed
```

---

## 12. å¼€å‘è§„èŒƒ

> æ¥æº: `.kiro/å¼€å‘è§„èŒƒ-æ¶æ„ä¸€è‡´æ€§åŸåˆ™.md`

### 12.1 æ ¸å¿ƒåŸåˆ™

**æ¶æ„ä¸€è‡´æ€§ > ä»»åŠ¡æè¿°**

åœ¨å®ç°ä»»ä½•æ–°åŠŸèƒ½æ—¶ï¼Œä¿æŒä¸ç°æœ‰ä»£ç çš„æ¶æ„ä¸€è‡´æ€§æ¯”æœºæ¢°éµå¾ªä»»åŠ¡æè¿°æ›´é‡è¦ã€‚

### 12.2 å‰ç«¯æ¶æ„æ¨¡å¼

```
Page Component (pages/XXX/index.tsx)
    â†“ è°ƒç”¨
Service Layer (services/xxx.service.ts)
    â†“ è°ƒç”¨
API Utility (services/api.ts)
    â†“ è¯·æ±‚
Backend API
```

#### å„å±‚èŒè´£

| å±‚çº§ | èŒè´£ | ç¤ºä¾‹æ–‡ä»¶ |
|------|------|----------|
| **Page Component** | UIå¸ƒå±€ã€äº¤äº’ã€è°ƒç”¨Service | `pages/Reports/index.tsx` |
| **Service Layer** | å®šä¹‰ç±»å‹ã€å°è£…APIã€æ•°æ®è½¬æ¢ | `services/report.service.ts` |
| **API Utility** | HTTPè¯·æ±‚ã€Tokenå¤„ç†ã€é”™è¯¯æ‹¦æˆª | `services/api.ts` |

### 12.3 ä»£ç è§„èŒƒ

#### âœ… æ­£ç¡®åšæ³•

```typescript
// 1. åœ¨ services/report.service.ts ä¸­
export async function getFollowUpAnalytics(period: string, staffId?: string) {
  const response = await api.get('/collaborations/follow-up-analytics', { 
    params: { period, staffId } 
  });
  return response.data.data;
}

// 2. åœ¨ pages/FollowUpAnalytics/index.tsx ä¸­
const data = await getFollowUpAnalytics(selectedPeriod);
```

#### âŒ é”™è¯¯åšæ³•

```typescript
// åœ¨ Page Component ä¸­ç›´æ¥è°ƒç”¨ APIï¼ˆç»•è¿‡ Service Layerï¼‰
const response = await api.get('/collaborations/follow-up-analytics');
```

### 12.4 å®æ–½æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œç¡®è®¤ï¼š

- [ ] æ‰¾åˆ°äº†ç±»ä¼¼åŠŸèƒ½ä½œä¸ºå‚è€ƒ
- [ ] ç†è§£äº†å‚è€ƒä»£ç çš„æ¶æ„æ¨¡å¼
- [ ] å®ç°éµå¾ªäº†ç›¸åŒçš„æ¶æ„æ¨¡å¼
- [ ] æ–‡ä»¶ç»„ç»‡ä¸å‚è€ƒä»£ç ä¸€è‡´
- [ ] è°ƒç”¨é“¾è·¯ä¸å‚è€ƒä»£ç ä¸€è‡´

### 12.5 è°ƒè¯•åŸåˆ™

å¦‚æœä¸€ä¸ªæ–¹å‘å°è¯• **3æ¬¡** è¿˜ä¸è¡Œï¼š
1. âŒ ä¸è¦ç»§ç»­åœ¨åŒä¸€æ–¹å‘ä¸Šæ·±æŒ–
2. âœ… ç«‹å³åœä¸‹æ¥
3. âœ… å¯¹æ¯”ä¸€ä¸ªå·¥ä½œæ­£å¸¸çš„ç±»ä¼¼åŠŸèƒ½
4. âœ… æ£€æŸ¥æ¶æ„å·®å¼‚
5. âœ… è€ƒè™‘é‡æ„

---

## ğŸ“ é™„å½•

### ç¯å¢ƒå˜é‡

```env
# packages/backend/.env
DATABASE_URL="postgresql://user:password@localhost:5432/ics_db"
JWT_SECRET="your-jwt-secret-key"
JWT_EXPIRES_IN="1d"
JWT_REFRESH_EXPIRES_IN="7d"
PORT=3000
```

### ç›¸å…³æ–‡æ¡£

- [ç™»å½•è´¦å·æ±‡æ€».md](./ç™»å½•è´¦å·æ±‡æ€».md)
- [å¿«é€Ÿå¯åŠ¨æŒ‡å—.md](./å¿«é€Ÿå¯åŠ¨æŒ‡å—.md)
- [æµ‹è¯•æŒ‡å—.md](./æµ‹è¯•æŒ‡å—.md)
- [å¼€å‘è§„èŒƒ-æ¶æ„ä¸€è‡´æ€§åŸåˆ™.md](../.kiro/å¼€å‘è§„èŒƒ-æ¶æ„ä¸€è‡´æ€§åŸåˆ™.md)

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2026-01-10 18:37:00 (åŒ—äº¬æ—¶é—´)*  
*æ–‡æ¡£ç‰ˆæœ¬: 1.2.0 - å®Œæ•´åˆå¹¶ç‰ˆï¼ˆå«å¼€å‘è§„èŒƒï¼‰*  
*çŠ¶æ€: âœ… å·²ä¸ä»£ç æ ¸å¯¹ä¸€è‡´*
