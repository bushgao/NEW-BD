<!DOCTYPE html>
<html>
<head>
    <title>ç›´æ¥æµ‹è¯•æ™ºèƒ½å»ºè®®</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1890ff;
            border-bottom: 3px solid #1890ff;
            padding-bottom: 10px;
        }
        .step {
            margin: 20px 0;
            padding: 20px;
            background: #fafafa;
            border-left: 4px solid #1890ff;
            border-radius: 4px;
        }
        .step h3 {
            margin-top: 0;
            color: #1890ff;
        }
        button {
            padding: 10px 24px;
            margin: 5px;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        button:hover {
            background: #40a9ff;
        }
        button:disabled {
            background: #d9d9d9;
            cursor: not-allowed;
        }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        .info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #1890ff;
        }
        .warning {
            background: #fffbe6;
            border: 1px solid #ffe58f;
            color: #faad14;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid #d9d9d9;
        }
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
        }
        .suggestion-card {
            background: white;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .suggestion-card h4 {
            margin: 0 0 10px 0;
            color: #1890ff;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 8px;
        }
        .badge-high {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }
        .badge-medium {
            background: #fff7e6;
            color: #fa8c16;
            border: 1px solid #ffd591;
        }
        .badge-low {
            background: #fafafa;
            color: #8c8c8c;
            border: 1px solid #d9d9d9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª æ™ºèƒ½å»ºè®®åŠŸèƒ½ - ç›´æ¥æµ‹è¯•</h1>
        
        <div class="step">
            <h3>æ­¥éª¤ 1: è·å–è®¤è¯ä¿¡æ¯</h3>
            <button onclick="step1()">ğŸ”‘ è·å– Token</button>
            <div id="step1Result"></div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 2: è·å–è¾¾äººåˆ—è¡¨</h3>
            <button onclick="step2()" id="btn2" disabled>ğŸ‘¥ è·å–è¾¾äººåˆ—è¡¨</button>
            <div id="step2Result"></div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 3: é€‰æ‹©è¾¾äººå¹¶æµ‹è¯•å»ºè®®</h3>
            <select id="influencerSelect" disabled>
                <option value="">è¯·å…ˆè·å–è¾¾äººåˆ—è¡¨</option>
            </select>
            <br><br>
            <button onclick="testAll()" id="btn3" disabled>ğŸš€ æµ‹è¯•å…¨éƒ¨å»ºè®®ï¼ˆæ ·å“+æŠ¥ä»·+æ’æœŸï¼‰</button>
            <div id="step3Result"></div>
        </div>

        <div class="step">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»</h3>
            <div id="summary"></div>
        </div>
    </div>

    <script>
        let token = '';
        let influencers = [];
        let testResults = {
            sample: null,
            price: null,
            schedule: null
        };

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type;
            element.innerHTML = `<div class="result ${className}">${message}</div>`;
        }

        function step1() {
            token = localStorage.getItem('token');
            
            if (token) {
                log('step1Result', `âœ… Token å·²è·å–<br><small>${token.substring(0, 50)}...</small>`, 'success');
                document.getElementById('btn2').disabled = false;
            } else {
                log('step1Result', 'âŒ æœªæ‰¾åˆ° Token<br>è¯·å…ˆç™»å½•ç³»ç»Ÿï¼š<a href="http://localhost:5173" target="_blank">æ‰“å¼€ç™»å½•é¡µé¢</a>', 'error');
            }
        }

        async function step2() {
            log('step2Result', 'â³ æ­£åœ¨è·å–è¾¾äººåˆ—è¡¨...', 'info');
            
            try {
                const response = await fetch('http://localhost:3001/api/influencers?page=1&pageSize=50', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.success && data.data && data.data.data) {
                    influencers = data.data.data;
                    
                    const select = document.getElementById('influencerSelect');
                    select.innerHTML = '<option value="">è¯·é€‰æ‹©è¾¾äºº</option>';
                    select.disabled = false;
                    
                    influencers.forEach(inf => {
                        const option = document.createElement('option');
                        option.value = inf.id;
                        option.textContent = `${inf.nickname} (${inf.platform})`;
                        select.appendChild(option);
                    });

                    log('step2Result', `âœ… æˆåŠŸè·å– ${influencers.length} ä¸ªè¾¾äºº`, 'success');
                    document.getElementById('btn3').disabled = false;
                } else {
                    log('step2Result', `âŒ è·å–å¤±è´¥<br><pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                log('step2Result', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testAll() {
            const influencerId = document.getElementById('influencerSelect').value;
            
            if (!influencerId) {
                alert('è¯·å…ˆé€‰æ‹©è¾¾äºº');
                return;
            }

            log('step3Result', 'â³ æ­£åœ¨æµ‹è¯•å…¨éƒ¨å»ºè®®ç±»å‹...', 'info');
            
            const types = ['sample', 'price', 'schedule'];
            let html = '';

            for (const type of types) {
                try {
                    const url = `http://localhost:3001/api/collaborations/suggestions?influencerId=${influencerId}&type=${type}`;
                    
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    testResults[type] = data;

                    if (data.success) {
                        const suggestions = data.data.suggestions || [];
                        html += `<div class="suggestion-card">
                            <h4>âœ… ${getTypeName(type)} (${suggestions.length} æ¡å»ºè®®)</h4>`;
                        
                        if (suggestions.length > 0) {
                            suggestions.forEach(s => {
                                const badgeClass = s.confidence === 'high' ? 'badge-high' : 
                                                  s.confidence === 'medium' ? 'badge-medium' : 'badge-low';
                                const confidenceText = s.confidence === 'high' ? 'å¼ºçƒˆæ¨è' :
                                                      s.confidence === 'medium' ? 'å»ºè®®' : 'å¯é€‰';
                                
                                html += `
                                    <div style="margin: 10px 0; padding: 10px; background: #fafafa; border-radius: 4px;">
                                        <span class="badge ${badgeClass}">${confidenceText}</span>
                                        <strong>${s.label}</strong>
                                        <br>
                                        <small style="color: #8c8c8c;">ğŸ’¡ ${s.reason}</small>
                                    </div>
                                `;
                            });
                        } else {
                            html += '<p style="color: #8c8c8c;">æš‚æ— å»ºè®®ï¼ˆå¯èƒ½æ˜¯è¯¥è¾¾äººæ²¡æœ‰å†å²æ•°æ®ï¼‰</p>';
                        }
                        
                        html += '</div>';
                    } else {
                        html += `<div class="suggestion-card">
                            <h4>âŒ ${getTypeName(type)} å¤±è´¥</h4>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>`;
                    }
                } catch (error) {
                    html += `<div class="suggestion-card">
                        <h4>âŒ ${getTypeName(type)} é”™è¯¯</h4>
                        <p>${error.message}</p>
                    </div>`;
                }
            }

            document.getElementById('step3Result').innerHTML = html;
            updateSummary();
        }

        function getTypeName(type) {
            const names = {
                'sample': 'æ ·å“å»ºè®®',
                'price': 'æŠ¥ä»·å»ºè®®',
                'schedule': 'æ’æœŸå»ºè®®'
            };
            return names[type] || type;
        }

        function updateSummary() {
            const total = Object.values(testResults).filter(r => r !== null).length;
            const success = Object.values(testResults).filter(r => r && r.success).length;
            const totalSuggestions = Object.values(testResults)
                .filter(r => r && r.success)
                .reduce((sum, r) => sum + (r.data.suggestions?.length || 0), 0);

            let html = `
                <div class="result ${success === total ? 'success' : 'warning'}">
                    <h4>æµ‹è¯•å®Œæˆ</h4>
                    <p>âœ… æˆåŠŸ: ${success}/${total}</p>
                    <p>ğŸ’¡ æ€»å»ºè®®æ•°: ${totalSuggestions}</p>
                </div>
            `;

            if (totalSuggestions === 0) {
                html += `
                    <div class="result warning">
                        <h4>âš ï¸ æ³¨æ„</h4>
                        <p>æ²¡æœ‰è·å–åˆ°ä»»ä½•å»ºè®®ï¼Œå¯èƒ½çš„åŸå› ï¼š</p>
                        <ul>
                            <li>è¯¥è¾¾äººæ²¡æœ‰å†å²åˆä½œè®°å½•</li>
                            <li>æ•°æ®åº“ä¸­æ²¡æœ‰æ ·å“æ•°æ®</li>
                            <li>åç«¯ç®—æ³•è¿”å›ç©ºç»“æœ</li>
                        </ul>
                        <p><strong>è¿™æ˜¯æ­£å¸¸çš„ï¼</strong> æ™ºèƒ½å»ºè®®åŸºäºå†å²æ•°æ®ï¼Œæ–°è¾¾äººæˆ–æ–°ç³»ç»Ÿå¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ã€‚</p>
                    </div>
                `;
            }

            document.getElementById('summary').innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œæ­¥éª¤1
        window.onload = function() {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆ');
            step1();
        };
    </script>
</body>
</html>
