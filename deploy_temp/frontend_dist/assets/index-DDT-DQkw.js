import{r as o,_ as we,j as e,e as Le,S as ue}from"./index-CT9F3akh.js";import{B as ne,S as Z,g as ot,a as G,s as it,u as Ae,d as at,b as ct,c as dt,e as Ee,f as ht,h as ut,i as pt,j as ft}from"./collaboration.service-COMowK_-.js";import{P as ve,d as mt}from"./influencer.service-CIZYR2fC.js";import{u as xt}from"./usePermissions-D-ZnZ17C.js";import{C as Ye,a as gt}from"./Card-D9YXdlEe.js";import{d as w}from"./CalendarOutlined-6RDrkSku.js";import{r as be,C as jt}from"./CreateCollaborationModal-qBx9qaeH.js";import{T as Q,R as Be}from"./index-WSGRBNKI.js";import{T as H}from"./index-DnlS8_jt.js";import{R as de}from"./WarningOutlined-L-gPvlvp.js";import{R as Ce}from"./UserOutlined-C5ACOCTv.js";import{I as Ie,T as le}from"./TextArea-Dl3y1VrD.js";import{B as I}from"./button-BCSOJgfZ.js";import{R as Pe}from"./ThunderboltOutlined-A_BXyZeD.js";import{R as Ve}from"./MessageOutlined-Y6IUBdfm.js";import{B as ge}from"./index-6l5o2ZFH.js";import{d as Ne,f as yt}from"./sample.service-Cb3fiYXC.js";import{f as St}from"./money-DMHcC8uu.js";import{F}from"./index-gbW5J2sR.js";import{s as g,a as wt}from"./index-DBkC0DaV.js";import{D as $}from"./index-BIA-WqSn.js";import{S as z}from"./index-B4IHrhqI.js";import{R as ke}from"./ClockCircleOutlined-DAoco557.js";import{S as ee}from"./index-DfnzXlZl.js";import{T as vt}from"./Timeline-B9Bz9J_T.js";import{L as P}from"./index-B-vfV2rY.js";import{R as je}from"./PlusOutlined-oMbGAVrA.js";import{M as te}from"./index-CxrQydPb.js";import{T as bt}from"./index-DiUoGV2L.js";import{T as Fe}from"./index-CGanNrki.js";import{I as pe}from"./index-htVVH06X.js";import{P as Ct}from"./index-C7D5ByUV.js";import{R as It}from"./DeleteOutlined-TK3JP8uX.js";import{R as De}from"./SendOutlined-be91IxK6.js";import{D as qe}from"./index-DVFXVRcq.js";import{D as ye}from"./index-N65tUqUy.js";import{R as We,C as he}from"./row-DVjUYxl3.js";import{U as kt}from"./index-BFjyBC68.js";import{A as Se}from"./index-C7lyzjCv.js";import{P as Dt}from"./progress-CYBat26e.js";import{R as Tt}from"./CheckCircleOutlined-eJc7nheY.js";import{R as Rt}from"./CloseCircleOutlined-D2hdQaev.js";import{C as Me,F as Ot}from"./Table-pvERNZVb.js";import{S as zt}from"./index-Bawwt4cc.js";import{R as Et}from"./AppstoreOutlined-OvJvhGk0.js";import{R as Ft}from"./SearchOutlined-CyHaylvE.js";import{R as Mt}from"./ReloadOutlined-C8FTNWWf.js";import"./api-W_2ufh2E.js";import"./PurePanel-DcW2x34y.js";import"./Overflow-Gz7ZFAqv.js";import"./BulbOutlined-DzSz1Ne2.js";import"./index-Do9OUhYv.js";import"./UnstableContext-DKFbPjPy.js";import"./extendsObject-78o_rR5W.js";import"./Input-UrGHJeeK.js";import"./QuestionCircleOutlined-CZssou_a.js";import"./useBreakpoint--6XYT0_e.js";import"./Pagination-6AhiOKxV.js";import"./LeftOutlined-DGEyRIvL.js";import"./ActionButton-DPGDuFxb.js";import"./Skeleton-DdNqplha.js";import"./index-BoArUKpt.js";import"./fade-pCPugiYp.js";import"./EllipsisOutlined-Bv641ndy.js";import"./index-DTiWaDVa.js";import"./DownloadOutlined-uTWihTI_.js";import"./index-Dd1FzYQF.js";import"./index-BndKrrhJ.js";var Ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M842 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1zM512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168zm-94-392c0-50.6 41.9-92 94-92s94 41.4 94 92v224c0 50.6-41.9 92-94 92s-94-41.4-94-92V232z"}}]},name:"audio",theme:"outlined"},$t=function(n,p){return o.createElement(Ie,we({},n,{ref:p,icon:Ut}))},Ht=o.forwardRef($t),Lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2zM304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z"}}]},name:"picture",theme:"outlined"},At=function(n,p){return o.createElement(Ie,we({},n,{ref:p,icon:Lt}))},Yt=o.forwardRef(At),Bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},Pt=function(n,p){return o.createElement(Ie,we({},n,{ref:p,icon:Bt}))},Vt=o.forwardRef(Pt);w.extend(be);w.locale("zh-cn");const{Text:Ue}=Q,Nt=({card:i,stage:n,onClick:p,onFollowUpClick:v,onQuickFollowUpClick:y})=>{const s=c=>{c.dataTransfer.setData("application/json",JSON.stringify({cardId:i.id,sourceStage:n})),c.dataTransfer.effectAllowed="move"},T=c=>({DOUYIN:"magenta",KUAISHOU:"orange",XIAOHONGSHU:"red",WEIBO:"gold",OTHER:"default"})[c]||"default",D=(c=>{if(!c)return null;const u=w(c),m=w(),x=u.diff(m,"day");return x<0?{text:`è¶…æœŸ ${Math.abs(x)} å¤©`,color:"#ff4d4f"}:x===0?{text:"ä»Šå¤©æˆªæ­¢",color:"#fa8c16"}:x<=3?{text:`${x} å¤©åŽæˆªæ­¢`,color:"#fa8c16"}:{text:u.format("MM-DD"),color:"#8c8c8c"}})(i.deadline);return e.jsx(Ye,{variant:"elevated",padding:"none",hoverable:!0,style:{marginBottom:4,cursor:"grab",borderLeft:i.isOverdue?"3px solid #ff4d4f":void 0,backgroundColor:i.isOverdue?"rgba(255, 242, 240, 0.4)":void 0,borderRadius:"8px",border:"1px solid rgba(0,0,0,0.04)",boxShadow:"0 2px 4px rgba(0,0,0,0.02)"},onClick:p,children:e.jsx("div",{draggable:!0,onDragStart:s,style:{cursor:"grab"},children:e.jsxs(gt,{style:{padding:"10px 12px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4,gap:4},children:[e.jsx(Ue,{strong:!0,ellipsis:!0,style:{fontSize:12,lineHeight:"16px",flex:1},children:i.influencer.nickname}),e.jsx(H,{color:T(i.influencer.platform),style:{marginRight:0,fontSize:10,lineHeight:"13px",height:"14px",padding:"0 3px",borderRadius:"2px",border:"none",opacity:.8,flexShrink:0},children:ve[i.influencer.platform]||i.influencer.platform})]}),i.blockReason&&e.jsx("div",{style:{marginBottom:2},children:e.jsx(H,{color:"error",icon:e.jsx(de,{style:{fontSize:9}}),style:{fontSize:9,borderRadius:"2px",border:"none",padding:"0 3px",lineHeight:"14px",height:"14px"},children:ne[i.blockReason]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,color:"#8c8c8c",fontSize:10,marginBottom:2},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"2px",flex:1,minWidth:0},children:[e.jsx(Ce,{style:{fontSize:9,opacity:.7}}),e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.businessStaff.name})]}),D?e.jsx(le,{title:i.deadline?w(i.deadline).format("YYYY-MM-DD HH:mm"):"",children:e.jsx(Ue,{style:{fontSize:10,color:D.color,flexShrink:0},children:D.text})}):e.jsx("span",{style:{fontSize:10,color:"#bfbfbf",flexShrink:0},children:"å¾…å®š"})]}),i.dispatchCount>0&&e.jsxs("div",{style:{fontSize:9,color:"#8c8c8c",marginBottom:2},children:["ðŸ“¦ ",i.dispatchCount]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"2px",marginTop:2,paddingTop:2,borderTop:"1px solid rgba(0,0,0,0.02)"},children:[e.jsx(le,{title:"å¿«é€Ÿè·Ÿè¿›",children:e.jsx(I,{type:"text",size:"small",icon:e.jsx(Pe,{style:{fontSize:12,color:"#faad14"}}),onClick:c=>{c.stopPropagation(),y()},style:{width:20,height:20,minWidth:20,display:"flex",alignItems:"center",justifyContent:"center",padding:0}})}),e.jsx(le,{title:"è·Ÿè¿›è®°å½•",children:e.jsx(I,{type:"text",size:"small",icon:e.jsx(Ve,{style:{fontSize:11}}),onClick:c=>{c.stopPropagation(),v()},style:{height:20,minWidth:20,padding:"0 2px",fontSize:9,display:"flex",alignItems:"center",gap:"1px"},children:i.followUpCount>0?i.followUpCount:""})})]}),i.lastFollowUp&&e.jsx("div",{style:{marginTop:2,fontSize:9,color:"#bfbfbf",textAlign:"right"},children:w(i.lastFollowUp).fromNow()})]})})})},{Text:qt}=Q,Wt=({stage:i,stageName:n,cards:p,count:v,onDragEnd:y,onCardClick:s,onFollowUpClick:T,onDeadlineClick:C,onQuickFollowUpClick:D})=>{const c=o.useRef(null),{theme:u}=Le(),m=h=>{h.preventDefault(),h.dataTransfer.dropEffect="move"},x=h=>{h.preventDefault();const j=h.dataTransfer.getData("application/json");if(j)try{const{cardId:R,sourceStage:O}=JSON.parse(j);O!==i&&y(R,O,i)}catch(R){console.error("Failed to parse drag data:",R)}},k=p.filter(h=>h.isOverdue).length;return e.jsx(Ye,{variant:"elevated",padding:"none",style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",height:"calc(100vh - 200px)",backgroundColor:"rgba(255, 255, 255, 0.4)",border:"1px solid rgba(0,0,0,0.04)",borderRadius:"12px",overflow:"hidden"},children:e.jsxs("div",{ref:c,style:{display:"flex",flexDirection:"column",height:"100%"},onDragOver:m,onDrop:x,children:[e.jsx("div",{style:{padding:"10px 14px",borderBottom:`2.5px solid ${Z[i]}`,backgroundColor:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(10px)",zIndex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(qt,{strong:!0,style:{fontSize:13,color:u.colors.neutral[800]},children:n}),e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx(ge,{count:v,style:{backgroundColor:Z[i],fontSize:"10px",height:"18px",lineHeight:"18px",minWidth:"18px",padding:"0 5px",border:"none",boxShadow:"none"},overflowCount:999}),k>0&&e.jsx(ge,{count:k,style:{backgroundColor:"#ff4d4f",fontSize:"10px",height:"18px",lineHeight:"18px",minWidth:"18px",padding:"0 5px",border:"none",boxShadow:"none"},title:"è¶…æœŸæ•°é‡"})]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"4px",backgroundColor:`${u.colors.background.secondary}`},children:[p.map(h=>e.jsx(Nt,{card:h,stage:i,onClick:()=>s(h),onFollowUpClick:()=>T(h),onDeadlineClick:()=>C(h),onQuickFollowUpClick:()=>D(h)},h.id)),p.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"40px 16px",color:"#999"},children:"æš‚æ— æ•°æ®"})]})]})})},{Text:V}=Q,_t=({visible:i,collaborationId:n,onClose:p})=>{var l,S;const[v,y]=o.useState(!1),[s,T]=o.useState(null),[C,D]=o.useState(null),[c,u]=o.useState(!1),[m,x]=o.useState([]),[k]=F.useForm();o.useEffect(()=>{i&&n&&(h(),j())},[i,n]);const h=async()=>{if(n){y(!0);try{const r=await ot(n);T(r),D(r.blockReason)}catch{g.error("èŽ·å–åˆä½œè¯¦æƒ…å¤±è´¥")}finally{y(!1)}}},j=async()=>{try{const r=await Ne({page:1,pageSize:100});x(r.data)}catch(r){console.error("èŽ·å–æ ·å“åˆ—è¡¨å¤±è´¥:",r)}},R=async()=>{var r,f,E;if(n)try{await at(n),g.success("åˆ é™¤æˆåŠŸ"),p(!0)}catch(M){g.error(((E=(f=(r=M.response)==null?void 0:r.data)==null?void 0:f.error)==null?void 0:E.message)||"åˆ é™¤å¤±è´¥")}},O=async r=>{var f,E,M;if(n)try{await it(n,r),D(r),g.success("å¡ç‚¹åŽŸå› å·²æ›´æ–°")}catch(X){g.error(((M=(E=(f=X.response)==null?void 0:f.data)==null?void 0:E.error)==null?void 0:M.message)||"æ›´æ–°å¤±è´¥")}},L=r=>({DOUYIN:"magenta",KUAISHOU:"orange",XIAOHONGSHU:"red",WEIBO:"gold",OTHER:"default"})[r]||"default",W=()=>{u(!0),k.resetFields()},A=async()=>{var r,f,E;if(n)try{const M=await k.validateFields(),X=Math.round(M.shippingCost*100);if(await yt({sampleId:M.sampleId,collaborationId:n,quantity:M.quantity,shippingCost:X,trackingNumber:M.trackingNumber}),s&&["LEAD","CONTACTED","QUOTED"].includes(s.stage))try{await Ae(n,"SAMPLED","æ·»åŠ å¯„æ ·è®°å½•,è‡ªåŠ¨æŽ¨è¿›åˆ°å·²å¯„æ ·é˜¶æ®µ")}catch(fe){console.error("è‡ªåŠ¨æ›´æ–°é˜¶æ®µå¤±è´¥:",fe)}g.success("å¯„æ ·è®°å½•å·²æ·»åŠ "),u(!1),k.resetFields(),setTimeout(()=>{h(),p(!0)},100)}catch(M){if(M.errorFields)return;g.error(((E=(f=(r=M.response)==null?void 0:r.data)==null?void 0:f.error)==null?void 0:E.message)||"æ·»åŠ å¯„æ ·è®°å½•å¤±è´¥")}},d=[{key:"info",label:"åŸºæœ¬ä¿¡æ¯",children:s&&e.jsxs($,{column:2,size:"small",children:[e.jsx($.Item,{label:"è¾¾äººæ˜µç§°",children:s.influencer.nickname}),e.jsx($.Item,{label:"å¹³å°",children:e.jsx(H,{color:L(s.influencer.platform),children:ve[s.influencer.platform]})}),e.jsx($.Item,{label:"å¹³å°è´¦å·ID",children:s.influencer.platformId}),e.jsx($.Item,{label:"æŽ¨èæ ·å“",children:s.sample?e.jsx(H,{color:"cyan",children:s.sample.name}):"-"}),e.jsx($.Item,{label:"æŠ¥ä»·",children:s.quotedPrice?e.jsxs(V,{strong:!0,style:{color:"#1890ff"},children:["Â¥",St(s.quotedPrice)]}):"-"}),e.jsxs($.Item,{label:"è´Ÿè´£å•†åŠ¡",children:[e.jsx(Ce,{})," ",s.businessStaff.name]}),e.jsx($.Item,{label:"å½“å‰é˜¶æ®µ",children:e.jsx(H,{color:Z[s.stage],children:G[s.stage]})}),e.jsx($.Item,{label:"æ˜¯å¦è¶…æœŸ",children:s.isOverdue?e.jsx(H,{color:"error",icon:e.jsx(de,{}),children:"å·²è¶…æœŸ"}):e.jsx(H,{color:"success",children:"æ­£å¸¸"})}),e.jsx($.Item,{label:"æˆªæ­¢æ—¶é—´",children:s.deadline?e.jsxs(z,{children:[e.jsx(ke,{}),w(s.deadline).format("YYYY-MM-DD HH:mm")]}):"-"}),e.jsx($.Item,{label:"å¡ç‚¹åŽŸå› ",children:e.jsx(ee,{value:C,onChange:O,allowClear:!0,placeholder:"é€‰æ‹©å¡ç‚¹åŽŸå› ",style:{width:150},options:[{value:"PRICE_HIGH",label:ne.PRICE_HIGH},{value:"DELAYED",label:ne.DELAYED},{value:"UNCOOPERATIVE",label:ne.UNCOOPERATIVE},{value:"OTHER",label:ne.OTHER}]})}),e.jsx($.Item,{label:"åˆ›å»ºæ—¶é—´",children:w(s.createdAt).format("YYYY-MM-DD HH:mm")}),e.jsx($.Item,{label:"æ›´æ–°æ—¶é—´",children:w(s.updatedAt).format("YYYY-MM-DD HH:mm")})]})},{key:"history",label:"é˜¶æ®µåŽ†å²",children:(s==null?void 0:s.stageHistory)&&e.jsx(vt,{items:s.stageHistory.map(r=>({color:Z[r.toStage],children:e.jsxs("div",{children:[e.jsxs(V,{strong:!0,children:[r.fromStage?`${G[r.fromStage]} â†’ `:"",G[r.toStage]]}),e.jsx("br",{}),e.jsx(V,{type:"secondary",style:{fontSize:12},children:w(r.changedAt).format("YYYY-MM-DD HH:mm")}),r.notes&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(V,{style:{fontSize:12},children:r.notes})]})]})}))})},{key:"followups",label:`è·Ÿè¿›è®°å½• (${((l=s==null?void 0:s.followUps)==null?void 0:l.length)||0})`,children:(s==null?void 0:s.followUps)&&e.jsx(P,{dataSource:s.followUps,renderItem:r=>{var f;return e.jsx(P.Item,{children:e.jsx(P.Item.Meta,{title:e.jsxs(z,{children:[e.jsx(V,{strong:!0,children:((f=r.user)==null?void 0:f.name)||"æœªçŸ¥ç”¨æˆ·"}),e.jsx(V,{type:"secondary",style:{fontSize:12},children:w(r.createdAt).format("YYYY-MM-DD HH:mm")})]}),description:r.content})})},locale:{emptyText:"æš‚æ— è·Ÿè¿›è®°å½•"}})},{key:"dispatches",label:`å¯„æ ·è®°å½• (${((S=s==null?void 0:s.dispatches)==null?void 0:S.length)||0})`,children:e.jsxs("div",{children:[e.jsx(I,{type:"primary",icon:e.jsx(je,{}),onClick:W,style:{marginBottom:16},children:"æ·»åŠ å¯„æ ·"}),(s==null?void 0:s.dispatches)&&e.jsx(P,{dataSource:s.dispatches,renderItem:r=>{var f,E;return e.jsxs(P.Item,{children:[e.jsx(P.Item.Meta,{title:((f=r.sample)==null?void 0:f.name)||"æœªçŸ¥æ ·å“",description:e.jsxs(z,{direction:"vertical",size:0,children:[e.jsxs(V,{type:"secondary",children:["SKU: ",(E=r.sample)==null?void 0:E.sku," | æ•°é‡: ",r.quantity]}),e.jsxs(V,{type:"secondary",children:["æˆæœ¬: Â¥",(r.totalCost/100).toFixed(2)," | å¯„å‡ºæ—¶é—´: ",w(r.dispatchedAt).format("YYYY-MM-DD")]}),r.trackingNumber&&e.jsxs(V,{type:"secondary",children:["å¿«é€’å•å·: ",r.trackingNumber]})]})}),e.jsx(H,{color:r.receivedStatus==="RECEIVED"?"success":"default",children:r.receivedStatus==="RECEIVED"?"å·²ç­¾æ”¶":r.receivedStatus==="LOST"?"å·²ä¸¢å¤±":"å¾…ç­¾æ”¶"})]})},locale:{emptyText:"æš‚æ— å¯„æ ·è®°å½•"}})]})}];return e.jsxs(te,{title:e.jsxs(z,{children:[e.jsx("span",{children:"åˆä½œè¯¦æƒ…"}),s&&e.jsx(H,{color:Z[s.stage],children:G[s.stage]})]}),open:i,onCancel:()=>p(),width:700,footer:[e.jsx(Ct,{title:"ç¡®å®šåˆ é™¤è¯¥åˆä½œè®°å½•å—ï¼Ÿ",description:"åˆ é™¤åŽæ— æ³•æ¢å¤",onConfirm:R,okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",children:e.jsx(I,{danger:!0,icon:e.jsx(It,{}),children:"åˆ é™¤"})},"delete"),e.jsx(I,{onClick:()=>p(),children:"å…³é—­"},"close")],children:[e.jsx(ue,{spinning:v,children:s&&e.jsx(bt,{items:d})}),e.jsx(te,{title:"æ·»åŠ å¯„æ ·è®°å½•",open:c,onOk:A,onCancel:()=>u(!1),okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",children:e.jsxs(F,{form:k,layout:"vertical",children:[e.jsx(F.Item,{name:"sampleId",label:"é€‰æ‹©æ ·å“",rules:[{required:!0,message:"è¯·é€‰æ‹©æ ·å“"}],children:e.jsx(ee,{placeholder:"è¯·é€‰æ‹©æ ·å“",showSearch:!0,optionFilterProp:"children",options:m.map(r=>({label:`${r.name} (${r.sku})`,value:r.id}))})}),e.jsx(F.Item,{name:"quantity",label:"å¯„æ ·æ•°é‡",rules:[{required:!0,message:"è¯·è¾“å…¥å¯„æ ·æ•°é‡"},{type:"number",min:1,message:"æ•°é‡å¿…é¡»å¤§äºŽ0"}],children:e.jsx(Fe,{min:1,style:{width:"100%"},placeholder:"è¯·è¾“å…¥æ•°é‡"})}),e.jsx(F.Item,{name:"shippingCost",label:"å¿«é€’è´¹ï¼ˆå…ƒï¼‰",rules:[{required:!0,message:"è¯·è¾“å…¥å¿«é€’è´¹"},{type:"number",min:0,message:"å¿«é€’è´¹ä¸èƒ½ä¸ºè´Ÿæ•°"}],children:e.jsx(Fe,{min:0,precision:2,style:{width:"100%"},placeholder:"è¯·è¾“å…¥å¿«é€’è´¹"})}),e.jsx(F.Item,{name:"trackingNumber",label:"å¿«é€’å•å·",children:e.jsx(pe,{placeholder:"è¯·è¾“å…¥å¿«é€’å•å·ï¼ˆé€‰å¡«ï¼‰"})})]})})]})};w.extend(be);w.locale("zh-cn");const{Text:$e}=Q,Kt=({visible:i,collaboration:n,onClose:p})=>{const[v,y]=o.useState(!1),[s,T]=o.useState(!1),[C,D]=o.useState([]),[c,u]=o.useState("");o.useEffect(()=>{i&&n&&m()},[i,n]);const m=async()=>{if(n){y(!0);try{const h=await ct(n.id,1,100);D(h.data)}catch{g.error("èŽ·å–è·Ÿè¿›è®°å½•å¤±è´¥")}finally{y(!1)}}},x=async()=>{var h,j,R;if(!n||!c.trim()){g.warning("è¯·è¾“å…¥è·Ÿè¿›å†…å®¹");return}T(!0);try{const O=await dt(n.id,c.trim());D([O,...C]),u(""),g.success("è·Ÿè¿›è®°å½•å·²æ·»åŠ ")}catch(O){g.error(((R=(j=(h=O.response)==null?void 0:h.data)==null?void 0:j.error)==null?void 0:R.message)||"æ·»åŠ å¤±è´¥")}finally{T(!1)}},k=()=>{u(""),p(C.length>0)};return e.jsxs(te,{title:`è·Ÿè¿›è®°å½• - ${(n==null?void 0:n.influencer.nickname)||""}`,open:i,onCancel:k,width:500,footer:null,children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(pe.TextArea,{value:c,onChange:h=>u(h.target.value),placeholder:"è¾“å…¥è·Ÿè¿›å†…å®¹...",rows:3,maxLength:500,showCount:!0}),e.jsx("div",{style:{marginTop:8,textAlign:"right"},children:e.jsx(I,{type:"primary",icon:e.jsx(De,{}),onClick:x,loading:s,disabled:!c.trim(),children:"æ·»åŠ è·Ÿè¿›"})})]}),e.jsx(ue,{spinning:v,children:e.jsx(P,{dataSource:C,renderItem:h=>{var j;return e.jsx(P.Item,{style:{padding:"12px 0"},children:e.jsx(P.Item.Meta,{title:e.jsxs(z,{children:[e.jsx($e,{strong:!0,children:((j=h.user)==null?void 0:j.name)||"æœªçŸ¥ç”¨æˆ·"}),e.jsx($e,{type:"secondary",style:{fontSize:12},children:w(h.createdAt).fromNow()})]}),description:e.jsx("div",{style:{whiteSpace:"pre-wrap",marginTop:4},children:h.content})})})},locale:{emptyText:"æš‚æ— è·Ÿè¿›è®°å½•"},style:{maxHeight:400,overflowY:"auto"}})})]})},Gt=({visible:i,collaboration:n,onClose:p})=>{const[v,y]=o.useState(!1),[s,T]=o.useState(null);o.useEffect(()=>{i&&n&&T(n.deadline?w(n.deadline):null)},[i,n]);const C=async()=>{var c,u,m;if(n){y(!0);try{await Ee(n.id,s?s.toISOString():null),g.success("æˆªæ­¢æ—¶é—´å·²æ›´æ–°"),p(!0)}catch(x){g.error(((m=(u=(c=x.response)==null?void 0:c.data)==null?void 0:u.error)==null?void 0:m.message)||"æ›´æ–°å¤±è´¥")}finally{y(!1)}}},D=async()=>{var c,u,m;if(n){y(!0);try{await Ee(n.id,null),g.success("æˆªæ­¢æ—¶é—´å·²æ¸…é™¤"),p(!0)}catch(x){g.error(((m=(u=(c=x.response)==null?void 0:c.data)==null?void 0:u.error)==null?void 0:m.message)||"æ¸…é™¤å¤±è´¥")}finally{y(!1)}}};return e.jsx(te,{title:`è®¾ç½®æˆªæ­¢æ—¶é—´ - ${(n==null?void 0:n.influencer.nickname)||""}`,open:i,onCancel:()=>p(),footer:[e.jsx(I,{onClick:D,loading:v,disabled:!(n!=null&&n.deadline),children:"æ¸…é™¤æˆªæ­¢æ—¶é—´"},"clear"),e.jsx(I,{onClick:()=>p(),children:"å–æ¶ˆ"},"cancel"),e.jsx(I,{type:"primary",onClick:C,loading:v,children:"ä¿å­˜"},"save")],children:e.jsx("div",{style:{padding:"20px 0"},children:e.jsx(qe,{showTime:!0,value:s,onChange:T,placeholder:"é€‰æ‹©æˆªæ­¢æ—¶é—´",style:{width:"100%"},format:"YYYY-MM-DD HH:mm",disabledDate:c=>c&&c<w().startOf("day")})})})},{TextArea:Qt}=pe,{Text:K}=Q,Xt=({visible:i,collaboration:n,onClose:p})=>{const[v]=F.useForm(),[y,s]=o.useState(!1),[T,C]=o.useState(!1),[D,c]=o.useState([]),[u,m]=o.useState([]),[x,k]=o.useState(!1);o.useEffect(()=>{i?h():(v.resetFields(),m([]),k(!1))},[i,v]);const h=async()=>{C(!0);try{const d=await fetch("/api/collaborations/follow-up-templates",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!d.ok)throw new Error("Failed to fetch templates");const l=await d.json();c(l.data.templates||[])}catch(d){console.error("Failed to fetch templates:",d),c([{id:"1",name:"åˆæ¬¡è”ç³»",content:"æ‚¨å¥½ï¼Œæˆ‘æ˜¯{å…¬å¸åç§°}çš„å•†åŠ¡ï¼Œçœ‹åˆ°æ‚¨çš„è´¦å·å†…å®¹å¾ˆä¸é”™ï¼Œæƒ³å’Œæ‚¨èŠèŠåˆä½œçš„äº‹æƒ…ã€‚",category:"åˆæ¬¡æŽ¥è§¦"},{id:"2",name:"æŠ¥ä»·è·Ÿè¿›",content:"æ‚¨å¥½ï¼Œå…³äºŽä¸Šæ¬¡çš„åˆä½œæŠ¥ä»·ï¼Œä¸çŸ¥é“æ‚¨è€ƒè™‘å¾—æ€Žä¹ˆæ ·äº†ï¼Ÿå¦‚æžœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿Žéšæ—¶æ²Ÿé€šã€‚",category:"æŠ¥ä»·é˜¶æ®µ"},{id:"3",name:"æ ·å“ç¡®è®¤",content:"æ‚¨å¥½ï¼Œæ ·å“å·²ç»å¯„å‡ºï¼Œé¢„è®¡{å¤©æ•°}å¤©å†…é€è¾¾ã€‚æ”¶åˆ°åŽè¯·åŠæ—¶ç¡®è®¤ï¼Œæœ‰ä»»ä½•é—®é¢˜éšæ—¶è”ç³»æˆ‘ã€‚",category:"å¯„æ ·é˜¶æ®µ"},{id:"4",name:"æŽ’æœŸæé†’",content:"æ‚¨å¥½ï¼Œæƒ³ç¡®è®¤ä¸€ä¸‹è§†é¢‘çš„å‘å¸ƒæ—¶é—´ï¼Œæˆ‘ä»¬è¿™è¾¹éœ€è¦æå‰åšå¥½å‡†å¤‡å·¥ä½œã€‚",category:"æŽ’æœŸé˜¶æ®µ"},{id:"5",name:"å‘å¸ƒç¡®è®¤",content:"æ‚¨å¥½ï¼Œçœ‹åˆ°è§†é¢‘å·²ç»å‘å¸ƒäº†ï¼Œæ•ˆæžœå¾ˆä¸é”™ï¼éº»çƒ¦æ‚¨æŠŠè§†é¢‘é“¾æŽ¥å’Œæ•°æ®å‘ç»™æˆ‘ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿™è¾¹ç»Ÿè®¡ã€‚",category:"å‘å¸ƒé˜¶æ®µ"}])}finally{C(!1)}},j=d=>{const l=v.getFieldValue("content")||"",S=l?`${l}

${d.content}`:d.content;v.setFieldsValue({content:S})},R=()=>{const d=window.SpeechRecognition||window.webkitSpeechRecognition;if(!d){g.warning("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ Chrome æµè§ˆå™¨");return}if(x){k(!1);return}const l=new d;l.lang="zh-CN",l.continuous=!1,l.interimResults=!1,l.onstart=()=>{k(!0),g.info("æ­£åœ¨å½•éŸ³ï¼Œè¯·è¯´è¯...")},l.onresult=S=>{const r=S.results[0][0].transcript,f=v.getFieldValue("content")||"",E=f?`${f}
${r}`:r;v.setFieldsValue({content:E}),g.success("è¯­éŸ³è¯†åˆ«æˆåŠŸ")},l.onerror=S=>{console.error("Speech recognition error:",S.error),g.error("è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•"),k(!1)},l.onend=()=>{k(!1)},l.start()},O=async()=>{var d;if(n)try{const l=await v.validateFields();s(!0);const S=new FormData;S.append("content",l.content),u.forEach(f=>{f.originFileObj&&S.append("images",f.originFileObj)});const r=await fetch(`/api/collaborations/${n.id}/follow-up/quick`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:S});if(!r.ok){const f=await r.json();throw new Error(((d=f.error)==null?void 0:d.message)||"æ·»åŠ è·Ÿè¿›è®°å½•å¤±è´¥")}g.success("è·Ÿè¿›è®°å½•å·²æ·»åŠ "),p(!0)}catch(l){if(l.errorFields)return;g.error(l.message||"æ·»åŠ è·Ÿè¿›è®°å½•å¤±è´¥")}finally{s(!1)}},L=({fileList:d})=>{m(d)},W=d=>{m(u.filter(l=>l.uid!==d.uid))},A=D.reduce((d,l)=>(d[l.category]||(d[l.category]=[]),d[l.category].push(l),d),{});return e.jsx(te,{title:e.jsxs(z,{children:[e.jsx(Pe,{}),"å¿«é€Ÿè·Ÿè¿›",n&&e.jsxs(K,{type:"secondary",style:{fontSize:14,fontWeight:"normal"},children:["- ",n.influencer.nickname]})]}),open:i,onCancel:()=>p(),width:800,footer:[e.jsx(I,{onClick:()=>p(),children:"å–æ¶ˆ"},"cancel"),e.jsx(I,{type:"primary",icon:e.jsx(De,{}),loading:y,onClick:O,children:"å‘é€è·Ÿè¿›"},"submit")],children:e.jsxs(ue,{spinning:T,children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(K,{strong:!0,children:"å¿«é€Ÿæ¨¡æ¿"}),e.jsx(K,{type:"secondary",style:{marginLeft:8,fontSize:12},children:"ç‚¹å‡»æ¨¡æ¿å¿«é€Ÿå¡«å……å†…å®¹"}),e.jsx("div",{style:{marginTop:8},children:Object.keys(A).length>0?Object.entries(A).map(([d,l])=>e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(K,{type:"secondary",style:{fontSize:12},children:d}),e.jsx("div",{style:{marginTop:4},children:e.jsx(z,{size:[8,8],wrap:!0,children:l.map(S=>e.jsx(H,{color:"blue",style:{cursor:"pointer",margin:0},onClick:()=>j(S),children:S.name},S.id))})})]},d)):e.jsx(K,{type:"secondary",style:{fontSize:12},children:"æš‚æ— æ¨¡æ¿"})})]}),e.jsx(ye,{style:{margin:"16px 0"}}),e.jsxs(F,{form:v,layout:"vertical",children:[e.jsx(F.Item,{name:"content",label:"è·Ÿè¿›å†…å®¹",rules:[{required:!0,message:"è¯·è¾“å…¥è·Ÿè¿›å†…å®¹"}],children:e.jsx(Qt,{rows:6,placeholder:"è¯·è¾“å…¥è·Ÿè¿›å†…å®¹...",maxLength:1e3,showCount:!0})}),e.jsxs(We,{gutter:8,children:[e.jsx(he,{children:e.jsx(I,{icon:e.jsx(Ht,{}),onClick:R,type:x?"primary":"default",danger:x,children:x?"æ­£åœ¨å½•éŸ³...":"è¯­éŸ³è¾“å…¥"})}),e.jsx(he,{children:e.jsx(kt,{fileList:u,onChange:L,beforeUpload:()=>!1,accept:"image/*",multiple:!0,showUploadList:!1,children:e.jsx(I,{icon:e.jsx(Yt,{}),children:"ä¸Šä¼ å›¾ç‰‡"})})})]}),u.length>0&&e.jsxs("div",{style:{marginTop:16},children:[e.jsxs(K,{strong:!0,children:["å·²é€‰æ‹©å›¾ç‰‡ (",u.length,")"]}),e.jsx("div",{style:{marginTop:8},children:e.jsx(z,{size:[8,8],wrap:!0,children:u.map(d=>e.jsxs("div",{style:{position:"relative",width:80,height:80,border:"1px solid #d9d9d9",borderRadius:4,overflow:"hidden"},children:[e.jsx("img",{src:d.thumbUrl||URL.createObjectURL(d.originFileObj),alt:d.name,style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx(I,{type:"text",size:"small",icon:e.jsx(wt,{}),onClick:()=>W(d),style:{position:"absolute",top:0,right:0,background:"rgba(0, 0, 0, 0.5)",color:"white",border:"none"}})]},d.uid))})})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:"#f0f5ff",borderRadius:4,fontSize:12,color:"#595959"},children:[e.jsx(K,{strong:!0,style:{fontSize:12},children:"ðŸ’¡ å°æç¤ºï¼š"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:20},children:[e.jsx("li",{children:"ç‚¹å‡»æ¨¡æ¿å¯ä»¥å¿«é€Ÿå¡«å……å¸¸ç”¨è¯æœ¯"}),e.jsx("li",{children:'æ”¯æŒè¯­éŸ³è¾“å…¥ï¼Œç‚¹å‡»"è¯­éŸ³è¾“å…¥"æŒ‰é’®å¼€å§‹å½•éŸ³ï¼ˆéœ€è¦ Chrome æµè§ˆå™¨ï¼‰'}),e.jsx("li",{children:"å¯ä»¥ä¸Šä¼ å›¾ç‰‡ä½œä¸ºè·Ÿè¿›è®°å½•çš„é™„ä»¶"}),e.jsx("li",{children:"è·Ÿè¿›è®°å½•ä¼šè‡ªåŠ¨è®°å½•æ—¶é—´"})]})]})]})})},{Text:re,Title:He}=Q,{Option:B}=ee,Jt=({visible:i,selectedIds:n,onClose:p,onExecute:v})=>{const[y]=F.useForm(),[s,T]=o.useState(""),[C,D]=o.useState(!1),[c,u]=o.useState(0),[m,x]=o.useState(null),[k,h]=o.useState([]),[j,R]=o.useState(!1);o.useEffect(()=>{i&&O()},[i]);const O=async()=>{R(!0);try{let l=[],S=1,r=!0;for(;r;){const f=await Ne({page:S,pageSize:100});l=[...l,...f.data],r=S<f.totalPages,S++}h(l)}catch(l){console.error("Failed to fetch samples:",l)}finally{R(!1)}},L=l=>{T(l),y.resetFields(["data"])},W=async()=>{try{await y.validateFields();const l=y.getFieldsValue();D(!0),u(0),x(null);const S=setInterval(()=>{u(f=>f>=90?(clearInterval(S),90):f+10)},200),r=await v(s,l.data);clearInterval(S),u(100),x({success:r.failed===0,updated:r.updated,failed:r.failed,errors:r.errors})}catch(l){console.error("Batch operation failed:",l),x({success:!1,updated:0,failed:n.length,errors:[{message:l.message||"æ“ä½œå¤±è´¥"}]})}finally{D(!1)}},A=()=>{y.resetFields(),T(""),u(0),x(null),p()},d=()=>{switch(s){case"dispatch":return e.jsx(F.Item,{name:["data","sampleId"],label:"é€‰æ‹©æ ·å“",rules:[{required:!0,message:"è¯·é€‰æ‹©æ ·å“"}],children:e.jsx(ee,{placeholder:"è¯·é€‰æ‹©è¦å¯„é€çš„æ ·å“",loading:j,showSearch:!0,optionFilterProp:"children",children:k.map(l=>e.jsxs(B,{value:l.id,children:[l.name," (",l.sku,")"]},l.id))})});case"updateStage":return e.jsx(F.Item,{name:["data","stage"],label:"ç›®æ ‡é˜¶æ®µ",rules:[{required:!0,message:"è¯·é€‰æ‹©ç›®æ ‡é˜¶æ®µ"}],children:e.jsxs(ee,{placeholder:"è¯·é€‰æ‹©è¦æ›´æ–°åˆ°çš„é˜¶æ®µ",children:[e.jsx(B,{value:"LEAD",children:"çº¿ç´¢è¾¾äºº"}),e.jsx(B,{value:"CONTACTED",children:"å·²è”ç³»"}),e.jsx(B,{value:"QUOTED",children:"å·²æŠ¥ä»·"}),e.jsx(B,{value:"SAMPLED",children:"å·²å¯„æ ·"}),e.jsx(B,{value:"SCHEDULED",children:"å·²æŽ’æœŸ"}),e.jsx(B,{value:"PUBLISHED",children:"å·²å‘å¸ƒ"}),e.jsx(B,{value:"REVIEWED",children:"å·²å¤ç›˜"})]})});case"setDeadline":return e.jsx(F.Item,{name:["data","deadline"],label:"æˆªæ­¢æ—¶é—´",rules:[{required:!0,message:"è¯·é€‰æ‹©æˆªæ­¢æ—¶é—´"}],children:e.jsx(qe,{showTime:!0,format:"YYYY-MM-DD HH:mm",placeholder:"é€‰æ‹©æˆªæ­¢æ—¶é—´",style:{width:"100%"},disabledDate:l=>l&&l<w().startOf("day")})});default:return null}};return e.jsxs(te,{title:"æ‰¹é‡æ“ä½œ",open:i,onCancel:A,width:600,footer:null,children:[e.jsx(Se,{message:`å·²é€‰æ‹© ${n.length} ä¸ªåˆä½œè®°å½•`,type:"info",showIcon:!0,style:{marginBottom:16}}),m?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{textAlign:"center",padding:"24px 0"},children:m.success?e.jsxs(e.Fragment,{children:[e.jsx(Tt,{style:{fontSize:64,color:"#52c41a",marginBottom:16}}),e.jsx(He,{level:4,children:"æ“ä½œå®Œæˆ"}),e.jsxs(re,{type:"secondary",children:["æˆåŠŸå¤„ç† ",m.updated," æ¡è®°å½•"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Rt,{style:{fontSize:64,color:"#ff4d4f",marginBottom:16}}),e.jsx(He,{level:4,children:"æ“ä½œéƒ¨åˆ†å¤±è´¥"}),e.jsxs(z,{direction:"vertical",size:"small",children:[e.jsxs(re,{children:["æˆåŠŸ: ",m.updated," æ¡"]}),e.jsxs(re,{type:"danger",children:["å¤±è´¥: ",m.failed," æ¡"]})]})]})}),m.errors&&m.errors.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),e.jsx(Se,{message:"é”™è¯¯è¯¦æƒ…",description:e.jsx(P,{size:"small",dataSource:m.errors,renderItem:l=>e.jsx(P.Item,{children:e.jsx(re,{type:"danger",children:l.message||"æœªçŸ¥é”™è¯¯"})})}),type:"error",showIcon:!0})]}),e.jsx("div",{style:{marginTop:24,textAlign:"right"},children:e.jsx(I,{type:"primary",onClick:A,children:"å…³é—­"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(F,{form:y,layout:"vertical",children:[e.jsx(F.Item,{name:"operation",label:"æ“ä½œç±»åž‹",rules:[{required:!0,message:"è¯·é€‰æ‹©æ“ä½œç±»åž‹"}],children:e.jsxs(ee,{placeholder:"è¯·é€‰æ‹©è¦æ‰§è¡Œçš„æ“ä½œ",onChange:L,size:"large",children:[e.jsx(B,{value:"dispatch",children:e.jsxs(z,{children:[e.jsx(De,{}),"æ‰¹é‡å¯„æ ·"]})}),e.jsx(B,{value:"updateStage",children:e.jsxs(z,{children:[e.jsx(Be,{}),"æ‰¹é‡æ›´æ–°çŠ¶æ€"]})}),e.jsx(B,{value:"setDeadline",children:e.jsxs(z,{children:[e.jsx(ke,{}),"æ‰¹é‡è®¾ç½®æˆªæ­¢æ—¥æœŸ"]})})]})}),s&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),d()]})]}),C&&e.jsxs("div",{style:{marginTop:24},children:[e.jsx(re,{type:"secondary",children:"æ­£åœ¨å¤„ç†..."}),e.jsx(Dt,{percent:c,status:"active"})]}),e.jsx("div",{style:{marginTop:24,textAlign:"right"},children:e.jsxs(z,{children:[e.jsx(I,{onClick:A,disabled:C,children:"å–æ¶ˆ"}),e.jsx(I,{type:"primary",onClick:W,loading:C,disabled:!s,children:"æ‰§è¡Œæ“ä½œ"})]})})]})]})};w.extend(be);w.locale("zh-cn");const{Title:Zt,Text:N}=Q,fr=()=>{const{theme:i}=Le(),{hasPermission:n,canViewOthersData:p}=xt(),[v,y]=o.useState(!1),[s,T]=o.useState(null),[C,D]=o.useState(null),[c,u]=o.useState(""),[m,x]=o.useState(""),[k,h]=o.useState("board"),[j,R]=o.useState([]),[O,L]=o.useState(null),[W,A]=o.useState(!1),[d,l]=o.useState(!1),[S,r]=o.useState(!1),[f,E]=o.useState(!1),[M,X]=o.useState(!1),[fe,Te]=o.useState(!1),[_e,Ke]=o.useState([]),_=o.useCallback(async()=>{y(!0);try{const[t,a]=await Promise.all([ht({keyword:m||void 0}),ut()]);T(t),D(a)}catch{g.error("èŽ·å–ç®¡é“æ•°æ®å¤±è´¥")}finally{y(!1)}},[m]),Re=o.useCallback(async()=>{try{let t=[],a=1,b=!0;for(;b;){const U=await mt({page:a,pageSize:100});t=[...t,...U.data],b=a<U.totalPages,a++}Ke(t)}catch(t){console.error("Failed to fetch influencers:",t)}},[]);o.useEffect(()=>{_()},[_]),o.useEffect(()=>{Re()},[Re]);const Oe=()=>{x(c)},Ge=async(t,a,b)=>{var U,se,q;if(a!==b){if(s){const Y={...s},ae=Y.stages.find(J=>J.stage===a),xe=Y.stages.find(J=>J.stage===b);if(ae&&xe){const J=ae.collaborations.findIndex(ce=>ce.id===t);if(J!==-1){const[ce]=ae.collaborations.splice(J,1);ce.stage=b,xe.collaborations.unshift(ce),ae.count--,xe.count++,T(Y)}}}try{await Ae(t,b),g.success(`å·²ç§»åŠ¨åˆ°ã€Œ${G[b]}ã€`)}catch(Y){g.error(((q=(se=(U=Y.response)==null?void 0:U.data)==null?void 0:se.error)==null?void 0:q.message)||"æ›´æ–°é˜¶æ®µå¤±è´¥"),_()}}},me=t=>{L(t),A(!0)},ze=t=>{L(t),l(!0)},Qe=t=>{L(t),r(!0)},Xe=t=>{L(t),X(!0)},oe=t=>{A(!1),l(!1),r(!1),X(!1),L(null),t&&_()},Je=t=>{E(!1),t&&_()},Ze=()=>{Te(!1),R([])},et=async(t,a)=>{var b,U,se;try{let q={...a};t==="setDeadline"&&a.deadline&&(q.deadline=a.deadline.toISOString());const Y=await ft(j,t,q);return Y.updated>0&&(g.success(`æˆåŠŸå¤„ç† ${Y.updated} æ¡è®°å½•`),_()),Y.failed>0&&g.warning(`${Y.failed} æ¡è®°å½•å¤„ç†å¤±è´¥`),Y}catch(q){throw g.error(((se=(U=(b=q.response)==null?void 0:b.data)==null?void 0:U.error)==null?void 0:se.message)||"æ‰¹é‡æ“ä½œå¤±è´¥"),q}},tt=(t,a)=>{R(a?[...j,t]:j.filter(b=>b!==t))},st=t=>{if(t){const a=ie().map(b=>b.id);R(a)}else R([])},ie=()=>s?s.stages.flatMap(t=>t.collaborations):[],rt=[{title:e.jsx(Me,{checked:j.length>0&&j.length===ie().length,indeterminate:j.length>0&&j.length<ie().length,onChange:t=>st(t.target.checked)}),key:"selection",width:50,fixed:"left",render:(t,a)=>e.jsx(Me,{checked:j.includes(a.id),onChange:b=>tt(a.id,b.target.checked)})},{title:"è¾¾äººæ˜µç§°",dataIndex:["influencer","nickname"],key:"nickname",width:150,fixed:"left",render:(t,a)=>e.jsxs(z,{children:[e.jsx(N,{strong:!0,style:{cursor:"pointer"},onClick:()=>me(a),children:t}),a.isOverdue&&e.jsx(H,{color:"error",icon:e.jsx(de,{}),children:"è¶…æœŸ"})]})},{title:"å¹³å°",dataIndex:["influencer","platform"],key:"platform",width:100,render:t=>e.jsx(H,{color:nt(t),children:ve[t]||t})},{title:"é˜¶æ®µ",dataIndex:"stage",key:"stage",width:120,render:t=>e.jsx(H,{color:Z[t],children:G[t]})},{title:"è´Ÿè´£å•†åŠ¡",dataIndex:["businessStaff","name"],key:"businessStaff",width:100,render:t=>e.jsxs(z,{size:4,children:[e.jsx(Ce,{}),t]})},{title:"æˆªæ­¢æ—¶é—´",dataIndex:"deadline",key:"deadline",width:150,render:t=>{if(!t)return e.jsx(N,{type:"secondary",children:"æœªè®¾ç½®"});const a=lt(t);return a?e.jsx(le,{title:w(t).format("YYYY-MM-DD HH:mm"),children:e.jsxs(N,{style:{color:a.color},children:[e.jsx(ke,{})," ",a.text]})}):e.jsx(N,{type:"secondary",children:"æœªè®¾ç½®"})}},{title:"è·Ÿè¿›",dataIndex:"followUpCount",key:"followUpCount",width:80,align:"center",render:(t,a)=>e.jsx(I,{type:"link",size:"small",icon:e.jsx(Ve,{}),onClick:b=>{b.stopPropagation(),ze(a)},children:t>0?t:""})},{title:"å¯„æ ·æ¬¡æ•°",dataIndex:"dispatchCount",key:"dispatchCount",width:100,align:"center",render:t=>t>0?`ðŸ“¦ ${t}`:"-"},{title:"æœ€è¿‘è·Ÿè¿›",dataIndex:"lastFollowUp",key:"lastFollowUp",width:120,render:t=>t?e.jsx(N,{type:"secondary",style:{fontSize:12},children:w(t).fromNow()}):e.jsx(N,{type:"secondary",children:"-"})}],nt=t=>({DOUYIN:"magenta",KUAISHOU:"orange",XIAOHONGSHU:"red",WEIBO:"gold",OTHER:"default"})[t]||"default",lt=t=>{if(!t)return null;const a=w(t),b=w(),U=a.diff(b,"day");return U<0?{text:`è¶…æœŸ ${Math.abs(U)} å¤©`,color:"#ff4d4f"}:U===0?{text:"ä»Šå¤©æˆªæ­¢",color:"#fa8c16"}:U<=3?{text:`${U} å¤©åŽæˆªæ­¢`,color:"#fa8c16"}:{text:a.format("MM-DD"),color:"#8c8c8c"}};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column",background:`linear-gradient(135deg, ${i.colors.background.secondary} 0%, ${i.colors.background.tertiary} 100%)`,position:"relative",padding:"24px",margin:"-24px"},children:[e.jsx("div",{style:{position:"absolute",top:"10%",left:"5%",width:"400px",height:"400px",background:"linear-gradient(135deg, rgba(90, 200, 250, 0.08), rgba(191, 90, 242, 0.08))",borderRadius:"50%",filter:"blur(80px)",pointerEvents:"none",zIndex:0}}),e.jsx("div",{style:{position:"absolute",top:"40%",right:"10%",width:"500px",height:"500px",background:"linear-gradient(135deg, rgba(255, 107, 107, 0.08), rgba(255, 217, 61, 0.08))",borderRadius:"50%",filter:"blur(100px)",pointerEvents:"none",zIndex:0}}),e.jsxs("div",{style:{position:"relative",zIndex:1,height:"100%",display:"flex",flexDirection:"column"},children:[!p&&e.jsx(Se,{message:"æ•°æ®æƒé™æç¤º",description:"æ‚¨å½“å‰åªèƒ½æŸ¥çœ‹è‡ªå·±è´Ÿè´£çš„åˆä½œè®°å½•ã€‚å¦‚éœ€æŸ¥çœ‹å…¶ä»–å•†åŠ¡çš„åˆä½œï¼Œè¯·è”ç³»ç®¡ç†å‘˜è°ƒæ•´æƒé™ã€‚",type:"info",showIcon:!0,closable:!0,style:{marginBottom:16}}),e.jsxs(We,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[e.jsx(he,{children:e.jsxs(z,{align:"center",children:[e.jsx(Zt,{level:4,style:{margin:0},children:"åˆä½œç®¡é“"}),C&&e.jsxs(z,{size:"large",style:{marginLeft:24},children:[e.jsxs(N,{type:"secondary",children:["æ€»è®¡: ",e.jsx(N,{strong:!0,children:C.total})]}),C.overdueCount>0&&e.jsx(ge,{count:C.overdueCount,offset:[10,0],children:e.jsxs(N,{type:"danger",children:[e.jsx(de,{})," è¶…æœŸ"]})})]})]})}),e.jsx(he,{children:e.jsxs(z,{children:[k==="table"&&j.length>0&&e.jsxs(I,{icon:e.jsx(Be,{}),onClick:()=>Te(!0),children:["æ‰¹é‡æ“ä½œ (",j.length,")"]}),e.jsx(zt,{value:k,onChange:t=>h(t),options:[{label:"çœ‹æ¿",value:"board",icon:e.jsx(Et,{})},{label:"è¡¨æ ¼",value:"table",icon:e.jsx(Vt,{})}]}),e.jsx(pe,{placeholder:"æœç´¢è¾¾äººæ˜µç§°",value:c,onChange:t=>u(t.target.value),onPressEnter:Oe,style:{width:200},suffix:e.jsx(Ft,{onClick:Oe,style:{cursor:"pointer"}})}),e.jsx(I,{icon:e.jsx(Mt,{}),onClick:_,children:"åˆ·æ–°"}),n("operations.manageCollaborations")?e.jsx(I,{type:"primary",icon:e.jsx(je,{}),onClick:()=>E(!0),children:"æ–°å»ºåˆä½œ"}):e.jsx(le,{title:"æ‚¨æ²¡æœ‰æƒé™åˆ›å»ºåˆä½œè®°å½•",children:e.jsx(I,{type:"primary",icon:e.jsx(je,{}),disabled:!0,children:"æ–°å»ºåˆä½œ"})})]})})]}),e.jsx(ue,{spinning:v,children:k==="board"?e.jsx("div",{style:{display:"flex",gap:8,flex:1,width:"100%",overflow:"hidden"},children:pt.map(t=>{const a=s==null?void 0:s.stages.find(b=>b.stage===t);return e.jsx(Wt,{stage:t,stageName:G[t],cards:(a==null?void 0:a.collaborations)||[],count:(a==null?void 0:a.count)||0,onDragEnd:Ge,onCardClick:me,onFollowUpClick:ze,onDeadlineClick:Qe,onQuickFollowUpClick:Xe},t)})}):e.jsx(Ot,{dataSource:ie(),columns:rt,rowKey:"id",pagination:{pageSize:50,showSizeChanger:!0,showTotal:t=>`å…± ${t} æ¡`},scroll:{x:1200},onRow:t=>({onClick:()=>me(t),style:{cursor:"pointer"}})})}),e.jsx(_t,{visible:W,collaborationId:(O==null?void 0:O.id)||null,onClose:oe}),e.jsx(Kt,{visible:d,collaboration:O,onClose:oe}),e.jsx(Gt,{visible:S,collaboration:O,onClose:oe}),e.jsx(jt,{visible:f,influencers:_e,onClose:Je}),e.jsx(Xt,{visible:M,collaboration:O,onClose:oe}),e.jsx(Jt,{visible:fe,selectedIds:j,onClose:Ze,onExecute:et})]})]})};export{fr as default};
