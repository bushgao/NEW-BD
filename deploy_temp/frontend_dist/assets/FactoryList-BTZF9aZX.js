import{r as n,_ as ee,j as e,S as te}from"./index-CT9F3akh.js";import{e as je,f as ye,h as ge,i as ae,j as se,g as le,a as ne,k as Se,m as we,n as Ie,o as be,r as Ee,t as Ce,p as ve}from"./platform.service-DL6LgE4V.js";import{C as B,a as M}from"./Card-D9YXdlEe.js";import{D as d}from"./index-BIA-WqSn.js";import{R as ke,C as K}from"./row-DVjUYxl3.js";import{S as q}from"./index-C_yDWHqX.js";import{R as Le}from"./TeamOutlined-Bai9oLhN.js";import{R as De}from"./ProjectOutlined-CBcPNtE6.js";import{R as Te}from"./TrophyOutlined-Bu28ol1a.js";import{R as Fe}from"./UserOutlined-C5ACOCTv.js";import{F as U}from"./Table-pvERNZVb.js";import{M as W}from"./index-CxrQydPb.js";import{T as ie}from"./index-DiUoGV2L.js";import{s as u,a as Ae}from"./index-DBkC0DaV.js";import{T as j}from"./index-DnlS8_jt.js";import{B as E}from"./button-BCSOJgfZ.js";import{R as re,I as Pe}from"./index-htVVH06X.js";import{d as z}from"./CalendarOutlined-6RDrkSku.js";import{F as w}from"./index-gbW5J2sR.js";import{S as Y}from"./index-B4IHrhqI.js";import{R as Re}from"./SearchOutlined-CyHaylvE.js";import{S as G}from"./index-DfnzXlZl.js";import{D as Z}from"./index-N65tUqUy.js";import{T as O}from"./index-CGanNrki.js";import{R as J}from"./GiftOutlined-B6rzlFEA.js";import{D as ze}from"./index-DVFXVRcq.js";import{S as Ne}from"./index-2ffhpgky.js";import{R as $e}from"./LockOutlined-DjHtpiEB.js";import{R as Ve}from"./UnlockOutlined-DSEY7w_e.js";import{I as oe,T as F,R as Oe}from"./TextArea-Dl3y1VrD.js";import{P as Q}from"./index-C7D5ByUV.js";import{R as _e}from"./index-WSGRBNKI.js";import{R as Be}from"./DeleteOutlined-TK3JP8uX.js";var Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M304 176h80v672h-80zm408 0h-64c-4.4 0-8 3.6-8 8v656c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V184c0-4.4-3.6-8-8-8z"}}]},name:"pause",theme:"outlined"},Ke=function(x,y){return n.createElement(oe,ee({},x,{ref:y,icon:Me}))},qe=n.forwardRef(Ke),Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"},Ge=function(x,y){return n.createElement(oe,ee({},x,{ref:y,icon:Je}))},Ue=n.forwardRef(Ge);const Qe=({staffId:i,visible:x,onClose:y})=>{const[C,h]=n.useState(!1),[l,N]=n.useState(null),[I,v]=n.useState([]),[$,L]=n.useState([]),[g,A]=n.useState(0),[P,D]=n.useState(0),[V,R]=n.useState("stats"),c=async()=>{if(i){h(!0);try{const a=await je(i);N(a)}catch(a){u.error("加载商务统计失败"),console.error(a)}finally{h(!1)}}},m=async()=>{if(i){h(!0);try{const a=await ye(i,{page:1,pageSize:10});v(a.data),A(a.total)}catch(a){u.error("加载达人列表失败"),console.error(a)}finally{h(!1)}}},T=async()=>{if(i){h(!0);try{const a=await ge(i,{page:1,pageSize:10});L(a.data),D(a.total)}catch(a){u.error("加载合作列表失败"),console.error(a)}finally{h(!1)}}};n.useEffect(()=>{x&&i&&(c(),m(),T())},[x,i]);const f=[{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"平台",dataIndex:"platform",key:"platform"},{title:"粉丝数",dataIndex:"followersCount",key:"followersCount",render:a=>(a==null?void 0:a.toLocaleString())||"-"},{title:"合作次数",dataIndex:["_count","collaborations"],key:"collaborations"},{title:"添加时间",dataIndex:"createdAt",key:"createdAt",render:a=>new Date(a).toLocaleDateString("zh-CN")}],k=[{title:"达人",dataIndex:["influencer","nickname"],key:"influencer"},{title:"平台",dataIndex:["influencer","platform"],key:"platform"},{title:"阶段",dataIndex:"stage",key:"stage"},{title:"状态",key:"status",render:(a,b)=>b.result?"已完成":"进行中"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:a=>new Date(a).toLocaleDateString("zh-CN")}],o=[{key:"stats",label:"工作数据",children:e.jsx(te,{spinning:C,children:l&&e.jsxs("div",{children:[e.jsxs(d,{title:"基本信息",bordered:!0,column:2,style:{marginBottom:24},children:[e.jsx(d.Item,{label:"姓名",children:l.name}),e.jsx(d.Item,{label:"邮箱",children:l.email}),e.jsx(d.Item,{label:"所属品牌",children:l.factoryName}),e.jsx(d.Item,{label:"注册时间",children:new Date(l.createdAt).toLocaleDateString("zh-CN")})]}),e.jsxs(ke,{gutter:16,children:[e.jsx(K,{xs:24,sm:12,md:6,children:e.jsx(B,{variant:"elevated",hoverable:!0,children:e.jsx(M,{children:e.jsx(q,{title:"添加达人",value:l.influencersAdded,prefix:e.jsx(Le,{}),suffix:"个"})})})}),e.jsx(K,{xs:24,sm:12,md:6,children:e.jsx(B,{variant:"elevated",hoverable:!0,children:e.jsx(M,{children:e.jsx(q,{title:"创建合作",value:l.collaborationsCreated,prefix:e.jsx(De,{}),suffix:"个"})})})}),e.jsx(K,{xs:24,sm:12,md:6,children:e.jsx(B,{variant:"elevated",hoverable:!0,children:e.jsx(M,{children:e.jsx(q,{title:"完成合作",value:l.collaborationsCompleted,prefix:e.jsx(Te,{}),suffix:"个",valueStyle:{color:"#52c41a"}})})})}),e.jsx(K,{xs:24,sm:12,md:6,children:e.jsx(B,{variant:"elevated",hoverable:!0,children:e.jsx(M,{children:e.jsx(q,{title:"成功率",value:l.successRate,prefix:e.jsx(Fe,{}),suffix:"%",precision:1,valueStyle:{color:l.successRate>=60?"#52c41a":"#faad14"}})})})})]})]})})},{key:"influencers",label:`达人列表 (${g})`,children:e.jsx(U,{columns:f,dataSource:I,rowKey:"id",loading:C,pagination:{total:g,pageSize:10,showTotal:a=>`共 ${a} 个达人`}})},{key:"collaborations",label:`合作列表 (${P})`,children:e.jsx(U,{columns:k,dataSource:$,rowKey:"id",loading:C,pagination:{total:P,pageSize:10,showTotal:a=>`共 ${a} 个合作`}})}];return e.jsx(W,{title:l?`商务详情 - ${l.name}`:"商务详情",open:x,onCancel:y,footer:null,width:900,destroyOnClose:!0,children:e.jsx(ie,{activeKey:V,onChange:R,items:o})})},We=({brandId:i,visible:x,onClose:y})=>{var f,k,o;const[C,h]=n.useState(!1),[l,N]=n.useState(null),[I,v]=n.useState([]),[$,L]=n.useState("basic"),[g,A]=n.useState(!1),[P,D]=n.useState(null),V=async()=>{if(i){h(!0);try{const a=await Se(i);N(a)}catch(a){u.error("加载品牌详情失败"),console.error(a)}finally{h(!1)}}},R=async()=>{if(i){h(!0);try{const a=await we(i);v(a)}catch(a){u.error("加载商务列表失败"),console.error(a)}finally{h(!1)}}};n.useEffect(()=>{x&&i&&(V(),R())},[x,i]);const c=a=>{D(a),A(!0)},m=[{title:"姓名",dataIndex:"name",key:"name"},{title:"邮箱",dataIndex:"email",key:"email"},{title:"添加达人",dataIndex:["_count","influencers"],key:"influencers",render:a=>a||0},{title:"创建合作",dataIndex:["_count","collaborations"],key:"collaborations",render:a=>a||0},{title:"添加时间",dataIndex:"createdAt",key:"createdAt",render:a=>new Date(a).toLocaleDateString("zh-CN")},{title:"操作",key:"actions",render:(a,b)=>e.jsx(E,{type:"link",size:"small",icon:e.jsx(re,{}),onClick:()=>c(b.id),children:"查看详情"})}],T=[{key:"basic",label:"基本信息",children:e.jsx(te,{spinning:C,children:l&&e.jsxs(d,{bordered:!0,column:2,children:[e.jsx(d.Item,{label:"品牌名称",children:l.name}),e.jsx(d.Item,{label:"状态",children:e.jsx(j,{color:se(l.status),children:ae(l.status)})}),e.jsx(d.Item,{label:"套餐类型",children:e.jsx(j,{color:ne(l.planType),children:le(l.planType)})}),e.jsx(d.Item,{label:"负责人",children:l.owner.name}),e.jsx(d.Item,{label:"负责人邮箱",children:l.owner.email}),e.jsxs(d.Item,{label:"商务账号",children:[((f=l._count)==null?void 0:f.staff)||0," / ",l.staffLimit,l.bonusStaff?e.jsxs(j,{color:"green",style:{marginLeft:8},children:["赠送 +",l.bonusStaff]}):null]}),e.jsxs(d.Item,{label:"达人数量",children:[((k=l._count)==null?void 0:k.influencers)||0," / ",l.influencerLimit,l.bonusInfluencer?e.jsxs(j,{color:"green",style:{marginLeft:8},children:["赠送 +",l.bonusInfluencer]}):null]}),e.jsx(d.Item,{label:"合作数量",children:((o=l._count)==null?void 0:o.collaborations)||0}),e.jsxs(d.Item,{label:"套餐到期",children:[l.planExpiresAt?new Date(l.planExpiresAt).toLocaleDateString("zh-CN"):"永久",l.bonusDays?e.jsxs(j,{color:"green",style:{marginLeft:8},children:["赠送 +",l.bonusDays,"天"]}):null]}),e.jsx(d.Item,{label:"创建时间",children:new Date(l.createdAt).toLocaleDateString("zh-CN")}),e.jsx(d.Item,{label:"更新时间",children:new Date(l.updatedAt).toLocaleDateString("zh-CN")})]})})},{key:"staff",label:`商务团队 (${I.length})`,children:e.jsx("div",{children:e.jsx(U,{columns:m,dataSource:I,rowKey:"id",loading:C,pagination:!1})})}];return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:l?`品牌详情 - ${l.name}`:"品牌详情",open:x,onCancel:y,footer:null,width:900,destroyOnClose:!0,children:e.jsx(ie,{activeKey:$,onChange:L,items:T})}),e.jsx(Qe,{staffId:P,visible:g,onClose:()=>{A(!1),D(null)}})]})},{Option:p}=G,He={FREE:{staffLimit:3,influencerLimit:100,days:0},PERSONAL:{staffLimit:1,influencerLimit:50,days:30},PROFESSIONAL:{staffLimit:10,influencerLimit:500,days:365},ENTERPRISE:{staffLimit:50,influencerLimit:2e3,days:365}},Tt=({onRefresh:i})=>{const[x,y]=n.useState(!1),[C,h]=n.useState([]),[l,N]=n.useState(0),[I,v]=n.useState({page:1,pageSize:10}),[$,L]=n.useState(!1),[g,A]=n.useState(null),[P,D]=n.useState(!1),[V,R]=n.useState(null),[c]=w.useForm(),[m,T]=n.useState(0),[f,k]=n.useState(0),[o,a]=n.useState(0),b=async()=>{y(!0);try{const t=await Ie(I);h(t.data),N(t.total)}catch(t){u.error("加载品牌列表失败"),console.error(t)}finally{y(!1)}};n.useEffect(()=>{b()},[I]);const H=async(t,s)=>{try{await Ee(t,s),u.success(s==="APPROVED"?"已通过审核":"已拒绝申请"),b(),i==null||i()}catch(r){u.error("操作失败"),console.error(r)}},X=async(t,s)=>{try{await Ce(t,s),u.success(s?"已暂停品牌":"已恢复品牌"),b(),i==null||i()}catch(r){u.error("操作失败"),console.error(r)}},ce=t=>{R(t),D(!0)},de=t=>{const s=He[t];if(s)if(c.setFieldsValue({staffLimit:s.staffLimit,influencerLimit:s.influencerLimit}),s.days>0){const r=z().add(s.days,"day");c.setFieldsValue({planExpiresAt:r})}else c.setFieldsValue({planExpiresAt:null});T(0),k(0),a(0)},ue=t=>{A(t),c.setFieldsValue({planType:t.planType,staffLimit:t.staffLimit,influencerLimit:t.influencerLimit,planExpiresAt:t.planExpiresAt?z(t.planExpiresAt):null,isPaid:t.isPaid}),T(0),k(0),a(0),L(!0)},fe=()=>{const t=c.getFieldValue("staffLimit")||0,s=c.getFieldValue("influencerLimit")||0,r=c.getFieldValue("planExpiresAt");if(m>0&&c.setFieldsValue({staffLimit:t+m}),f>0&&c.setFieldsValue({influencerLimit:s+f}),o>0&&r){const S=z(r).add(o,"day");c.setFieldsValue({planExpiresAt:S})}else if(o>0&&!r){const S=z().add(o,"day");c.setFieldsValue({planExpiresAt:S})}u.success("已应用赠送额度")},me=async()=>{if(g)try{const t=await c.validateFields();let s=t.staffLimit+m,r=t.influencerLimit+f,S=t.planExpiresAt;o>0&&(S?S=z(S).add(o,"day"):S=z().add(o,"day"));const pe={...t,staffLimit:s,influencerLimit:r,planExpiresAt:S?S.toISOString():null,bonusStaff:(g.bonusStaff||0)+m,bonusInfluencer:(g.bonusInfluencer||0)+f,bonusDays:(g.bonusDays||0)+o};if(await be(g.id,pe),m>0||f>0||o>0){const _=[];m>0&&_.push(`商务+${m}`),f>0&&_.push(`达人+${f}`),o>0&&_.push(`天数+${o}`),u.success(`更新成功，已应用赠送：${_.join("，")}`)}else u.success("更新成功");L(!1),b(),i==null||i()}catch(t){u.error("更新失败"),console.error(t)}},xe=async t=>{try{await ve(t),u.success("删除成功"),b(),i==null||i()}catch(s){u.error("删除失败"),console.error(s)}},he=[{title:"品牌名称",dataIndex:"name",key:"name",width:150},{title:"负责人",dataIndex:["owner","name"],key:"ownerName",width:100},{title:"手机号",dataIndex:["owner","phone"],key:"ownerPhone",width:130,render:t=>t||"-"},{title:"邮箱",dataIndex:["owner","email"],key:"ownerEmail",width:180,ellipsis:!0,render:t=>!t||t.includes("@phone.local")||t.includes("@temp.local")?"-":t},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(j,{color:se(t),children:ae(t)})},{title:"套餐",dataIndex:"planType",key:"planType",width:100,render:t=>e.jsx(j,{color:ne(t),children:le(t)})},{title:"剩余天数",key:"daysRemaining",width:100,render:(t,s)=>{if(!s.planExpiresAt)return e.jsx("span",{style:{color:"#999"},children:"未设置"});const r=Math.ceil((new Date(s.planExpiresAt).getTime()-Date.now())/(1e3*60*60*24));return r<=0?e.jsx(j,{color:"red",children:"已到期"}):r<=5?e.jsxs(j,{color:"orange",children:[r," 天"]}):r<=30?e.jsxs(j,{color:"gold",children:[r," 天"]}):e.jsxs("span",{style:{color:"#52c41a"},children:[r," 天"]})}},{title:"锁定状态",dataIndex:"isLocked",key:"isLocked",width:90,render:t=>t?e.jsx(j,{color:"red",icon:e.jsx($e,{}),children:"已锁定"}):e.jsx(j,{color:"green",icon:e.jsx(Ve,{}),children:"正常"})},{title:"商务/上限",key:"staffCount",width:100,render:(t,s)=>{var r;return e.jsxs("span",{children:[((r=s._count)==null?void 0:r.staff)||0," / ",s.staffLimit]})}},{title:"达人/上限",key:"influencerCount",width:100,render:(t,s)=>{var r;return e.jsxs("span",{children:[((r=s._count)==null?void 0:r.influencers)||0," / ",s.influencerLimit]})}},{title:"合作数",dataIndex:["_count","collaborations"],key:"collaborations",width:80,render:t=>t||0},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:120,render:t=>new Date(t).toLocaleDateString("zh-CN")},{title:"操作",key:"actions",width:250,fixed:"right",render:(t,s)=>e.jsxs(Y,{size:"small",children:[e.jsx(F,{title:"查看详情",children:e.jsx(E,{size:"small",icon:e.jsx(re,{}),onClick:()=>ce(s.id)})}),s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"通过",children:e.jsx(E,{type:"primary",size:"small",icon:e.jsx(Oe,{}),onClick:()=>H(s.id,"APPROVED")})}),e.jsx(Q,{title:"确定拒绝此品牌的入驻申请吗？",onConfirm:()=>H(s.id,"REJECTED"),children:e.jsx(F,{title:"拒绝",children:e.jsx(E,{danger:!0,size:"small",icon:e.jsx(Ae,{})})})})]}),s.status==="APPROVED"&&e.jsx(Q,{title:"确定暂停此品牌吗？",onConfirm:()=>X(s.id,!0),children:e.jsx(F,{title:"暂停",children:e.jsx(E,{size:"small",icon:e.jsx(qe,{})})})}),s.status==="SUSPENDED"&&e.jsx(F,{title:"恢复",children:e.jsx(E,{type:"primary",size:"small",icon:e.jsx(Ue,{}),onClick:()=>X(s.id,!1)})}),e.jsx(F,{title:"编辑",children:e.jsx(E,{size:"small",icon:e.jsx(_e,{}),onClick:()=>ue(s)})}),e.jsx(Q,{title:"确定删除此品牌吗？",description:"删除后无法恢复，相关数据也会被清除",onConfirm:()=>xe(s.id),okText:"确定",cancelText:"取消",okButtonProps:{danger:!0},children:e.jsx(F,{title:"删除",children:e.jsx(E,{danger:!0,size:"small",icon:e.jsx(Be,{})})})})]})}];return e.jsxs("div",{children:[e.jsxs(Y,{style:{marginBottom:16},wrap:!0,children:[e.jsx(Pe,{placeholder:"搜索品牌名称/负责人",prefix:e.jsx(Re,{}),style:{width:200},allowClear:!0,onChange:t=>v(s=>({...s,keyword:t.target.value,page:1}))}),e.jsxs(G,{placeholder:"状态",style:{width:120},allowClear:!0,onChange:t=>v(s=>({...s,status:t,page:1})),children:[e.jsx(p,{value:"PENDING",children:"待审核"}),e.jsx(p,{value:"APPROVED",children:"已通过"}),e.jsx(p,{value:"REJECTED",children:"已拒绝"}),e.jsx(p,{value:"SUSPENDED",children:"已暂停"})]}),e.jsxs(G,{placeholder:"套餐",style:{width:120},allowClear:!0,onChange:t=>v(s=>({...s,planType:t,page:1})),children:[e.jsx(p,{value:"FREE",children:"免费版"}),e.jsx(p,{value:"PERSONAL",children:"个人版"}),e.jsx(p,{value:"PROFESSIONAL",children:"专业版"}),e.jsx(p,{value:"ENTERPRISE",children:"企业版"})]})]}),e.jsx(U,{columns:he,dataSource:C,rowKey:"id",loading:x,scroll:{x:1500},pagination:{current:I.page,pageSize:I.pageSize,total:l,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条`,onChange:(t,s)=>v(r=>({...r,page:t,pageSize:s}))}}),e.jsx(W,{title:"编辑品牌",open:$,onOk:me,onCancel:()=>L(!1),okText:"保存",cancelText:"取消",width:520,children:e.jsxs(w,{form:c,layout:"vertical",children:[e.jsx(w.Item,{name:"planType",label:"套餐类型",rules:[{required:!0,message:"请选择套餐类型"}],children:e.jsxs(G,{onChange:de,children:[e.jsx(p,{value:"FREE",children:"免费版"}),e.jsx(p,{value:"PERSONAL",children:"个人版"}),e.jsx(p,{value:"PROFESSIONAL",children:"专业版"}),e.jsx(p,{value:"ENTERPRISE",children:"企业版"})]})}),e.jsx(Z,{style:{margin:"12px 0"},children:"配额设置"}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx(w.Item,{name:"staffLimit",label:"商务账号上限",rules:[{required:!0,message:"请输入"}],style:{flex:1},children:e.jsx(O,{min:1,style:{width:"100%"}})}),e.jsx(w.Item,{label:e.jsxs(e.Fragment,{children:[e.jsx(J,{})," 赠送"]}),style:{width:120},children:e.jsx(O,{min:0,value:m,onChange:t=>T(t||0),placeholder:"0",style:{width:"100%"}})})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx(w.Item,{name:"influencerLimit",label:"达人数量上限",rules:[{required:!0,message:"请输入"}],style:{flex:1},children:e.jsx(O,{min:1,style:{width:"100%"}})}),e.jsx(w.Item,{label:e.jsxs(e.Fragment,{children:[e.jsx(J,{})," 赠送"]}),style:{width:120},children:e.jsx(O,{min:0,value:f,onChange:t=>k(t||0),placeholder:"0",style:{width:"100%"}})})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx(w.Item,{name:"planExpiresAt",label:"套餐到期时间",style:{flex:1},children:e.jsx(ze,{style:{width:"100%"},placeholder:"留空表示永不过期"})}),e.jsx(w.Item,{label:e.jsxs(e.Fragment,{children:[e.jsx(J,{})," 赠送天数"]}),style:{width:120},children:e.jsx(O,{min:0,value:o,onChange:t=>a(t||0),placeholder:"0",style:{width:"100%"}})})]}),(m>0||f>0||o>0)&&e.jsx("div",{style:{marginBottom:16},children:e.jsxs(E,{type:"dashed",icon:e.jsx(J,{}),onClick:fe,block:!0,children:["应用赠送额度 (商务+",m,", 达人+",f,", 天数+",o,")"]})}),e.jsx(Z,{style:{margin:"12px 0"},children:"付费状态"}),e.jsx(w.Item,{name:"isPaid",label:"是否付费用户",valuePropName:"checked",children:e.jsx(Ne,{checkedChildren:"已付费",unCheckedChildren:"试用中"})})]})}),e.jsx(We,{brandId:V,visible:P,onClose:()=>{D(!1),R(null)}})]})};export{Tt as F};
