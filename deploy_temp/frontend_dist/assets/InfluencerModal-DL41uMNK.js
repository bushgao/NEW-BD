import{r as I,j as e}from"./index-CT9F3akh.js";import{P as k,u as v,m as F,n as U}from"./influencer.service-CIZYR2fC.js";import{F as r}from"./index-gbW5J2sR.js";import{M as S}from"./index-CxrQydPb.js";import{A as E}from"./index-C7lyzjCv.js";import{I as l}from"./index-htVVH06X.js";import{S as g}from"./index-DfnzXlZl.js";import{s as c}from"./index-DBkC0DaV.js";const R=({visible:h,influencer:a,onClose:x,allCategories:b,allTags:D})=>{var f;const[d]=r.useForm(),[y,j]=I.useState(!1),[m,n]=I.useState(null),p=!!a;I.useEffect(()=>{h&&(a?d.setFieldsValue({nickname:a.nickname,platform:a.platform,platformId:a.platformId,uid:a.uid||"",homeUrl:a.homeUrl||"",phone:a.phone||"",wechat:a.wechat||"",shippingAddress:a.shippingAddress||"",categories:a.categories,tags:a.tags,notes:a.notes||""}):d.resetFields(),n(null))},[h,a,d]);const u=async()=>{var i;const s=d.getFieldsValue(["phone","platform","platformId"]);if(!(!s.platform||!s.platformId))try{const o=await U(s.phone,s.platform,s.platformId);o.isDuplicate?p&&((i=o.existingInfluencer)==null?void 0:i.id)===(a==null?void 0:a.id)?n(null):n(o):n(null)}catch(o){console.error("Duplicate check failed:",o)}},A=async()=>{var s,i,o;try{const t=await d.validateFields();j(!0);const w={nickname:t.nickname,platform:t.platform,platformId:t.platformId,uid:t.uid||void 0,homeUrl:t.homeUrl||void 0,phone:t.phone||void 0,wechat:t.wechat||void 0,shippingAddress:t.shippingAddress||void 0,categories:t.categories||[],tags:t.tags||[],notes:t.notes||void 0};p?(await v(a.id,w),c.success("更新成功")):(await F(w),c.success("添加成功")),x(!0)}catch(t){(o=(i=(s=t.response)==null?void 0:s.data)==null?void 0:i.error)!=null&&o.message?c.error(t.response.data.error.message):t.errorFields||c.error(p?"更新失败":"添加失败")}finally{j(!1)}};return e.jsxs(S,{title:p?"编辑达人":"添加达人",open:h,onOk:A,onCancel:()=>x(),confirmLoading:y,width:600,destroyOnClose:!0,children:[m&&e.jsx(E,{type:"warning",showIcon:!0,style:{marginBottom:16},message:`检测到重复: ${m.duplicateType==="phone"?"手机号":m.duplicateType==="platformId"?"平台账号ID":"手机号和平台账号ID"}已存在`,description:`已存在达人: ${(f=m.existingInfluencer)==null?void 0:f.nickname}`}),e.jsxs(r,{form:d,layout:"vertical",children:[e.jsx(r.Item,{name:"nickname",label:"达人昵称",rules:[{required:!0,message:"请输入达人昵称"}],children:e.jsx(l,{placeholder:"请输入达人昵称"})}),e.jsx(r.Item,{name:"platform",label:"平台",rules:[{required:!0,message:"请选择平台"}],children:e.jsx(g,{placeholder:"请选择平台",onChange:u,options:Object.entries(k).map(([s,i])=>({value:s,label:i}))})}),e.jsx(r.Item,{name:"platformId",label:"平台账号ID",rules:[{required:!0,message:"请输入平台账号ID"}],children:e.jsx(l,{placeholder:"请输入平台账号ID",onBlur:u})}),e.jsx(r.Item,{name:"uid",label:"UID",children:e.jsx(l,{placeholder:"请输入达人UID（可选）"})}),e.jsx(r.Item,{name:"homeUrl",label:"主页",children:e.jsx(l,{placeholder:"请输入主页链接（可选）"})}),e.jsx(r.Item,{name:"phone",label:"手机号",children:e.jsx(l,{placeholder:"请输入手机号",onBlur:u})}),e.jsx(r.Item,{name:"wechat",label:"微信号",children:e.jsx(l,{placeholder:"请输入微信号"})}),e.jsx(r.Item,{name:"shippingAddress",label:"收件地址",children:e.jsx(l.TextArea,{rows:2,placeholder:"请输入收件地址（可选）"})}),e.jsx(r.Item,{name:"categories",label:"类目",children:e.jsx(g,{mode:"tags",placeholder:"请选择或输入类目",options:b.map(s=>({value:s,label:s}))})}),e.jsx(r.Item,{name:"tags",label:"标签",children:e.jsx(g,{mode:"tags",placeholder:"请选择或输入标签",options:D.map(s=>({value:s,label:s}))})}),e.jsx(r.Item,{name:"notes",label:"备注",children:e.jsx(l.TextArea,{rows:3,placeholder:"请输入备注"})})]})]})};export{R as I};
