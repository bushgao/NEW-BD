import{r as s,j as e,S as U}from"./index-CT9F3akh.js";import{a as d}from"./api-W_2ufh2E.js";import{F as p}from"./index-gbW5J2sR.js";import{C as W}from"./index-DSHlf2Aa.js";import{T as Q,R as I}from"./index-WSGRBNKI.js";import{E as v}from"./index-DfnzXlZl.js";import{B as a}from"./button-BCSOJgfZ.js";import{F as H}from"./Table-pvERNZVb.js";import{S as m}from"./index-B4IHrhqI.js";import{R as K}from"./ReloadOutlined-C8FTNWWf.js";import{R as Y}from"./BellOutlined-Byee07wo.js";import{M as k}from"./index-CxrQydPb.js";import{I as D,R as J}from"./index-htVVH06X.js";import{T as u}from"./index-DnlS8_jt.js";import{s as i}from"./index-DBkC0DaV.js";import{S as X}from"./index-2ffhpgky.js";import{R as Z}from"./CloseCircleOutlined-D2hdQaev.js";import{R as ee}from"./CheckCircleOutlined-eJc7nheY.js";import{T as F}from"./TextArea-Dl3y1VrD.js";import"./Input-UrGHJeeK.js";import"./row-DVjUYxl3.js";import"./index-BoArUKpt.js";import"./useBreakpoint--6XYT0_e.js";import"./QuestionCircleOutlined-CZssou_a.js";import"./Skeleton-DdNqplha.js";import"./index-DiUoGV2L.js";import"./EllipsisOutlined-Bv641ndy.js";import"./Overflow-Gz7ZFAqv.js";import"./PlusOutlined-oMbGAVrA.js";import"./UnstableContext-DKFbPjPy.js";import"./PurePanel-DcW2x34y.js";import"./SearchOutlined-CyHaylvE.js";import"./index-Do9OUhYv.js";import"./index-Dd1FzYQF.js";import"./index-BndKrrhJ.js";import"./LeftOutlined-DGEyRIvL.js";import"./Pagination-6AhiOKxV.js";import"./extendsObject-78o_rR5W.js";import"./ActionButton-DPGDuFxb.js";import"./fade-pCPugiYp.js";const{Title:M,Text:_,Paragraph:A}=Q,{TextArea:te}=D,n={WELCOME:{label:"欢迎消息",color:"green"},DEADLINE_APPROACHING:{label:"到期提醒",color:"orange"},DEADLINE_OVERDUE:{label:"超期警告",color:"red"},SAMPLE_NOT_RECEIVED:{label:"样品未签收",color:"purple"},RESULT_NOT_RECORDED:{label:"结果待录入",color:"blue"}},Be=()=>{var b,S,R,T,w,C;const[h,N]=s.useState([]),[P,c]=s.useState(!0),[L,x]=s.useState(!1),[O,y]=s.useState(!1),[r,j]=s.useState(null),[$,g]=s.useState(!1),[f]=p.useForm(),l=async()=>{try{c(!0);const t=await d.get("/notification-templates");t.data.success&&N(t.data.data)}catch(t){console.error("Failed to load templates:",t),i.error("加载通知模板失败")}finally{c(!1)}},E=async()=>{try{c(!0),await d.post("/notification-templates/seed"),i.success("默认模板初始化成功"),l()}catch(t){console.error("Failed to seed templates:",t),i.error("初始化模板失败")}finally{c(!1)}};s.useEffect(()=>{l()},[]);const V=t=>{j(t),f.setFieldsValue({title:t.title,content:t.content}),x(!0)},z=t=>{j(t),y(!0)},B=async()=>{if(r)try{const t=await f.validateFields();g(!0),await d.put(`/notification-templates/${r.type}`,{title:t.title,content:t.content}),i.success("模板保存成功"),x(!1),l()}catch(t){console.error("Failed to save template:",t),i.error("保存失败")}finally{g(!1)}},q=async t=>{try{await d.put(`/notification-templates/${t.type}`,{isEnabled:!t.isEnabled}),i.success(`通知已${t.isEnabled?"禁用":"启用"}`),l()}catch(o){console.error("Failed to toggle template:",o),i.error("操作失败")}},G=[{title:"通知类型",dataIndex:"type",key:"type",width:150,render:t=>{const o=n[t]||{label:t,color:"default"};return e.jsx(u,{color:o.color,children:o.label})}},{title:"标题",dataIndex:"title",key:"title",render:t=>e.jsx(_,{strong:!0,style:{fontSize:14},children:t})},{title:"内容预览",dataIndex:"content",key:"content",ellipsis:!0,render:t=>e.jsxs(_,{type:"secondary",style:{fontSize:13},children:[t.substring(0,50),"..."]})},{title:"状态",dataIndex:"isEnabled",key:"isEnabled",width:100,render:(t,o)=>e.jsx(X,{checked:t,onChange:()=>q(o),checkedChildren:e.jsx(ee,{}),unCheckedChildren:e.jsx(Z,{})})},{title:"操作",key:"actions",width:150,render:(t,o)=>e.jsxs(m,{children:[e.jsx(F,{title:"预览",children:e.jsx(a,{type:"text",icon:e.jsx(J,{}),onClick:()=>z(o)})}),e.jsx(F,{title:"编辑",children:e.jsx(a,{type:"text",icon:e.jsx(I,{}),onClick:()=>V(o)})})]})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(W,{title:e.jsxs(m,{children:[e.jsx(Y,{style:{fontSize:20,color:"#6366f1"}}),e.jsx(M,{level:4,style:{margin:0},children:"消息通知设置"})]}),extra:e.jsxs(m,{children:[e.jsx(a,{icon:e.jsx(K,{}),onClick:l,children:"刷新"}),h.length===0&&e.jsx(a,{type:"primary",onClick:E,children:"初始化默认模板"})]}),children:[e.jsx(A,{type:"secondary",style:{marginBottom:24},children:"配置系统发送给用户的各类通知消息内容。您可以编辑通知的标题和内容，或禁用特定类型的通知。"}),P?e.jsx("div",{style:{textAlign:"center",padding:"60px 0"},children:e.jsx(U,{size:"large"})}):h.length===0?e.jsx(v,{description:"暂无通知模板",image:v.PRESENTED_IMAGE_SIMPLE,children:e.jsx(a,{type:"primary",onClick:E,children:"初始化默认模板"})}):e.jsx(H,{columns:G,dataSource:h,rowKey:"id",pagination:!1})]}),e.jsx(k,{title:e.jsxs(m,{children:[e.jsx(I,{}),e.jsx("span",{children:"编辑通知模板"}),r&&e.jsx(u,{color:((b=n[r.type])==null?void 0:b.color)||"default",children:((S=n[r.type])==null?void 0:S.label)||r.type})]}),open:L,onCancel:()=>x(!1),onOk:B,confirmLoading:$,width:600,children:e.jsxs(p,{form:f,layout:"vertical",style:{marginTop:16},children:[e.jsx(p.Item,{name:"title",label:"通知标题",rules:[{required:!0,message:"请输入通知标题"}],children:e.jsx(D,{placeholder:"输入通知标题"})}),e.jsx(p.Item,{name:"content",label:"通知内容",rules:[{required:!0,message:"请输入通知内容"}],extra:"支持变量：{{influencerName}}(达人名称)，{{deadline}}(截止日期)",children:e.jsx(te,{rows:6,placeholder:"输入通知内容",style:{fontFamily:"monospace"}})})]})}),e.jsx(k,{title:"通知预览",open:O,onCancel:()=>y(!1),footer:null,width:500,children:r&&e.jsxs("div",{style:{padding:20,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:12,color:"white"},children:[e.jsx("div",{style:{marginBottom:12},children:e.jsx(u,{color:((R=n[r.type])==null?void 0:R.color)||"default",children:((T=n[r.type])==null?void 0:T.label)||r.type})}),e.jsx(M,{level:4,style:{color:"white",marginBottom:12},children:r.title}),e.jsx(A,{style:{color:"rgba(255,255,255,0.9)",whiteSpace:"pre-wrap"},children:r.content}),((w=r.metadata)==null?void 0:w.showQrCode)&&e.jsxs("div",{style:{marginTop:16,padding:16,background:"white",borderRadius:8,textAlign:"center"},children:[e.jsx("img",{src:(C=r.metadata)==null?void 0:C.qrCodeUrl,alt:"WeChat QR",style:{maxWidth:150,borderRadius:8}}),e.jsx("div",{style:{color:"#666",fontSize:12,marginTop:8},children:"扫码添加微信"})]})]})})]})};export{Be as default};
