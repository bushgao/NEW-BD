import{r as a,_ as U,e as W,j as e,S as G}from"./index-CT9F3akh.js";import{C as F,b as q,a as K}from"./Card-D9YXdlEe.js";import{a as Q,g as Y,m as J,c as X,b as Z,d as ee,R as te}from"./notification.service-DYG9haj_.js";import{s as n}from"./index-DBkC0DaV.js";import{S as x}from"./index-B4IHrhqI.js";import{R as w}from"./BellOutlined-Byee07wo.js";import{B as f}from"./button-BCSOJgfZ.js";import{I as se,R as k}from"./TextArea-Dl3y1VrD.js";import{P as S}from"./index-C7D5ByUV.js";import{T as re}from"./index-DiUoGV2L.js";import{E as N}from"./index-DfnzXlZl.js";import{L as j}from"./index-B-vfV2rY.js";import{B as $}from"./index-6l5o2ZFH.js";import{T as oe}from"./index-WSGRBNKI.js";import{T as ae}from"./index-DnlS8_jt.js";import{R as ne}from"./DeleteOutlined-TK3JP8uX.js";import{R as ie}from"./FileTextOutlined-D1SgpYty.js";import{R as ce}from"./GiftOutlined-B6rzlFEA.js";import{R as le}from"./ClockCircleOutlined-DAoco557.js";import{R as de}from"./WechatOutlined-CWc0mZPo.js";import"./api-W_2ufh2E.js";import"./UnstableContext-DKFbPjPy.js";import"./index-Do9OUhYv.js";import"./index-DTiWaDVa.js";import"./ActionButton-DPGDuFxb.js";import"./EllipsisOutlined-Bv641ndy.js";import"./Overflow-Gz7ZFAqv.js";import"./PlusOutlined-oMbGAVrA.js";import"./PurePanel-DcW2x34y.js";import"./SearchOutlined-CyHaylvE.js";import"./extendsObject-78o_rR5W.js";import"./useBreakpoint--6XYT0_e.js";import"./row-DVjUYxl3.js";import"./index-BoArUKpt.js";import"./Pagination-6AhiOKxV.js";import"./LeftOutlined-DGEyRIvL.js";var pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},fe=function(i,m){return a.createElement(se,U({},i,{ref:m,icon:pe}))},me=a.forwardRef(fe);const{Text:A,Paragraph:he}=oe,ge={WELCOME:{icon:e.jsx(de,{}),color:"success",label:"欢迎消息"},DEADLINE_APPROACHING:{icon:e.jsx(le,{}),color:"warning",label:"即将到期"},DEADLINE_OVERDUE:{icon:e.jsx(te,{}),color:"error",label:"已超期"},SAMPLE_NOT_RECEIVED:{icon:e.jsx(ce,{}),color:"processing",label:"样品未签收"},RESULT_NOT_RECORDED:{icon:e.jsx(ie,{}),color:"default",label:"待录入结果"}},Xe=()=>{const[l,i]=a.useState([]),[m,y]=a.useState(!1),[M,R]=a.useState(0),[h,b]=a.useState(1),[g]=a.useState(20),[d,z]=a.useState("all"),[C,p]=a.useState(0),u=a.useCallback(async()=>{y(!0);try{const t={page:h,pageSize:g};d==="unread"&&(t.isRead=!1);const s=await Q(t);s.success&&s.data&&(i(s.data.data),R(s.data.total))}catch{n.error("加载通知失败")}finally{y(!1)}},[h,g,d]),v=a.useCallback(async()=>{try{const t=await Y();t.success&&t.data&&p(t.data.count)}catch(t){console.error("加载未读数量失败:",t)}},[]);a.useEffect(()=>{u(),v()},[u,v]);const D=async t=>{try{(await Z(t)).success&&(i(o=>o.map(r=>r.id===t?{...r,isRead:!0}:r)),p(o=>Math.max(0,o-1)),n.success("已标记为已读"))}catch{n.error("操作失败")}},O=async()=>{var t;try{const s=await J();s.success&&(i(o=>o.map(r=>({...r,isRead:!0}))),p(0),n.success(((t=s.data)==null?void 0:t.message)||"已全部标记为已读"))}catch{n.error("操作失败")}},_=async t=>{try{if((await ee(t)).success){const o=l.find(r=>r.id===t);i(r=>r.filter(c=>c.id!==t)),R(r=>r-1),o&&!o.isRead&&p(r=>Math.max(0,r-1)),n.success("通知已删除")}}catch{n.error("删除失败")}},H=async()=>{var t;try{const s=await X();s.success&&(i(o=>o.filter(r=>!r.isRead)),u(),n.success(((t=s.data)==null?void 0:t.message)||"已清空已读通知"))}catch{n.error("操作失败")}},L=t=>{const s=new Date(t),r=new Date().getTime()-s.getTime(),c=Math.floor(r/6e4),I=Math.floor(r/36e5),T=Math.floor(r/864e5);return c<1?"刚刚":c<60?`${c}分钟前`:I<24?`${I}小时前`:T<7?`${T}天前`:s.toLocaleDateString("zh-CN")},P=t=>ge[t]||{icon:e.jsx(w,{}),color:"default",label:"通知"},B=t=>{const s=P(t.type),o=t.type==="WELCOME";return e.jsx(j.Item,{style:{backgroundColor:t.isRead?"transparent":"#f6ffed",padding:"16px",borderRadius:6,marginBottom:8},actions:[!t.isRead&&e.jsx(f,{type:"link",size:"small",icon:e.jsx(k,{}),onClick:()=>D(t.id),children:"标记已读"},"read"),e.jsx(S,{title:"确定删除此通知？",onConfirm:()=>_(t.id),okText:"确定",cancelText:"取消",children:e.jsx(f,{type:"link",size:"small",danger:!0,icon:e.jsx(ne,{}),children:"删除"})},"delete")].filter(Boolean),children:e.jsx(j.Item.Meta,{avatar:e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:`var(--ant-color-${s.color}-bg)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,color:`var(--ant-color-${s.color})`},children:s.icon}),title:e.jsxs(x,{children:[e.jsx(A,{strong:!t.isRead,children:t.title}),e.jsx(ae,{color:s.color,children:s.label}),!t.isRead&&e.jsx($,{status:"processing"})]}),description:e.jsxs("div",{children:[e.jsx(he,{style:{marginBottom:4,color:t.isRead?"#999":"#333",whiteSpace:"pre-wrap"},ellipsis:o?!1:{rows:2},children:t.content}),o&&e.jsxs("div",{style:{marginTop:12,padding:16,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:12,display:"inline-block"},children:[e.jsx("img",{src:"/wechat-demo-qr.jpg",alt:"WeChat QR Code",style:{width:120,height:120,borderRadius:8,display:"block"}}),e.jsx("div",{style:{color:"white",fontSize:12,textAlign:"center",marginTop:8},children:"扫码添加微信"})]}),e.jsx("div",{style:{marginTop:8},children:e.jsx(A,{type:"secondary",style:{fontSize:12},children:L(t.createdAt)})})]})})})},V=[{key:"all",label:"全部通知"},{key:"unread",label:e.jsx($,{count:C,offset:[10,0],children:"未读通知"})}],{theme:E}=W();return e.jsxs("div",{style:{minHeight:"100vh",background:`linear-gradient(135deg, ${E.colors.background.secondary} 0%, ${E.colors.background.tertiary} 100%)`,position:"relative",padding:"24px",margin:"-24px"},children:[e.jsx("div",{style:{position:"absolute",top:"10%",left:"5%",width:"400px",height:"400px",background:"linear-gradient(135deg, rgba(90, 200, 250, 0.08), rgba(191, 90, 242, 0.08))",borderRadius:"50%",filter:"blur(80px)",pointerEvents:"none",zIndex:0}}),e.jsx("div",{style:{position:"absolute",top:"40%",right:"10%",width:"500px",height:"500px",background:"linear-gradient(135deg, rgba(255, 107, 107, 0.08), rgba(255, 217, 61, 0.08))",borderRadius:"50%",filter:"blur(100px)",pointerEvents:"none",zIndex:0}}),e.jsx("div",{style:{position:"relative",zIndex:1},children:e.jsxs(F,{variant:"elevated",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[e.jsx(q,{level:4,style:{margin:0},children:e.jsxs(x,{children:[e.jsx(w,{}),e.jsx("span",{children:"通知中心"})]})}),e.jsxs(x,{children:[e.jsx(f,{icon:e.jsx(k,{}),onClick:O,disabled:C===0,children:"全部已读"}),e.jsx(S,{title:"确定清空所有已读通知？",onConfirm:H,okText:"确定",cancelText:"取消",children:e.jsx(f,{icon:e.jsx(me,{}),children:"清空已读"})})]})]}),e.jsxs(K,{children:[e.jsx(re,{activeKey:d,onChange:t=>{z(t),b(1)},items:V}),e.jsx(G,{spinning:m,children:l.length===0?e.jsx(N,{image:N.PRESENTED_IMAGE_SIMPLE,description:d==="unread"?"暂无未读通知":"暂无通知"}):e.jsx(j,{dataSource:l,renderItem:B,pagination:{current:h,pageSize:g,total:M,onChange:b,showSizeChanger:!1,showTotal:t=>`共 ${t} 条通知`}})})]})]})})]})};export{Xe as default};
