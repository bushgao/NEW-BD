import{e as te,r as n,j as t}from"./index-CT9F3akh.js";import{w as se,n as re,x as ne,o as oe,v as ie}from"./platform.service-DL6LgE4V.js";import{d as ae}from"./CalendarOutlined-6RDrkSku.js";import{s as o}from"./index-DBkC0DaV.js";import{T as le,R as de}from"./index-WSGRBNKI.js";import{S as R}from"./index-B4IHrhqI.js";import{I as ce}from"./index-htVVH06X.js";import{R as pe}from"./SearchOutlined-CyHaylvE.js";import{B as c}from"./button-BCSOJgfZ.js";import{F as me}from"./Table-pvERNZVb.js";import{M as y}from"./index-CxrQydPb.js";import{S as E}from"./index-DfnzXlZl.js";import{D as he}from"./index-DVFXVRcq.js";import{S as ue}from"./index-2ffhpgky.js";import{T as i}from"./index-DnlS8_jt.js";import{R as xe}from"./LockOutlined-DjHtpiEB.js";import{R as ge}from"./UnlockOutlined-DSEY7w_e.js";import{R as fe}from"./TeamOutlined-Bai9oLhN.js";import"./api-W_2ufh2E.js";import"./TextArea-Dl3y1VrD.js";import"./PurePanel-DcW2x34y.js";import"./Overflow-Gz7ZFAqv.js";import"./UnstableContext-DKFbPjPy.js";import"./Input-UrGHJeeK.js";import"./index-Do9OUhYv.js";import"./index-Dd1FzYQF.js";import"./index-BndKrrhJ.js";import"./LeftOutlined-DGEyRIvL.js";import"./EllipsisOutlined-Bv641ndy.js";import"./useBreakpoint--6XYT0_e.js";import"./Pagination-6AhiOKxV.js";import"./extendsObject-78o_rR5W.js";import"./ActionButton-DPGDuFxb.js";import"./Skeleton-DdNqplha.js";import"./index-BoArUKpt.js";import"./fade-pCPugiYp.js";import"./ClockCircleOutlined-DAoco557.js";const{Title:ye}=le;function st(){const{theme:j}=te(),[P,S]=n.useState(!1),[z,L]=n.useState([]),[O,D]=n.useState(0),[p,w]=n.useState(1),[m,$]=n.useState(20),[k,M]=n.useState(""),[F,h]=n.useState(!1),[l,U]=n.useState(null),[_,K]=n.useState([]),[u,v]=n.useState(""),[N,C]=n.useState(!1),[H,x]=n.useState(!1),[a,J]=n.useState(null),[g,f]=n.useState(null),[I,b]=n.useState(!1),[Q,T]=n.useState(!1);n.useEffect(()=>{d()},[p,m]),n.useEffect(()=>{V()},[]);const d=async()=>{S(!0);try{const e=await se({page:p,pageSize:m,keyword:k||void 0});L(e.data),D(e.total)}catch(e){o.error(e.message||"加载独立商务列表失败")}finally{S(!1)}},V=async()=>{try{const e=await re({page:1,pageSize:100,status:"APPROVED"});K(e.data.map(s=>({id:s.id,name:s.name})))}catch(e){console.error("加载品牌列表失败",e)}},B=()=>{w(1),d()},q=e=>{U(e),v(""),h(!0)},G=async()=>{if(!l||!u){o.warning("请选择目标品牌");return}C(!0);try{await ne(l.id,u),o.success("商务已成功划归到品牌"),h(!1),d()}catch(e){o.error(e.message||"划归失败")}finally{C(!1)}},W=e=>{y.confirm({title:"确认删除",content:`确定要删除商务「${e.name}」吗？此操作不可恢复。`,okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await ie(e.id),o.success("删除成功"),d()}catch(s){o.error(s.message||"删除失败")}}})},X=e=>{var s,r;J(e),(s=e.brand)!=null&&s.planExpiresAt?f(ae(e.brand.planExpiresAt)):f(null),b(((r=e.brand)==null?void 0:r.isPaid)||!1),x(!0)},Y=async()=>{var e;if(!((e=a==null?void 0:a.brand)!=null&&e.id)){o.error("用户没有关联的工作区");return}T(!0);try{await oe(a.brand.id,{planExpiresAt:g?g.toISOString():void 0,isPaid:I}),o.success("订阅设置保存成功"),x(!1),d()}catch(s){o.error(s.message||"保存失败")}finally{T(!1)}},Z=e=>e?Math.ceil((new Date(e).getTime()-Date.now())/(1e3*60*60*24)):null,ee=[{title:"姓名",dataIndex:"name",key:"name",width:120},{title:"邮箱",dataIndex:"email",key:"email",width:180,render:e=>e!=null&&e.includes("@phone.local")?"-":e},{title:"手机号",dataIndex:"phone",key:"phone",width:130,render:e=>e||"-"},{title:"状态",dataIndex:"isActive",key:"isActive",width:80,render:e=>t.jsx(i,{color:e?"success":"error",children:e?"启用":"禁用"})},{title:"剩余天数",key:"daysRemaining",width:100,render:(e,s)=>{var A;const r=Z((A=s.brand)==null?void 0:A.planExpiresAt);return r===null?t.jsx("span",{style:{color:"#999"},children:"未设置"}):r<=0?t.jsx(i,{color:"red",children:"已到期"}):r<=5?t.jsxs(i,{color:"orange",children:[r," 天"]}):r<=30?t.jsxs(i,{color:"gold",children:[r," 天"]}):t.jsxs("span",{style:{color:"#52c41a"},children:[r," 天"]})}},{title:"锁定状态",key:"isLocked",width:100,render:(e,s)=>{var r;return(r=s.brand)!=null&&r.isLocked?t.jsx(i,{color:"red",icon:t.jsx(xe,{}),children:"已锁定"}):t.jsx(i,{color:"green",icon:t.jsx(ge,{}),children:"正常"})}},{title:"付费状态",key:"isPaid",width:100,render:(e,s)=>{var r;return(r=s.brand)!=null&&r.isPaid?t.jsx(i,{color:"blue",children:"已付费"}):t.jsx(i,{color:"default",children:"试用中"})}},{title:"注册时间",dataIndex:"createdAt",key:"createdAt",width:160,render:e=>new Date(e).toLocaleString("zh-CN")},{title:"最后登录",dataIndex:"lastLoginAt",key:"lastLoginAt",width:160,render:e=>e?new Date(e).toLocaleString("zh-CN"):"从未登录"},{title:"操作",key:"actions",width:280,fixed:"right",render:(e,s)=>t.jsxs(R,{children:[t.jsx(c,{type:"link",size:"small",icon:t.jsx(de,{}),onClick:()=>X(s),children:"订阅设置"}),t.jsx(c,{type:"link",size:"small",icon:t.jsx(fe,{}),onClick:()=>q(s),children:"划归品牌"}),t.jsx(c,{type:"link",size:"small",danger:!0,onClick:()=>W(s),children:"删除"})]})}];return t.jsx("div",{style:{minHeight:"100vh",background:`linear-gradient(135deg, ${j.colors.background.secondary} 0%, ${j.colors.background.tertiary} 100%)`,position:"relative",padding:"24px",margin:"-24px"},children:t.jsxs("div",{style:{position:"relative",zIndex:1},children:[t.jsx(ye,{level:4,style:{marginBottom:24},children:"独立商务"}),t.jsx("div",{style:{marginBottom:16},children:t.jsxs(R,{wrap:!0,children:[t.jsx(ce,{placeholder:"搜索姓名/邮箱/手机号",prefix:t.jsx(pe,{}),value:k,onChange:e=>M(e.target.value),onPressEnter:B,style:{width:220},allowClear:!0}),t.jsx(c,{type:"primary",onClick:B,children:"搜索"})]})}),t.jsx(me,{columns:ee,dataSource:z,loading:P,rowKey:"id",scroll:{x:1400},pagination:{current:p,pageSize:m,total:O,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`,onChange:(e,s)=>{w(e),$(s)}}}),t.jsxs(y,{title:"划归品牌",open:F,onOk:G,onCancel:()=>h(!1),confirmLoading:N,okText:"确认划归",children:[l&&t.jsxs("div",{style:{marginBottom:16},children:[t.jsxs("p",{children:[t.jsx("strong",{children:"商务姓名："}),l.name]}),t.jsxs("p",{children:[t.jsx("strong",{children:"邮箱："}),l.email]})]}),t.jsxs("div",{children:[t.jsx("p",{style:{marginBottom:8},children:t.jsx("strong",{children:"选择目标品牌："})}),t.jsx(E,{placeholder:"请选择品牌",style:{width:"100%"},value:u||void 0,onChange:v,showSearch:!0,optionFilterProp:"children",filterOption:(e,s)=>{var r;return(r=s==null?void 0:s.children)==null?void 0:r.toLowerCase().includes(e.toLowerCase())},children:_.map(e=>t.jsx(E.Option,{value:e.id,children:e.name},e.id))})]}),t.jsx("p",{style:{color:"#999",fontSize:12,marginTop:12},children:"划归后，该商务将隶属于所选品牌，不再显示在独立商务列表中。"})]}),t.jsxs(y,{title:`订阅设置 - ${(a==null?void 0:a.name)||""}`,open:H,onOk:Y,onCancel:()=>x(!1),confirmLoading:Q,okText:"保存",children:[t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("p",{style:{marginBottom:8},children:t.jsx("strong",{children:"套餐到期时间："})}),t.jsx(he,{value:g,onChange:f,style:{width:"100%"},placeholder:"留空表示永不过期",allowClear:!0}),t.jsx("p",{style:{color:"#999",fontSize:12,marginTop:4},children:"个人版默认30天试用期，付费后延长至365天"})]}),t.jsxs("div",{children:[t.jsx("p",{style:{marginBottom:8},children:t.jsx("strong",{children:"付费状态："})}),t.jsx(ue,{checked:I,onChange:b,checkedChildren:"已付费",unCheckedChildren:"试用中"})]})]})]})})}export{st as default};
