import{r,j as e,e as G}from"./index-CT9F3akh.js";import{e as J,f as Q,h as X,q as Y,s as Z,v as ee}from"./platform.service-DL6LgE4V.js";import{s as d}from"./index-DBkC0DaV.js";import{D as c}from"./index-BIA-WqSn.js";import{T as b}from"./index-DnlS8_jt.js";import{C as te}from"./index-DSHlf2Aa.js";import{R as ae,C as R}from"./row-DVjUYxl3.js";import{S as T}from"./index-C_yDWHqX.js";import{R as oe}from"./TeamOutlined-Bai9oLhN.js";import{R as le}from"./ProjectOutlined-CBcPNtE6.js";import{R as re}from"./TrophyOutlined-Bu28ol1a.js";import{F as _}from"./Table-pvERNZVb.js";import{M as W}from"./index-CxrQydPb.js";import{T as se}from"./index-DiUoGV2L.js";import{S as $}from"./index-B4IHrhqI.js";import{I as ne,R as ie}from"./index-htVVH06X.js";import{R as ce}from"./SearchOutlined-CyHaylvE.js";import{S as K}from"./index-DfnzXlZl.js";import{B as O}from"./button-BCSOJgfZ.js";import{R as de}from"./StopOutlined-FlFjzpVr.js";import{R as he}from"./CheckCircleOutlined-eJc7nheY.js";import"./api-W_2ufh2E.js";import"./UnstableContext-DKFbPjPy.js";import"./TextArea-Dl3y1VrD.js";import"./useBreakpoint--6XYT0_e.js";import"./index-Do9OUhYv.js";import"./extendsObject-78o_rR5W.js";import"./Skeleton-DdNqplha.js";import"./index-BoArUKpt.js";import"./index-Dd1FzYQF.js";import"./Input-UrGHJeeK.js";import"./index-BndKrrhJ.js";import"./LeftOutlined-DGEyRIvL.js";import"./EllipsisOutlined-Bv641ndy.js";import"./Overflow-Gz7ZFAqv.js";import"./PurePanel-DcW2x34y.js";import"./Pagination-6AhiOKxV.js";import"./ActionButton-DPGDuFxb.js";import"./fade-pCPugiYp.js";import"./PlusOutlined-oMbGAVrA.js";const me=({visible:h,user:o,onClose:j,onRefresh:V})=>{const[y,m]=r.useState(!1),[s,x]=r.useState(null),[I,f]=r.useState([]),[k,C]=r.useState([]),[D,S]=r.useState(1),[L,p]=r.useState(1),[E,A]=r.useState(0),[v,M]=r.useState(0);r.useEffect(()=>{h&&o.role==="BUSINESS"&&(w(),i(1),N(1))},[h,o]);const w=async()=>{try{const a=await J(o.id);x(a)}catch(a){console.error("获取工作统计失败:",a),d.error("获取工作统计失败")}},i=async a=>{m(!0);try{const n=await Q(o.id,{page:a,pageSize:10});f(n.data||[]),A(n.total||0),S(a)}catch(n){console.error("获取达人列表失败:",n),d.error("获取达人列表失败")}finally{m(!1)}},N=async a=>{m(!0);try{const n=await X(o.id,{page:a,pageSize:10});C(n.data||[]),M(n.total||0),p(a)}catch(n){console.error("获取合作列表失败:",n),d.error("获取合作列表失败")}finally{m(!1)}},U=a=>({PLATFORM_ADMIN:"平台管理员",BRAND:"品牌",BUSINESS:"商务"})[a]||a,z=a=>({PENDING:{label:"待确认",color:"default"},CONFIRMED:{label:"已确认",color:"blue"},SAMPLE_SENT:{label:"样品已发",color:"cyan"},CONTENT_CREATED:{label:"内容已创建",color:"purple"},PUBLISHED:{label:"已发布",color:"green"},COMPLETED:{label:"已完成",color:"success"},CANCELLED:{label:"已取消",color:"error"}})[a]||{label:a,color:"default"},B=[{title:"达人名称",dataIndex:"name",key:"name"},{title:"平台",dataIndex:"platform",key:"platform",render:a=>e.jsx(b,{children:a})},{title:"粉丝数",dataIndex:"followersCount",key:"followersCount",render:a=>(a==null?void 0:a.toLocaleString())||"-"},{title:"添加时间",dataIndex:"createdAt",key:"createdAt",render:a=>new Date(a).toLocaleDateString("zh-CN")}],P=[{title:"达人名称",dataIndex:"influencerName",key:"influencerName"},{title:"状态",dataIndex:"status",key:"status",render:a=>{const{label:n,color:q}=z(a);return e.jsx(b,{color:q,children:n})}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:a=>new Date(a).toLocaleDateString("zh-CN")},{title:"完成时间",dataIndex:"completedAt",key:"completedAt",render:a=>a?new Date(a).toLocaleDateString("zh-CN"):"-"}],F=e.jsxs(c,{bordered:!0,column:2,children:[e.jsx(c.Item,{label:"姓名",children:o.name}),e.jsx(c.Item,{label:"邮箱",children:o.email}),e.jsx(c.Item,{label:"角色",children:U(o.role)}),e.jsx(c.Item,{label:"所属品牌",children:o.brandName||"-"}),e.jsx(c.Item,{label:"账号状态",children:e.jsx(b,{color:o.isActive?"success":"error",children:o.isActive?"启用":"禁用"})}),e.jsx(c.Item,{label:"注册时间",children:new Date(o.createdAt).toLocaleString("zh-CN")}),e.jsx(c.Item,{label:"最后登录",children:o.lastLoginAt?new Date(o.lastLoginAt).toLocaleString("zh-CN"):"从未登录"})]}),t=o.role==="BUSINESS"?e.jsx("div",{children:e.jsx(te,{style:{marginBottom:16},children:e.jsxs(ae,{gutter:16,children:[e.jsx(R,{span:6,children:e.jsx(T,{title:"添加达人数",value:(s==null?void 0:s.influencersAdded)||0,prefix:e.jsx(oe,{}),suffix:"个"})}),e.jsx(R,{span:6,children:e.jsx(T,{title:"创建合作数",value:(s==null?void 0:s.collaborationsCreated)||0,prefix:e.jsx(le,{}),suffix:"个"})}),e.jsx(R,{span:6,children:e.jsx(T,{title:"完成合作数",value:(s==null?void 0:s.collaborationsCompleted)||0,prefix:e.jsx(re,{}),suffix:"个"})}),e.jsx(R,{span:6,children:e.jsx(T,{title:"成功率",value:(s==null?void 0:s.successRate)||0,suffix:"%",precision:1})})]})})}):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:"该角色无工作数据统计"}),l=o.role==="BUSINESS"?e.jsx(_,{columns:B,dataSource:I,rowKey:"id",loading:y,pagination:{current:D,pageSize:10,total:E,showTotal:a=>`共 ${a} 个达人`,onChange:i}}):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:"该角色无达人数据"}),g=o.role==="BUSINESS"?e.jsx(_,{columns:P,dataSource:k,rowKey:"id",loading:y,pagination:{current:L,pageSize:10,total:v,showTotal:a=>`共 ${a} 个合作`,onChange:N}}):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:"该角色无合作数据"}),H=[{key:"basic",label:"基本信息",children:F},{key:"stats",label:"工作数据",children:t},{key:"influencers",label:"达人列表",children:l},{key:"collaborations",label:"合作列表",children:g}];return e.jsx(W,{title:`用户详情 - ${o.name}`,open:h,onCancel:j,width:900,footer:null,children:e.jsx(se,{items:H})})},{Search:pe}=ne,{Option:u}=K,et=()=>{const{theme:h}=G(),[o,j]=r.useState(!1),[V,y]=r.useState([]),[m,s]=r.useState(0),[x,I]=r.useState(1),[f,k]=r.useState(10),[C,D]=r.useState(""),[S,L]=r.useState(""),[p,E]=r.useState(""),[A,v]=r.useState(null),[M,w]=r.useState(!1),i=async()=>{j(!0);try{const t=await Y({page:x,pageSize:f,search:C,role:S||void 0,isActive:p?p==="active":void 0});y(t.users),s(t.total)}catch(t){console.error("获取用户列表失败:",t),d.error("获取用户列表失败")}finally{j(!1)}};r.useEffect(()=>{i()},[x,f,S,p]);const N=()=>{I(1),i()},U=t=>{v(t),w(!0)},z=async(t,l)=>{try{await Z(t,!l),d.success(l?"用户已禁用":"用户已启用"),i()}catch(g){console.error("切换用户状态失败:",g),d.error("操作失败")}},B=t=>{W.confirm({title:"确认删除",content:`确定要删除用户「${t.name}」吗？此操作不可恢复。`,okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await ee(t.id),d.success("删除成功"),i()}catch(l){d.error(l.message||"删除失败")}}})},P=t=>({PLATFORM_ADMIN:{label:"平台管理员",color:"purple"},BRAND:{label:"品牌",color:"blue"},BUSINESS:{label:"商务",color:"green"},INFLUENCER:{label:"达人",color:"cyan"}})[t]||{label:t,color:"default"},F=[{title:"姓名",dataIndex:"name",key:"name",width:100},{title:"邮箱",dataIndex:"email",key:"email",width:180,render:t=>t!=null&&t.includes("@phone.local")?"-":t},{title:"手机号",dataIndex:"phone",key:"phone",width:130,render:t=>t||"-"},{title:"角色",dataIndex:"role",key:"role",width:120,render:t=>{const{label:l,color:g}=P(t);return e.jsx(b,{color:g,children:l})}},{title:"所属品牌",dataIndex:"factoryName",key:"factoryName",width:150,render:t=>t||"-"},{title:"状态",dataIndex:"isActive",key:"isActive",width:100,render:t=>e.jsx(b,{color:t?"success":"error",children:t?"启用":"禁用"})},{title:"注册时间",dataIndex:"createdAt",key:"createdAt",width:180,render:t=>new Date(t).toLocaleString("zh-CN")},{title:"最后登录",dataIndex:"lastLoginAt",key:"lastLoginAt",width:180,render:t=>t?new Date(t).toLocaleString("zh-CN"):"从未登录"},{title:"操作",key:"actions",width:200,fixed:"right",render:(t,l)=>e.jsxs($,{children:[e.jsx(O,{type:"link",size:"small",icon:e.jsx(ie,{}),onClick:()=>U(l),children:"详情"}),e.jsx(O,{type:"link",size:"small",danger:l.isActive,icon:l.isActive?e.jsx(de,{}):e.jsx(he,{}),onClick:()=>z(l.id,l.isActive),children:l.isActive?"禁用":"启用"}),l.role!=="PLATFORM_ADMIN"&&e.jsx(O,{type:"link",size:"small",danger:!0,onClick:()=>B(l),children:"删除"})]})}];return e.jsx("div",{style:{minHeight:"100vh",background:`linear-gradient(135deg, ${h.colors.background.secondary} 0%, ${h.colors.background.tertiary} 100%)`,position:"relative",padding:"24px",margin:"-24px"},children:e.jsxs("div",{style:{position:"relative",zIndex:1},children:[e.jsxs($,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs($,{wrap:!0,children:[e.jsx(pe,{placeholder:"搜索姓名或邮箱",allowClear:!0,style:{width:250},value:C,onChange:t=>D(t.target.value),onSearch:N,enterButton:e.jsx(ce,{})}),e.jsxs(K,{placeholder:"角色筛选",allowClear:!0,style:{width:150},value:S||void 0,onChange:L,children:[e.jsx(u,{value:"PLATFORM_ADMIN",children:"平台管理员"}),e.jsx(u,{value:"BRAND",children:"品牌"}),e.jsx(u,{value:"BUSINESS",children:"商务"}),e.jsx(u,{value:"INFLUENCER",children:"达人"})]}),e.jsxs(K,{placeholder:"状态筛选",allowClear:!0,style:{width:120},value:p||void 0,onChange:E,children:[e.jsx(u,{value:"active",children:"启用"}),e.jsx(u,{value:"inactive",children:"禁用"})]})]}),e.jsx(_,{columns:F,dataSource:V,rowKey:"id",loading:o,scroll:{x:1200},pagination:{current:x,pageSize:f,total:m,showSizeChanger:!0,showTotal:t=>`共 ${t} 个用户`,onChange:(t,l)=>{I(t),k(l)}}})]}),A&&e.jsx(me,{visible:M,user:A,onClose:()=>{w(!1),v(null)},onRefresh:i})]})})};export{et as default};
