# 快速测试智能建议功能

## 方法 1: 添加测试数据（最快）

在 `CreateCollaborationModal.tsx` 中，找到 `handleInfluencerChange` 函数，临时添加测试数据：

```typescript
// 达人选择变化时加载建议
const handleInfluencerChange = (influencerId: string) => {
  console.log('handleInfluencerChange: 达人选择变化:', influencerId);
  setSelectedInfluencer(influencerId);
  
  // 🔥 临时添加测试建议
  setSuggestions([
    {
      field: 'sampleId',
      value: 'test-sample-1',
      label: '测试样品A（历史最佳）',
      reason: '该达人使用此样品平均GMV为 ¥5000，效果最好',
      confidence: 'high' as const,
    },
    {
      field: 'quotedPrice',
      value: 1500,
      label: '¥1500（历史平均）',
      reason: '该达人历史平均报价为 ¥1500',
      confidence: 'high' as const,
    },
    {
      field: 'scheduledDate',
      value: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
      label: '一周后 20:00（黄金时段）',
      reason: '黄金时段，用户活跃度最高',
      confidence: 'medium' as const,
    },
  ]);
  
  loadSuggestions(influencerId);
};
```

**保存文件后**:
1. 刷新浏览器（Ctrl+F5）
2. 打开"新建合作"弹窗
3. 选择任意达人
4. 应该立即看到 3 条测试建议

**如果看到了测试建议**:
- ✅ UI 渲染正常
- ❌ 问题在于 API 调用
- 继续方法 2

**如果还是看不到**:
- ❌ UI 渲染有问题
- 检查浏览器控制台是否有错误
- 检查 React 组件是否正确渲染

---

## 方法 2: 检查 API 调用

在浏览器控制台运行：

```javascript
// 复制粘贴到浏览器控制台

// 1. 获取 token
const token = localStorage.getItem('token');
console.log('Token:', token ? '✅ 存在' : '❌ 不存在');

// 2. 测试 API（替换 INFLUENCER_ID）
const INFLUENCER_ID = 'YOUR_INFLUENCER_ID_HERE';

fetch(`http://localhost:3000/api/collaborations/suggestions?influencerId=${INFLUENCER_ID}&type=sample`, {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  }
})
.then(res => {
  console.log('状态码:', res.status);
  return res.json();
})
.then(data => {
  console.log('响应数据:', data);
  if (data.success) {
    console.log('✅ API 正常');
    console.log('建议数量:', data.data.suggestions.length);
  } else {
    console.log('❌ API 返回错误:', data.error);
  }
})
.catch(err => {
  console.log('❌ 请求失败:', err);
});
```

**获取 INFLUENCER_ID**:
```javascript
// 在控制台运行
fetch('http://localhost:3000/api/influencers?page=1&pageSize=1', {
  headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
})
.then(res => res.json())
.then(data => {
  if (data.data && data.data.length > 0) {
    console.log('达人 ID:', data.data[0].id);
    console.log('达人昵称:', data.data[0].nickname);
  }
});
```

---

## 方法 3: 检查后端日志

1. 打开后端控制台（运行 `npm run dev` 的终端）
2. 选择一个达人
3. 查看是否有以下日志：
   - API 请求日志
   - 错误信息
   - 数据库查询

**如果没有任何日志**:
- 请求可能没有到达后端
- 检查前端 API 地址是否正确
- 检查后端服务是否运行

**如果有错误日志**:
- 复制错误信息
- 根据错误类型修复

---

## 方法 4: 简化测试（最小化）

创建一个最简单的测试：

### 4.1 修改 `renderSuggestions` 函数

```typescript
// 渲染建议卡片
const renderSuggestions = () => {
  // 🔥 临时强制显示
  return (
    <Alert
      type="info"
      icon={<BulbOutlined />}
      message="智能建议（测试）"
      description={
        <div>
          <p>建议数量: {suggestions.length}</p>
          <p>加载中: {loadingSuggestions ? '是' : '否'}</p>
          <p>选中达人: {selectedInfluencer || '未选择'}</p>
        </div>
      }
      style={{ marginBottom: 16 }}
    />
  );
  
  // 原来的代码...
};
```

这样可以看到：
- 建议数量是否正确
- 是否在加载中
- 是否选中了达人

---

## 预期结果

### 正常情况

选择达人后应该看到：

```
┌─────────────────────────────────────────┐
│ 💡 智能建议                              │
├─────────────────────────────────────────┤
│ [强烈推荐] 测试样品A（历史最佳）         │
│ 该达人使用此样品平均GMV为 ¥5000...      │
│                        [应用] [忽略]     │
├─────────────────────────────────────────┤
│ [强烈推荐] ¥1500（历史平均）             │
│ 该达人历史平均报价为 ¥1500              │
│                        [应用] [忽略]     │
├─────────────────────────────────────────┤
│ [建议] 一周后 20:00（黄金时段）          │
│ 黄金时段，用户活跃度最高                │
│                        [应用] [忽略]     │
└─────────────────────────────────────────┘
```

### 无历史数据情况

```
┌─────────────────────────────────────────┐
│ 💡 智能建议                              │
├─────────────────────────────────────────┤
│ [可选] 最新样品（最新样品）              │
│ 这是最新上架的样品，可以尝试推广        │
│                        [应用] [忽略]     │
├─────────────────────────────────────────┤
│ [可选] ¥500（粉丝数估算）                │
│ 根据10000粉丝数估算的报价               │
│                        [应用] [忽略]     │
└─────────────────────────────────────────┘
```

---

## 常见错误和解决

### 错误 1: "Cannot read property 'suggestions' of undefined"

**原因**: API 响应格式不正确

**解决**: 检查后端返回的数据结构

### 错误 2: "Network Error"

**原因**: 后端服务未运行或地址错误

**解决**: 
1. 确认后端运行在 `http://localhost:3000`
2. 检查 CORS 配置

### 错误 3: 建议数量为 0

**原因**: 
- 没有历史数据
- API 返回空数组

**解决**: 
- 这是正常的，应该显示低置信度建议
- 检查后端逻辑是否返回了默认建议

---

## 下一步

如果以上方法都无法解决，请告诉我：

1. 使用方法 1 后是否看到测试建议？
2. 浏览器控制台有什么错误？
3. Network 标签中 API 请求的状态码？
4. 后端控制台有什么日志？

我会根据具体情况进一步协助调试。
