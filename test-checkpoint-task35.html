<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkpoint Task 35 - å·¥ä½œå°éªŒè¯</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .header p {
      opacity: 0.9;
      font-size: 14px;
    }
    
    .content {
      padding: 30px;
    }
    
    .test-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .test-section h2 {
      color: #333;
      font-size: 20px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .test-section h2 .icon {
      font-size: 24px;
    }
    
    .test-list {
      list-style: none;
      margin-top: 15px;
    }
    
    .test-list li {
      padding: 12px 15px;
      background: white;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-left: 4px solid #e0e0e0;
    }
    
    .test-list li.passed {
      border-left-color: #52c41a;
    }
    
    .test-list li.failed {
      border-left-color: #ff4d4f;
    }
    
    .test-list li.warning {
      border-left-color: #faad14;
    }
    
    .status-icon {
      font-size: 20px;
      min-width: 24px;
    }
    
    .test-details {
      flex: 1;
    }
    
    .test-name {
      font-weight: 500;
      color: #333;
      margin-bottom: 4px;
    }
    
    .test-info {
      font-size: 13px;
      color: #666;
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .btn {
      flex: 1;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }
    
    .btn-secondary:hover {
      background: #e0e0e0;
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .summary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px;
      padding: 25px;
      margin-top: 30px;
    }
    
    .summary h2 {
      font-size: 22px;
      margin-bottom: 20px;
    }
    
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .summary-item {
      background: rgba(255, 255, 255, 0.2);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    
    .summary-value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .summary-label {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .instructions {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
    }
    
    .instructions h3 {
      color: #856404;
      margin-bottom: 10px;
      font-size: 16px;
    }
    
    .instructions ol {
      margin-left: 20px;
      color: #856404;
    }
    
    .instructions li {
      margin-bottom: 8px;
      line-height: 1.6;
    }
    
    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .alert-success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    
    .alert-error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    
    .alert-warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ Checkpoint Task 35 - å·¥ä½œå°éªŒè¯</h1>
      <p>æµ‹è¯•ä»Šæ—¥æ¸…å•ã€å·¥ä½œç»Ÿè®¡ã€å¿«æ·å…¥å£åŠŸèƒ½</p>
    </div>
    
    <div class="content">
      <div class="instructions">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <ol>
          <li>ç¡®ä¿å·²ç™»å½•ç³»ç»Ÿï¼ˆå•†åŠ¡äººå‘˜æˆ–å·¥å‚è€æ¿è´¦å·ï¼‰</li>
          <li>ç‚¹å‡»"å¼€å§‹æµ‹è¯•"æŒ‰é’®æ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•</li>
          <li>æµ‹è¯•å°†éªŒè¯ä»Šæ—¥æ¸…å•ã€å·¥ä½œç»Ÿè®¡ã€å¿«æ·å…¥å£ä¸‰å¤§åŠŸèƒ½</li>
          <li>æŸ¥çœ‹æµ‹è¯•ç»“æœï¼Œç¡®è®¤æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
          <li>å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</li>
        </ol>
      </div>
      
      <div class="button-group">
        <button class="btn btn-primary" onclick="runTests()" id="runBtn">
          <span>ğŸš€</span>
          <span>å¼€å§‹æµ‹è¯•</span>
        </button>
        <button class="btn btn-secondary" onclick="clearResults()" id="clearBtn">
          <span>ğŸ”„</span>
          <span>æ¸…é™¤ç»“æœ</span>
        </button>
      </div>
      
      <div id="results"></div>
    </div>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:3000/api';
    let testResults = {
      passed: [],
      failed: [],
      warnings: []
    };

    function showLoading() {
      document.getElementById('results').innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <p>æ­£åœ¨æ‰§è¡Œæµ‹è¯•ï¼Œè¯·ç¨å€™...</p>
        </div>
      `;
    }

    function logTest(name, passed, details = '') {
      const result = { name, details, timestamp: new Date().toISOString() };
      if (passed) {
        testResults.passed.push(result);
      } else {
        testResults.failed.push(result);
      }
    }

    function logWarning(message) {
      testResults.warnings.push({ message, timestamp: new Date().toISOString() });
    }

    async function getAuthToken() {
      const token = localStorage.getItem('token');
      if (!token) {
        throw new Error('æœªæ‰¾åˆ°è®¤è¯ Tokenï¼Œè¯·å…ˆç™»å½•');
      }
      return token;
    }

    async function apiRequest(endpoint, options = {}) {
      const token = await getAuthToken();
      const response = await fetch(`${API_BASE_URL}${endpoint}`, {
        ...options,
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`,
          ...options.headers
        }
      });
      
      if (!response.ok) {
        const error = await response.text();
        throw new Error(`API è¯·æ±‚å¤±è´¥ (${response.status}): ${error}`);
      }
      
      return response.json();
    }

    async function testTodayTodoList() {
      try {
        const response = await apiRequest('/reports/my-dashboard/today-todos');
        logTest('ä»Šæ—¥æ¸…å• API å“åº”', response.success);
        
        if (response.data) {
          const hasValidStructure = 
            Array.isArray(response.data.todos) &&
            response.data.summary &&
            typeof response.data.summary.total === 'number';
          
          logTest('ä»Šæ—¥æ¸…å•æ•°æ®ç»“æ„', hasValidStructure, 
            `å¾…åŠæ€»æ•°: ${response.data.summary.total}, å·²å®Œæˆ: ${response.data.summary.completed}`);
          
          if (response.data.todos.length > 0) {
            const firstTodo = response.data.todos[0];
            const hasValidTodo = firstTodo.id && firstTodo.type && firstTodo.title;
            logTest('å¾…åŠäº‹é¡¹æ•°æ®å®Œæ•´', hasValidTodo);
          } else {
            logWarning('å½“å‰æ²¡æœ‰å¾…åŠäº‹é¡¹');
          }
        }
      } catch (error) {
        logTest('ä»Šæ—¥æ¸…å•åŠŸèƒ½', false, error.message);
      }
    }

    async function testWorkStats() {
      const periods = ['today', 'week', 'month'];
      
      for (const period of periods) {
        try {
          const response = await apiRequest(`/reports/my-dashboard/work-stats?period=${period}`);
          logTest(`å·¥ä½œç»Ÿè®¡ (${period})`, response.success);
          
          if (response.data && response.data.stats) {
            const stats = response.data.stats;
            const hasValidStats = 
              typeof stats.leadsAdded === 'number' &&
              typeof stats.gmv === 'number' &&
              typeof stats.goalProgress === 'number';
            
            logTest(`å·¥ä½œç»Ÿè®¡æ•°æ® (${period})`, hasValidStats,
              `å»ºè”: ${stats.leadsAdded}, GMV: ${stats.gmv}, ç›®æ ‡: ${stats.goalProgress}%`);
          }
        } catch (error) {
          logTest(`å·¥ä½œç»Ÿè®¡ (${period})`, false, error.message);
        }
      }
    }

    async function testQuickActions() {
      try {
        const influencersResponse = await apiRequest('/influencers?page=1&pageSize=1');
        logTest('å¿«é€Ÿæ·»åŠ è¾¾äºº API', influencersResponse.success);
        
        const collaborationsResponse = await apiRequest('/collaborations?page=1&pageSize=1');
        logTest('å¿«é€Ÿåˆ›å»ºåˆä½œ API', collaborationsResponse.success);
        
        const samplesResponse = await apiRequest('/samples?page=1&pageSize=1');
        logTest('å¿«é€Ÿå¯„æ · API', samplesResponse.success);
      } catch (error) {
        logTest('å¿«æ·å…¥å£åŠŸèƒ½', false, error.message);
      }
    }

    async function runTests() {
      const runBtn = document.getElementById('runBtn');
      const clearBtn = document.getElementById('clearBtn');
      
      runBtn.disabled = true;
      clearBtn.disabled = true;
      
      testResults = { passed: [], failed: [], warnings: [] };
      showLoading();
      
      try {
        await getAuthToken();
        
        await testTodayTodoList();
        await testWorkStats();
        await testQuickActions();
        
        displayResults();
      } catch (error) {
        document.getElementById('results').innerHTML = `
          <div class="alert alert-error">
            <strong>âŒ æµ‹è¯•å¤±è´¥</strong><br>
            ${error.message}
          </div>
        `;
      } finally {
        runBtn.disabled = false;
        clearBtn.disabled = false;
      }
    }

    function displayResults() {
      const passRate = testResults.passed.length / 
        (testResults.passed.length + testResults.failed.length) * 100;
      
      let html = '';
      
      // Summary
      html += `
        <div class="summary">
          <h2>ğŸ“Š æµ‹è¯•æ€»ç»“</h2>
          <div class="summary-grid">
            <div class="summary-item">
              <div class="summary-value">${testResults.passed.length}</div>
              <div class="summary-label">âœ… é€šè¿‡</div>
            </div>
            <div class="summary-item">
              <div class="summary-value">${testResults.failed.length}</div>
              <div class="summary-label">âŒ å¤±è´¥</div>
            </div>
            <div class="summary-item">
              <div class="summary-value">${testResults.warnings.length}</div>
              <div class="summary-label">âš ï¸ è­¦å‘Š</div>
            </div>
            <div class="summary-item">
              <div class="summary-value">${passRate.toFixed(0)}%</div>
              <div class="summary-label">ğŸ“ˆ é€šè¿‡ç‡</div>
            </div>
          </div>
        </div>
      `;
      
      // Passed tests
      if (testResults.passed.length > 0) {
        html += `
          <div class="test-section">
            <h2><span class="icon">âœ…</span> é€šè¿‡çš„æµ‹è¯• (${testResults.passed.length})</h2>
            <ul class="test-list">
        `;
        testResults.passed.forEach(test => {
          html += `
            <li class="passed">
              <span class="status-icon">âœ…</span>
              <div class="test-details">
                <div class="test-name">${test.name}</div>
                ${test.details ? `<div class="test-info">${test.details}</div>` : ''}
              </div>
            </li>
          `;
        });
        html += `</ul></div>`;
      }
      
      // Failed tests
      if (testResults.failed.length > 0) {
        html += `
          <div class="test-section">
            <h2><span class="icon">âŒ</span> å¤±è´¥çš„æµ‹è¯• (${testResults.failed.length})</h2>
            <ul class="test-list">
        `;
        testResults.failed.forEach(test => {
          html += `
            <li class="failed">
              <span class="status-icon">âŒ</span>
              <div class="test-details">
                <div class="test-name">${test.name}</div>
                ${test.details ? `<div class="test-info">${test.details}</div>` : ''}
              </div>
            </li>
          `;
        });
        html += `</ul></div>`;
      }
      
      // Warnings
      if (testResults.warnings.length > 0) {
        html += `
          <div class="test-section">
            <h2><span class="icon">âš ï¸</span> è­¦å‘Šä¿¡æ¯ (${testResults.warnings.length})</h2>
            <ul class="test-list">
        `;
        testResults.warnings.forEach(warning => {
          html += `
            <li class="warning">
              <span class="status-icon">âš ï¸</span>
              <div class="test-details">
                <div class="test-name">${warning.message}</div>
              </div>
            </li>
          `;
        });
        html += `</ul></div>`;
      }
      
      // Overall status
      if (testResults.failed.length === 0) {
        html = `<div class="alert alert-success">
          <strong>ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼</strong><br>
          å·¥ä½œå°åŠŸèƒ½éªŒè¯å®Œæˆï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼
        </div>` + html;
      } else if (passRate >= 80) {
        html = `<div class="alert alert-warning">
          <strong>âœ… å¤§éƒ¨åˆ†æµ‹è¯•é€šè¿‡</strong><br>
          å·¥ä½œå°åŠŸèƒ½åŸºæœ¬å¯ç”¨ï¼Œä½†å­˜åœ¨ ${testResults.failed.length} ä¸ªé—®é¢˜éœ€è¦å…³æ³¨ã€‚
        </div>` + html;
      } else {
        html = `<div class="alert alert-error">
          <strong>âš ï¸ å­˜åœ¨è¾ƒå¤šé—®é¢˜</strong><br>
          å»ºè®®ä¿®å¤å¤±è´¥çš„æµ‹è¯•åé‡æ–°éªŒè¯ã€‚
        </div>` + html;
      }
      
      document.getElementById('results').innerHTML = html;
    }

    function clearResults() {
      document.getElementById('results').innerHTML = '';
      testResults = { passed: [], failed: [], warnings: [] };
    }
  </script>
</body>
</html>
