# 🔄 切换账号使用指南

## 📋 问题说明

当你切换前端登录账号后，Chrome 插件还在使用旧账号的 token，导致采集的数据添加到错误的账号下。

**根本原因**：Chrome 插件的 content script 运行在抖音页面上，无法访问前端页面（localhost:5173）的 localStorage，所以无法自动获取当前登录用户的 token。

## ✅ 唯一可靠的解决方案：手动更新 Token

由于技术限制（跨域隔离），自动同步方案不可行。但我们优化了手动更新流程，只需 **4秒钟**！

### 🚀 快速操作步骤（4秒完成）

#### 步骤1：复制当前用户的 Token（1秒）

1. 打开前端页面（http://localhost:5173）
2. 用你想使用的账号登录（例如：测试002）
3. 按 **F12** 打开控制台
4. 复制粘贴以下代码并按回车：

```javascript
// 复制这段代码到控制台
(function(){try{const a=localStorage.getItem('auth-storage');if(!a){console.error('❌ 未登录');return}const d=JSON.parse(a);const t=d.state.token.accessToken;const u=d.state.user;navigator.clipboard.writeText(t);console.log('✅ Token已复制！\n当前用户:',u.name,'\n请粘贴到插件设置中')}catch(e){console.error('❌ 失败:',e)}})();
```

或者使用完整版脚本：`chrome-extension/一键复制Token.js`

**结果**：Token 自动复制到剪贴板，控制台显示当前用户信息 ✅

#### 步骤2：更新插件 Token（3秒）

1. 点击 Chrome 插件图标（工具栏）
2. 点击"设置"按钮（齿轮图标⚙️）
3. 在"登录令牌"输入框中 **粘贴**（Ctrl+V）
4. 点击"保存"按钮
5. 看到"配置已保存"提示 ✅

#### 步骤3：开始采集（立即生效）

1. 打开达人详情页
2. 点击"添加到 Zilo"按钮
3. 数据会添加到**当前配置的账号**下 ✅

### ✨ 优点

- ✅ **100% 可靠** - 不受跨域限制
- ✅ **超级快速** - 只需4秒
- ✅ **立即生效** - 无需重启
- ✅ **清晰明确** - 知道使用的是哪个账号

---

## 🔍 辅助工具

### 一键复制 Token 脚本

**文件**：`chrome-extension/一键复制Token.js`

**使用场景**：在前端页面（localhost:5173）快速复制当前用户的 Token

**功能**：
- ✅ 显示当前登录用户信息（姓名、邮箱、角色）
- ✅ 自动复制 Token 到剪贴板
- ✅ 显示下一步操作提示

**使用方法**：
1. 在前端页面按 F12 打开控制台
2. 复制粘贴脚本内容
3. 按回车运行
4. Token 自动复制，按提示操作即可

---

## 📊 完整测试流程

### 测试账号切换（验证数据隔离）

#### 准备工作
- ✅ 前端和后端都在运行
- ✅ Chrome 插件已安装
- ✅ 打开两个浏览器窗口（或使用无痕模式）

#### 测试步骤

**1. 测试张老板账号**

```
登录信息：
邮箱: owner@demo.com
密码: owner123
```

操作：
1. 在窗口1登录张老板账号
2. 按 F12，运行一键复制脚本
3. 更新插件 Token
4. 打开达人详情页，采集一个达人（例如：达人A）
5. 回到前端，查看达人列表 → 应该看到达人A ✅

**2. 测试测试002账号**

```
登录信息：
邮箱: staff@demo.com
密码: staff123
```

操作：
1. 在窗口2登录测试002账号（staff@demo.com）
2. 按 F12，运行一键复制脚本
3. 更新插件 Token
4. 打开达人详情页，采集另一个达人（例如：达人B）
5. 回到前端，查看达人列表 → 应该看到达人B ✅

**3. 验证数据隔离**

1. 在窗口1（张老板）查看达人列表 → 只有达人A，没有达人B ✅
2. 在窗口2（测试002）查看达人列表 → 只有达人B，没有达人A ✅

**结果**：数据完全隔离，每个账号只能看到自己采集的达人 🎉

---

## 💡 常见问题

### Q1: 为什么自动同步不工作？

**A**: 可能的原因：
1. 插件没有重新加载 → 重新加载插件
2. localStorage 有跨域限制 → 使用方法1手动更新
3. 前端未登录 → 先登录前端

### Q2: 如何确认使用的是哪个账号的 Token？

**A**: 查看控制台输出：
```
[Zilo Background] 使用 token: 页面 token（当前登录用户）
```
或
```
[Zilo Background] 使用 token: 插件配置 token
```

### Q3: 数据还是添加到错误的账号怎么办？

**A**: 
1. 运行 `获取当前token.js` 确认当前登录用户
2. 手动更新插件 Token（方法1）
3. 重新采集测试

---

## 🎯 推荐方案

**目前最可靠的方案是方法1（手动更新 Token）**

虽然需要手动操作，但是：
- ✅ 100% 可靠
- ✅ 不会出错
- ✅ 立即生效

每次切换账号只需要：
1. 运行脚本获取 Token（自动复制）
2. 粘贴到插件设置
3. 保存

总共不到10秒钟！

---

**更新时间**: 2026年1月6日
**状态**: ✅ 已测试
**推荐方案**: 方法1（手动更新 Token）
