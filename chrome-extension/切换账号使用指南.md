# 🔄 切换账号使用指南

## 📋 问题说明

当你切换前端登录账号后，Chrome 插件还在使用旧账号的 token，导致采集的数据添加到错误的账号下。

## ✅ 解决方案（2种方法）

### 方法1：手动更新插件 Token（推荐）⭐⭐⭐⭐⭐

这是最可靠的方法，每次切换账号后手动更新插件的 token。

#### 步骤：

1. **在前端页面获取 Token**
   - 打开前端页面（http://localhost:5173）
   - 用测试002账号登录
   - 按 F12 打开控制台
   - 复制粘贴 `chrome-extension/获取当前token.js` 的内容
   - 按回车运行
   - Token 会自动复制到剪贴板 ✅

2. **更新插件 Token**
   - 点击 Chrome 插件图标
   - 点击"设置"按钮（齿轮图标）
   - 在"登录令牌"输入框中粘贴 Token（Ctrl+V）
   - 点击"保存"按钮
   - 看到"配置已保存"提示 ✅

3. **开始采集**
   - 打开达人详情页
   - 点击"添加到 Zilo"按钮
   - 数据会添加到测试002账号下 ✅

#### 优点：
- ✅ 100% 可靠
- ✅ 不需要修改代码
- ✅ 立即生效

#### 缺点：
- ⚠️ 每次切换账号需要手动更新

---

### 方法2：自动同步 Token（需要重新加载插件）

这个方法已经实现，但需要确保插件正确加载了新代码。

#### 步骤：

1. **重新加载插件**
   - 打开 Chrome 扩展管理页面（chrome://extensions/）
   - 找到 Zilo 插件
   - 点击刷新按钮 🔄
   - 确保插件已重新加载 ✅

2. **测试自动同步**
   - 用测试002账号登录前端
   - 打开达人详情页
   - 按 F12 打开控制台
   - 点击"添加到 Zilo"按钮
   - 查看控制台输出：
     ```
     [Zilo Background] 使用 token: 页面 token（当前登录用户）
     ```
   - 如果看到这个，说明自动同步成功 ✅

3. **如果还是不行**
   - 运行调试脚本 `chrome-extension/调试token获取.js`
   - 查看是否能正确读取 localStorage
   - 如果不能，说明有跨域问题，请使用方法1

#### 优点：
- ✅ 自动跟随前端登录状态
- ✅ 无需手动配置

#### 缺点：
- ⚠️ 可能有跨域问题
- ⚠️ 需要确保插件正确加载

---

## 🔍 调试工具

### 1. 获取当前 Token
文件：`chrome-extension/获取当前token.js`

在前端页面（localhost:5173）控制台运行，会：
- 显示当前登录用户信息
- 显示 Token
- 自动复制 Token 到剪贴板

### 2. 调试 Token 获取
文件：`chrome-extension/调试token获取.js`

在达人详情页控制台运行，会：
- 检查 localStorage 是否有 auth-storage
- 测试 getTokenFromPage 函数
- 显示当前域名信息
- 列出所有 localStorage keys

---

## 📊 完整测试流程

### 测试切换账号

1. **准备工作**
   - 确保前端和后端都在运行
   - 确保插件已安装并重新加载

2. **测试张老板账号**
   - 用张老板账号登录前端
   - 运行 `获取当前token.js` 获取 Token
   - 更新插件 Token
   - 采集一个达人
   - 查看张老板账号的达人列表 → 应该有新数据 ✅

3. **测试测试002账号**
   - 退出张老板，登录测试002
   - 运行 `获取当前token.js` 获取 Token
   - 更新插件 Token
   - 采集另一个达人
   - 查看测试002账号的达人列表 → 应该有新数据 ✅
   - 查看张老板账号的达人列表 → 不应该有新数据 ✅

---

## 💡 常见问题

### Q1: 为什么自动同步不工作？

**A**: 可能的原因：
1. 插件没有重新加载 → 重新加载插件
2. localStorage 有跨域限制 → 使用方法1手动更新
3. 前端未登录 → 先登录前端

### Q2: 如何确认使用的是哪个账号的 Token？

**A**: 查看控制台输出：
```
[Zilo Background] 使用 token: 页面 token（当前登录用户）
```
或
```
[Zilo Background] 使用 token: 插件配置 token
```

### Q3: 数据还是添加到错误的账号怎么办？

**A**: 
1. 运行 `获取当前token.js` 确认当前登录用户
2. 手动更新插件 Token（方法1）
3. 重新采集测试

---

## 🎯 推荐方案

**目前最可靠的方案是方法1（手动更新 Token）**

虽然需要手动操作，但是：
- ✅ 100% 可靠
- ✅ 不会出错
- ✅ 立即生效

每次切换账号只需要：
1. 运行脚本获取 Token（自动复制）
2. 粘贴到插件设置
3. 保存

总共不到10秒钟！

---

**更新时间**: 2026年1月6日
**状态**: ✅ 已测试
**推荐方案**: 方法1（手动更新 Token）
