# 🚀 直接测试方案 - 无需配置 Popup

## 问题说明

如果你点击插件图标后没有看到配置界面，可以使用这个方案直接测试采集功能。

---

## 方法 1：使用浏览器控制台直接配置（推荐）

### 步骤 1：获取 Token

1. 打开 http://localhost:5173
2. 登录（`owner/owner123`）
3. 按 `F12` → `Application` → `Local Storage` → `http://localhost:5173`
4. 复制 `token` 的值

### 步骤 2：在扩展管理页面配置

1. 打开 `chrome://extensions/`
2. 找到"Zilo 达人采集助手"
3. 点击"详细信息"
4. 点击"检查视图：Service Worker"（这会打开 background script 的控制台）
5. 在控制台中执行以下代码（替换 YOUR_TOKEN）：

```javascript
chrome.storage.sync.set({
  apiUrl: 'http://localhost:3000/api',
  token: 'YOUR_TOKEN_HERE'  // 替换成你的 token
}, () => {
  console.log('配置已保存！');
});
```

### 步骤 3：验证配置

在同一个控制台中执行：

```javascript
chrome.storage.sync.get(['apiUrl', 'token'], (result) => {
  console.log('当前配置:', result);
});
```

应该看到你刚才保存的配置。

### 步骤 4：测试采集

1. 在 Chrome 中打开 `chrome-extension/test-page.html`
2. 应该看到"添加到 Zilo"按钮
3. 按 `F12` 打开控制台
4. 点击"添加到 Zilo"按钮
5. 查看控制台日志和页面通知

---

## 方法 2：修改代码，硬编码 Token（临时测试）

如果上面的方法还是不行，可以临时修改代码：

### 修改 background.js

在 `chrome-extension/background.js` 文件的开头添加：

```javascript
// 临时测试配置 - 替换成你的 token
const TEST_CONFIG = {
  apiUrl: 'http://localhost:3000/api',
  token: 'YOUR_TOKEN_HERE'  // 替换成你的 token
};
```

然后修改 `getConfig` 函数：

```javascript
// 获取配置
async function getConfig() {
  // 临时：直接返回测试配置
  return TEST_CONFIG;
  
  // 原来的代码（注释掉）
  // return new Promise((resolve) => {
  //   chrome.storage.sync.get(['apiUrl', 'token'], (result) => {
  //     resolve({
  //       apiUrl: result.apiUrl || 'http://localhost:3000/api',
  //       token: result.token || '',
  //     });
  //   });
  // });
}
```

保存后：
1. 在 `chrome://extensions/` 重新加载插件
2. 打开 `test-page.html` 测试

---

## 方法 3：检查 Popup 问题

### 3.1 检查 popup.html 是否能打开

1. 打开 `chrome://extensions/`
2. 找到"Zilo 达人采集助手"
3. 记下插件 ID（类似 `abcdefghijklmnopqrstuvwxyz`）
4. 在新标签页打开：`chrome-extension://插件ID/popup.html`

如果能看到配置界面，说明 popup.html 是正常的。

### 3.2 检查点击图标的行为

点击插件图标后，应该出现一个小弹窗（不是新标签页）。

如果没有出现弹窗：
- 检查是否有其他扩展冲突
- 尝试重启 Chrome
- 检查 manifest.json 中的 `action.default_popup` 配置

---

## 快速测试命令（复制粘贴）

### 在 Background Script 控制台执行：

```javascript
// 1. 保存配置（替换 YOUR_TOKEN）
chrome.storage.sync.set({
  apiUrl: 'http://localhost:3000/api',
  token: 'YOUR_TOKEN_HERE'
}, () => console.log('✅ 配置已保存'));

// 2. 验证配置
chrome.storage.sync.get(['apiUrl', 'token'], (result) => {
  console.log('📋 当前配置:', result);
});

// 3. 清除配置（如果需要重新配置）
// chrome.storage.sync.clear(() => console.log('🗑️ 配置已清除'));
```

---

## 预期结果

配置成功后：
1. ✅ 打开 `test-page.html` 能看到"添加到 Zilo"按钮
2. ✅ 点击按钮后显示"采集中..."
3. ✅ 1-2 秒后显示"✓ 已添加"
4. ✅ 页面右上角出现绿色通知
5. ✅ Zilo 系统中能看到新达人

---

## 调试技巧

### 查看 Background Script 日志

```
chrome://extensions/ 
→ 插件详情 
→ 检查视图：Service Worker
→ 查看 Console
```

### 查看 Content Script 日志

```
打开 test-page.html
→ 按 F12
→ Console 标签
→ 查找 [Zilo] 日志
```

### 查看网络请求

```
打开 test-page.html
→ 按 F12
→ Network 标签
→ 点击采集按钮
→ 查看 API 请求
```

---

**选择最简单的方法 1，直接在控制台配置！** 🎯
