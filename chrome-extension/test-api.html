<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zilo API æµ‹è¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 32px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      margin-bottom: 8px;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      border: 1px solid #d9d9d9;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    textarea {
      min-height: 120px;
      font-family: 'Courier New', monospace;
      resize: vertical;
    }

    .button {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: 500;
      color: #ffffff;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 12px;
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .button:active {
      transform: translateY(0);
    }

    .button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .result {
      margin-top: 24px;
      padding: 16px;
      background: #f5f7fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .result h3 {
      font-size: 16px;
      color: #333;
      margin-bottom: 12px;
    }

    .result pre {
      background: #ffffff;
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.6;
    }

    .success {
      border-left-color: #52c41a;
    }

    .error {
      border-left-color: #ff4d4f;
    }

    .help-text {
      font-size: 12px;
      color: #999;
      margin-top: 4px;
    }

    .example {
      background: #f0f2f5;
      padding: 12px;
      border-radius: 6px;
      margin-top: 8px;
      font-size: 13px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª Zilo API æµ‹è¯•å·¥å…·</h1>
    <p class="subtitle">æµ‹è¯• Chrome æ’ä»¶ä¸ Zilo åç«¯çš„è¿æ¥</p>

    <div class="form-group">
      <label>API åœ°å€</label>
      <input type="text" id="apiUrl" value="http://localhost:3000/api" placeholder="http://localhost:3000/api">
      <div class="help-text">Zilo åç«¯ API åœ°å€</div>
    </div>

    <div class="form-group">
      <label>ç™»å½•ä»¤ç‰Œ (Token)</label>
      <input type="password" id="token" placeholder="è¯·è¾“å…¥æ‚¨çš„ç™»å½•ä»¤ç‰Œ">
      <div class="help-text">
        åœ¨ Zilo ç³»ç»Ÿç™»å½•åï¼ŒæŒ‰ F12 > Application > Local Storage > token
      </div>
    </div>

    <div class="form-group">
      <label>æµ‹è¯•æ•°æ® (JSON)</label>
      <textarea id="testData">{
  "nickname": "æµ‹è¯•è¾¾äºº",
  "platform": "DOUYIN",
  "platformId": "test123456",
  "phone": "13800138000",
  "categories": ["ç”Ÿé²œ"],
  "tags": ["LV3"],
  "notes": "ç²‰ä¸æ•°: 125000\né€šè¿‡æµè§ˆå™¨æ’ä»¶é‡‡é›†"
}</textarea>
      <div class="help-text">ä¿®æ”¹æµ‹è¯•æ•°æ®ä»¥æµ‹è¯•ä¸åŒåœºæ™¯</div>
    </div>

    <button class="button" id="testBtn">ğŸš€ æµ‹è¯• API è¿æ¥</button>
    <button class="button" id="healthBtn" style="background: linear-gradient(135deg, #52c41a 0%, #73d13d 100%);">
      â¤ï¸ æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
    </button>

    <div id="result" style="display: none;"></div>

    <div class="example">
      <strong>ğŸ’¡ ä½¿ç”¨æç¤ºï¼š</strong><br>
      1. ç¡®ä¿ Zilo åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ (npm run dev)<br>
      2. åœ¨ Zilo ç³»ç»Ÿä¸­ç™»å½•å¹¶è·å– Token<br>
      3. å¡«å†™ Token åç‚¹å‡»"æµ‹è¯• API è¿æ¥"<br>
      4. æŸ¥çœ‹è¿”å›ç»“æœï¼Œç¡®è®¤è¿æ¥æ­£å¸¸
    </div>
  </div>

  <script>
    const apiUrlInput = document.getElementById('apiUrl');
    const tokenInput = document.getElementById('token');
    const testDataInput = document.getElementById('testData');
    const testBtn = document.getElementById('testBtn');
    const healthBtn = document.getElementById('healthBtn');
    const resultDiv = document.getElementById('result');

    // æ˜¾ç¤ºç»“æœ
    function showResult(title, data, isSuccess = true) {
      resultDiv.style.display = 'block';
      resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
      resultDiv.innerHTML = `
        <h3>${title}</h3>
        <pre>${JSON.stringify(data, null, 2)}</pre>
      `;
    }

    // æµ‹è¯•å¥åº·çŠ¶æ€
    healthBtn.addEventListener('click', async () => {
      healthBtn.disabled = true;
      healthBtn.textContent = 'æ£€æŸ¥ä¸­...';

      try {
        const apiUrl = apiUrlInput.value.trim().replace(/\/api$/, '');
        const response = await fetch(`${apiUrl}/health`);
        const data = await response.json();

        if (response.ok) {
          showResult('âœ… æœåŠ¡å¥åº·çŠ¶æ€ - æ­£å¸¸', data, true);
        } else {
          showResult('âŒ æœåŠ¡å¥åº·çŠ¶æ€ - å¼‚å¸¸', data, false);
        }
      } catch (error) {
        showResult('âŒ è¿æ¥å¤±è´¥', {
          error: error.message,
          tip: 'è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ'
        }, false);
      } finally {
        healthBtn.disabled = false;
        healthBtn.textContent = 'â¤ï¸ æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€';
      }
    });

    // æµ‹è¯• API
    testBtn.addEventListener('click', async () => {
      const apiUrl = apiUrlInput.value.trim();
      const token = tokenInput.value.trim();
      const testDataStr = testDataInput.value.trim();

      // éªŒè¯è¾“å…¥
      if (!apiUrl) {
        alert('è¯·è¾“å…¥ API åœ°å€');
        return;
      }

      if (!token) {
        alert('è¯·è¾“å…¥ç™»å½•ä»¤ç‰Œ');
        return;
      }

      let testData;
      try {
        testData = JSON.parse(testDataStr);
      } catch (error) {
        alert('æµ‹è¯•æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥ JSON æ ¼å¼');
        return;
      }

      // å‘é€è¯·æ±‚
      testBtn.disabled = true;
      testBtn.textContent = 'æµ‹è¯•ä¸­...';

      try {
        const response = await fetch(`${apiUrl}/influencers`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`,
          },
          body: JSON.stringify(testData),
        });

        const result = await response.json();

        if (response.ok) {
          showResult('âœ… API æµ‹è¯•æˆåŠŸ', {
            status: response.status,
            statusText: response.statusText,
            data: result,
          }, true);
        } else {
          showResult('âŒ API æµ‹è¯•å¤±è´¥', {
            status: response.status,
            statusText: response.statusText,
            error: result,
          }, false);
        }
      } catch (error) {
        showResult('âŒ è¯·æ±‚å¤±è´¥', {
          error: error.message,
          tip: 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œåç«¯æœåŠ¡çŠ¶æ€'
        }, false);
      } finally {
        testBtn.disabled = false;
        testBtn.textContent = 'ğŸš€ æµ‹è¯• API è¿æ¥';
      }
    });

    // ä» localStorage åŠ è½½é…ç½®
    window.addEventListener('DOMContentLoaded', () => {
      const savedApiUrl = localStorage.getItem('testApiUrl');
      const savedToken = localStorage.getItem('testToken');

      if (savedApiUrl) apiUrlInput.value = savedApiUrl;
      if (savedToken) tokenInput.value = savedToken;
    });

    // ä¿å­˜é…ç½®åˆ° localStorage
    apiUrlInput.addEventListener('change', () => {
      localStorage.setItem('testApiUrl', apiUrlInput.value);
    });

    tokenInput.addEventListener('change', () => {
      localStorage.setItem('testToken', tokenInput.value);
    });
  </script>
</body>
</html>
