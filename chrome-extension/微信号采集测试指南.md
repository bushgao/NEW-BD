# 微信号采集测试指南

## 📋 当前状态

✅ **已完成**:
- 手机号自动点击眼睛图标并采集 - **工作正常**
- 微信号字段已添加到数据库和后端
- 微信号列已添加到前端达人管理页面

⏳ **待测试**:
- 微信号自动点击眼睛图标并采集

## 🔧 最新修复

修改了 `content.js` 中的 `clickEyeIcon()` 函数：
- **之前**: 只点击第一个眼睛图标
- **现在**: 查找并点击**所有**眼睛图标（手机号 + 微信号）

## 🧪 测试步骤

### 方法1：使用测试脚本（推荐）

1. 打开达人详情页
2. 按 F12 打开开发者工具
3. 切换到 Console 标签
4. 复制粘贴 `chrome-extension/测试微信号采集.js` 的内容
5. 按回车运行
6. 查看输出结果

**预期结果**:
```
=== 🧪 测试微信号采集 ===

1️⃣ 正在查找所有眼睛图标...
   找到 XX 个图片元素
   ✅ 找到眼睛图标 (16x16): ...
   ✅ 找到眼睛图标 (手机号附近): ...
   ✅ 找到眼睛图标 (微信号附近): ...

2️⃣ 共找到 2 个眼睛图标，开始点击...
   ✅ 已点击第 1 个眼睛图标
   ✅ 已点击第 2 个眼睛图标
   ⏳ 等待 1.5 秒让联系方式显示...

3️⃣ 正在提取联系方式...
   ✅ 手机号: 15784011208(+6465)
   ✅ 微信号: wxid_xxxxx

=== 📊 测试结果 ===
手机号: 15784011208(+6465)
微信号: wxid_xxxxx
```

### 方法2：使用插件直接测试

1. 重新加载插件（Chrome扩展管理页面点击刷新）
2. 打开达人详情页
3. 点击"添加到 Zilo"按钮
4. 查看控制台输出
5. 检查前端达人管理页面的微信号列

## 🔍 问题排查

### 如果微信号仍然是星号 `************`

**可能原因**:
1. 页面上有多个眼睛图标，但我们只找到了一个
2. 微信号的眼睛图标位置特殊，没有被检测到
3. 需要更长的等待时间让内容加载

**排查步骤**:

#### 1. 检查页面上有几个眼睛图标
```javascript
// 在控制台运行
const allImages = document.querySelectorAll('img');
let count = 0;
allImages.forEach(img => {
  const rect = img.getBoundingClientRect();
  if (rect.width >= 14 && rect.width <= 20 && rect.height >= 14 && rect.height <= 20) {
    count++;
    console.log('眼睛图标', count, ':', img.src.substring(0, 60));
  }
});
console.log('总共找到', count, '个眼睛图标');
```

#### 2. 手动点击微信号的眼睛图标
- 在页面上找到"达人微信号"字段
- 手动点击旁边的眼睛图标
- 查看微信号是否显示
- 如果显示了，说明自动点击逻辑有问题

#### 3. 检查微信号字段的HTML结构
```javascript
// 在控制台运行
const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);
let node;
while (node = walker.nextNode()) {
  if (node.textContent.includes('微信号')) {
    console.log('找到微信号文本:', node.textContent);
    console.log('父元素:', node.parentElement);
    console.log('父元素的父元素:', node.parentElement.parentElement);
    
    // 查找附近的图片
    const parent = node.parentElement.parentElement;
    const images = parent.querySelectorAll('img');
    console.log('附近的图片:', images);
    images.forEach(img => {
      const rect = img.getBoundingClientRect();
      console.log('  图片尺寸:', rect.width, 'x', rect.height, 'src:', img.src.substring(0, 60));
    });
  }
}
```

## 💡 可能的改进方案

如果当前方案不工作，可以尝试：

### 方案1：增加等待时间
在 `content.js` 的 `clickEyeIcon()` 函数中：
- 将每次点击后的等待时间从 500ms 增加到 1000ms
- 将最后的等待时间从 1500ms 增加到 3000ms

### 方案2：更精确的眼睛图标定位
专门查找"微信号"字段附近的眼睛图标：
```javascript
// 找到包含"微信号"的元素
const wechatElements = Array.from(document.querySelectorAll('*')).filter(el => 
  el.textContent.includes('微信号') && el.children.length < 5
);

// 在这些元素附近查找眼睛图标
wechatElements.forEach(el => {
  const images = el.querySelectorAll('img');
  // 点击找到的图标
});
```

### 方案3：使用 MutationObserver 监听内容变化
点击眼睛图标后，监听DOM变化，确保内容已经加载：
```javascript
const observer = new MutationObserver((mutations) => {
  // 检查是否有新的文本内容出现
  // 如果微信号从星号变成了真实值，说明加载完成
});
```

## 📝 测试清单

- [ ] 运行测试脚本，查看能找到几个眼睛图标
- [ ] 确认手机号能正常采集（已知工作正常）
- [ ] 确认微信号能正常采集（待测试）
- [ ] 如果微信号是星号，手动点击眼睛图标看是否能显示
- [ ] 检查前端达人管理页面的微信号列是否显示正确
- [ ] 测试多个不同的达人，确保功能稳定

## 🎯 成功标准

✅ 点击"添加到 Zilo"按钮后：
1. 自动点击所有眼睛图标（手机号 + 微信号）
2. 手机号正确采集（不是星号）
3. 微信号正确采集（不是星号）
4. 数据正确保存到数据库
5. 前端达人管理页面正确显示微信号
